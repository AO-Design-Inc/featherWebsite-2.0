{"slug":"2-webgl","title":"WebGL with Emscripten: The Bare Minimum","date":"2021-08-03T00:00:00.000Z","summary":"Illustrating the bare minimum required to get WebGL up and running in C with the Emscripten compiler.","thumbnail":"/blog-2-tri-thumbnail.webp","tags":["WebGL"],"author":"Jo Gao","html":"<div align=\"center\"><img style=\"width: 100%\" src=\"/blog-2-tri-thumbnail.webp\" alt=\"Thumbnail\"></div>\n\n<p>The following article is something of a hybrid between the first <a href=\"https://emscripten.org/docs/getting_started/Tutorial.html\" rel=\"nofollow\">Emscripten tutorial</a> and the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Tutorial/Getting_started_with_WebGL\" rel=\"nofollow\">Getting Started with WebGL tutorial</a>. It builds on the previous documentation to demonstrate how to render the same content in the WebGL tutorial, but in C.</p>\n<p>This is not an Introduction to C programming or WebGL, so a basic understanding of both will be helpful. If you are new to WebGL, I would recommend at least skimming the Getting Started with WebGL tutorial linked above.</p>\n<p>The focus of this article is to illustrate the bare minimum required to get WebGL up and running in C with the Emscripten compiler. And thus, if you do not yet have Emscripten installed, I would suggest doing so now from their <a href=\"https://emscripten.org/docs/getting_started/downloads.html\" rel=\"nofollow\">download page</a>.</p>\n<p>The Github repo for this tutorial is available on our <a href=\"https://github.com/AO-Design-Inc/webGL-with-emscripten\" rel=\"nofollow\">Github</a>.</p>\n<h2>HTML File</h2>\n<p>The following is a barebones HTML file with a canvas element. The <code>index.js</code> script after the canvas is the file that will be generated from compiling the C code.</p>\n<pre><code class=\"language-html\">&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;en&quot;&gt;\n\t&lt;head&gt;\n\t\t&lt;meta charset=&quot;UTF-8&quot; /&gt;\n\t\t&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot; /&gt;\n\t\t&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;\n\t\t&lt;title&gt;Document&lt;/title&gt;\n\t&lt;/head&gt;\n\t&lt;body&gt;\n\t\t&lt;canvas id=&quot;canvas&quot; height=&quot;400px&quot; width=&quot;400px&quot;&gt;&lt;/canvas&gt;\n\t\t&lt;script src=&quot;index.js&quot;&gt;&lt;/script&gt;\n\t&lt;/body&gt;\n&lt;/html&gt;\n&lt;h1&gt;This is a header&lt;/h1&gt;\n</code></pre>\n<h2>Header Files</h2>\n<pre><code class=\"language-c\">#include &lt;emscripten/html5.h&gt;\n#include &lt;GLES2/gl2.h&gt;\n</code></pre>\n<p>The html5 header provides the bindings required to use html elements and events from native code. For this tutorial, it will allow us to set up the WebGL context in C. You can view the full documentation for <code>emscripten/html.5.h</code> <a href=\"https://emscripten.org/docs/api_reference/html5.h.html\" rel=\"nofollow\">here</a></p>\n<p>The gl2 header provides the functions to draw and interact with the canvas context. The entire header file can be found <a href=\"https://www.khronos.org/registry/OpenGL/api/GLES2/gl2.h\" rel=\"nofollow\">here</a>.</p>\n<h2>Setting up the Canvas</h2>\n<p>Before we can begin drawing, we must first obtain a canvas context. The html5 header file provides the functions needed to do this. To create a canvas context, the <code>emscripten_webgl_create_context</code> function takes a target and an <code>EmscriptenWebGLContextAttributes</code> object, used to specify various attributes for the context. A complete list of the objectâ€™s attributes can be found <a href=\"https://emscripten.org/docs/api_reference/html5.h.html#c.EmscriptenWebGLContextAttributes\" rel=\"nofollow\">here</a>.</p>\n<pre class=\"language-c\"><!-- HTML_TAG_START --><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// beginning of main function</span>\n\n\t<span class=\"token comment\">// setting up EmscriptenWebGLContextAttributes</span>\n\tEmscriptenWebGLContextAttributes attr<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">emscripten_webgl_init_context_attributes</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>attr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tattr<span class=\"token punctuation\">.</span>alpha <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// target the canvas selector</span>\n\tEMSCRIPTEN_WEBGL_CONTEXT_HANDLE ctx <span class=\"token operator\">=</span> <span class=\"token function\">emscripten_webgl_create_context</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#canvas\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>attr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">emscripten_webgl_make_context_current</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><!-- HTML_TAG_END --></pre>\n<p>At the start of the main function, we create and initialize the <code>EmscriptenWebGLContextAttributes</code> object with all the default attributes settings except the alpha attribute, which is set to false. This is done mostly for the purpose of illustrating how to set specific attributes.</p>\n<p>The <code>emscripten_webgl_create_context</code> function targets, <code>#canvas</code>, the selector for the canvas element in the html file. After creating the context, we must activate it using <code>emscripten_webgl_make_context_current</code>, to specify that all following GL calls will be applied to that context.</p>\n<h2>Drawing to the Canvas</h2>\n<p>In JavaScript, we would use <code>clearColor</code> and <code>clear</code> on the canvas context to fill in the canvas. The equivalents of these methods are provided by the gl2 header as <code>glClearColor</code> and <code>glClear</code>.</p>\n<pre><code class=\"language-c\">// this goes after you have activated the webgl context\n\tglClearColor(0.984, 0.4627, 0.502, 1.0);\n\tglClear(GL_COLOR_BUFFER_BIT);\n\treturn 1;\n} // end of main function\n</code></pre>\n<h2>Compiling and Running</h2>\n<p>To compile with Emscripten, run the following command. This will output the index.js file that is sourced from the html file.</p>\n<pre><code class=\"language-bash\">emcc main.c -o index.js\n</code></pre>\n<p>The html file can now be opened and viewed in a browser. Huzzah!</p>\n<div align=\"center\"><img style=\"width: 100%\" src=\"/blog-2-tri-final.jpg\" alt=\"Final\"></div>","css":{"code":"","map":null},"head":"","readingTime":"4 min read","relatedPosts":[]}