<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="description" content="Enjoy local app streaming that feels completely native." />
	<link rel="icon" href="/favicon.png" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="icon" type="image/png" href="/favicon.png" />

	<!-- Primary tags -->
	<title>Feather</title>
	<meta name="title" content="Feather" />
	<meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' />

	<!-- Twitter -->
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:site" content="@Feather_Systems" />
	<meta name="twitter:text:title" content="Feather" />

	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:site" content="@Feather_Systems" />
	<meta name="twitter:creator" content="@Feather_Systems" />
	<meta name="twitter:image" content="https://feather.systems/Feather-site-thumbnail.png" />

	<!-- Open Graph -->
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://feather.systems/" />
	<meta property="og:title" content="Feather" />
	<meta property="og:description" content="Enjoy local app streaming that feels completely native." />
	<meta property="og:image"
		content="https://5000-copper-beaver-rc3ipd4s.ws-us20.gitpod.io/assets/Feather-site-tumbnail.png" />
	<meta property="og:image:alt" content="Feather: Enjoy local app streaming that feels completely native." />

	<!-- Icons -->
	<link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png" />
	<link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png" />
	<link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png" />
	<link rel="manifest" href="/icons/site.webmanifest" />
	<link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#d5615b" />
	<link rel="shortcut icon" href="/icons/favicon.ico" />
	<meta name="msapplication-TileColor" content="#da532c" />
	<meta name="msapplication-config" content="/icons/browserconfig.xml" />
	<meta name="theme-color" content="#ffffff" />
	<!-- <script defer data-domain="feather.systems" src="https://plausible.io/js/plausible.js"></script> -->
	<!-- <script defer data-domain="feather.systems" src="https://plausible.io/js/.js"></script> -->
	<script src="/stats/js/script.js" data-api="/stats/api/event" data-domain="feather.systems"></script>

	<style>
		@font-face {
			font-family: 'Inter var';
			font-style: oblique 0deg 10deg;
			font-weight: 100 900;
			font-display: swap;
			src: url('/Inter.var.woff2') format('woff2');
		}
	</style>

	

		

		<link rel="stylesheet" href="/_app/assets/start-61d1577b.css">
		<link rel="stylesheet" href="/_app/assets/vendor-2634b1a9.css">
		<link rel="stylesheet" href="/_app/assets/pages/__layout.svelte-0224116f.css">
		<link rel="stylesheet" href="/_app/assets/form.svelte_svelte_type_style_lang-99e7096c.css">
		<link rel="stylesheet" href="/_app/assets/stores-4ca8f149.css">
		<link rel="stylesheet" href="/_app/assets/pages/blog.svelte-d03a84a8.css">
		<link rel="stylesheet" href="/_app/assets/thumbnail-b6ad015b.css">
<<<<<<< HEAD
		<link rel="modulepreload" href="/_app/start-3495d450.js">
		<link rel="modulepreload" href="/_app/chunks/vendor-08ba1c64.js">
		<link rel="modulepreload" href="/_app/pages/__layout.svelte-b96e22d4.js">
		<link rel="modulepreload" href="/_app/chunks/stores-c248ff7b.js">
		<link rel="modulepreload" href="/_app/pages/blog.svelte-3b0e86c4.js">
		<link rel="modulepreload" href="/_app/chunks/thumbnail-6ffb4fe4.js">

		<script type="module">
			import { start } from "/_app/start-3495d450.js";
=======
		<link rel="modulepreload" href="/_app/start-913c8006.js">
		<link rel="modulepreload" href="/_app/chunks/vendor-8bebd811.js">
		<link rel="modulepreload" href="/_app/pages/__layout.svelte-3ecabc70.js">
		<link rel="modulepreload" href="/_app/chunks/stores-1651a60b.js">
		<link rel="modulepreload" href="/_app/pages/blog.svelte-c79379c4.js">
		<link rel="modulepreload" href="/_app/chunks/thumbnail-40eb2b38.js">

		<script type="module">
			import { start } from "/_app/start-913c8006.js";
>>>>>>> parent of a67e99b (Testing for linux)
			start({
				target: document.querySelector("#svelte"),
				paths: {"base":"","assets":""},
				session: {userAgent:void 0},
				route: true,
				spa: false,
				trailing_slash: "never",
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/_app/pages/__layout.svelte-b96e22d4.js"),
						import("/_app/pages/blog.svelte-3b0e86c4.js")
					],
					url: new URL("http://prerender/blog"),
					params: {}
				}
			});
		</script>
</head>

<body>
	<script>
		0;
	</script>
	<div id="svelte">




<main class="d svelte-as4lz9"><a sveltekit:prefetch href="/"><div id="logo" class="svelte-as4lz9"><img src="/logo.svg" alt="Feather Logo" class="svelte-as4lz9"></div></a>
	<div class="spacer one svelte-as4lz9"></div>
	<a sveltekit:prefetch href="/blog"><div class="link svelte-as4lz9">Blog</div></a>
	<div class="spacer linker between svelte-as4lz9"></div>
	<a sveltekit:prefetch href="/about"><div class="link svelte-as4lz9">About</div></a>
	<div class="spacer linker svelte-as4lz9"></div>
	<a href="/#sign-up"><div><div class="sign-up svelte-as4lz9">Sign Up</div></div></a>
	
	
	
</main>
<div class="container svelte-16cmhad"><div class="banner svelte-16cmhad"><div class="container svelte-1sg7f2x"><div class="thumbnail svelte-1sg7f2x"><div class="image svelte-1sg7f2x"><img src="/blog-4-vision-vision-Sharing-Thumbnail.webp" alt="Thumbnail" class="background svelte-1sg7f2x"></div>
		<div class="content svelte-1sg7f2x"><div class="tags"><a sveltekit:prefetch class="tag svelte-1sg7f2x" href="/tags/Vision">#Vision
					</a><a sveltekit:prefetch class="tag svelte-1sg7f2x" href="/tags/Article">#Article
					</a></div>
			<div class="title svelte-1sg7f2x">Vision: Sharing The Power of the PC You Already Own</div>
			<div class="summary truncate svelte-1sg7f2x">Feather does more for power users. Learn more about how Feather is changing the world of compute.</div>
			<a sveltekit:prefetch href="/4-power-user-vision" class="button svelte-1sg7f2x"><div class="button-text svelte-1sg7f2x">Read More</div>
				<div class="arrow-icon svelte-1sg7f2x"></div></a></div></div>
</div></div>
	<div class="grid svelte-16cmhad"><a sveltekit:prefetch href="/4-power-user-vision" class="svelte-11z53b"><div class="thumbnail svelte-11z53b"><div class="image svelte-11z53b"><img src="/blog-4-vision-vision-Sharing-Thumbnail.webp" alt="Thumbnail" class="svelte-11z53b"></div>
		<div class="content svelte-11z53b"><h2 class="title truncate header svelte-11z53b">Vision: Sharing The Power of the PC You Already Own</h2>
			<div class="summary truncate svelte-11z53b">Feather does more for power users. Learn more about how Feather is changing the world of compute.</div>
			<div class="content-footer svelte-11z53b"><p class="tags svelte-11z53b"><a sveltekit:prefetch class="tag svelte-11z53b" href="/tags/Vision">#Vision
						</a><a sveltekit:prefetch class="tag svelte-11z53b" href="/tags/Article">#Article
						</a></p>
				<div id="arrow-icon" class="svelte-11z53b"></div></div></div></div>
</a><a sveltekit:prefetch href="/3-2021-in-Review" class="svelte-11z53b"><div class="thumbnail svelte-11z53b"><div class="image svelte-11z53b"><img src="/blog-3-review-thumbnail.webp" alt="Thumbnail" class="svelte-11z53b"></div>
		<div class="content svelte-11z53b"><h2 class="title truncate header svelte-11z53b">Looking Back at 2021, Gearing For Launch</h2>
			<div class="summary truncate svelte-11z53b">Over the past year we’ve done a lot to rapidly build up a prototype, and have finally reached a point where we’ve been using it on your own workflows.</div>
			<div class="content-footer svelte-11z53b"><p class="tags svelte-11z53b"><a sveltekit:prefetch class="tag svelte-11z53b" href="/tags/Update">#Update
						</a><a sveltekit:prefetch class="tag svelte-11z53b" href="/tags/Engineering">#Engineering
						</a></p>
				<div id="arrow-icon" class="svelte-11z53b"></div></div></div></div>
</a><a sveltekit:prefetch href="/2-webgl" class="svelte-11z53b"><div class="thumbnail svelte-11z53b"><div class="image svelte-11z53b"><img src="/blog-2-tri-thumbnail.webp" alt="Thumbnail" class="svelte-11z53b"></div>
		<div class="content svelte-11z53b"><h2 class="title truncate header svelte-11z53b">WebGL with Emscripten: The Bare Minimum</h2>
			<div class="summary truncate svelte-11z53b">Illustrating the bare minimum required to get WebGL up and running in C with the Emscripten compiler.</div>
			<div class="content-footer svelte-11z53b"><p class="tags svelte-11z53b"><a sveltekit:prefetch class="tag svelte-11z53b" href="/tags/Engineering">#Engineering
						</a></p>
				<div id="arrow-icon" class="svelte-11z53b"></div></div></div></div>
</a><a sveltekit:prefetch href="/1-mandel" class="svelte-11z53b"><div class="thumbnail svelte-11z53b"><div class="image svelte-11z53b"><img src="/blog-1-mandel-thumbnail.webp" alt="Thumbnail" class="svelte-11z53b"></div>
		<div class="content svelte-11z53b"><h2 class="title truncate header svelte-11z53b">One of the Fastest Web Mandelbrot Renderers</h2>
			<div class="summary truncate svelte-11z53b">Our initial experiments rendering the Mandelbrot set with JavaScript, Web-workers &amp; emerging web technologies like webassembly.</div>
			<div class="content-footer svelte-11z53b"><p class="tags svelte-11z53b"><a sveltekit:prefetch class="tag svelte-11z53b" href="/tags/Engineering">#Engineering
						</a></p>
				<div id="arrow-icon" class="svelte-11z53b"></div></div></div></div>
</a></div>
</div>
<div id="f_main" class="d svelte-cxmgxs"><div class="spacer-gutter svelte-cxmgxs"><div class="top-container svelte-cxmgxs"><img src="/footer-logo.svg" alt="Feather Logo Long" class="logo svelte-cxmgxs">
        
        <button class="cta svelte-cxmgxs"><div class="text svelte-cxmgxs">Join Our Mailing List</div>
          <img src="/footer-mail.svg" alt="Mailing List" class="image svelte-cxmgxs"></button></div>
      <div class="spacer two footer svelte-cxmgxs"></div>
      <div class="divider svelte-cxmgxs"></div>
      <div class="spacer two footer svelte-cxmgxs"></div>
      <div class="bottom-container svelte-cxmgxs"><div class="copyright svelte-cxmgxs">© 2021 Feather Systems. All Rights Reserved</div>
        <div class="spacer three footer svelte-cxmgxs"></div>
        <div class="social-container svelte-cxmgxs"><a href="https://twitter.com/Feather_Systems" class="0 svelte-cxmgxs"><img src="/twitter.svg" class="social image Twitter svelte-cxmgxs" alt="Twitter">
            </a><a href="https://discord.gg/8KVKzg8HEk" class="1 svelte-cxmgxs"><img src="/discord.svg" class="social image Discord svelte-cxmgxs" alt="Discord">
            </a><a href="https://www.reddit.com/r/FeatherSystems/" class="2 svelte-cxmgxs"><img src="/reddit.svg" class="social image Reddit svelte-cxmgxs" alt="Reddit">
            </a></div></div></div>
  </div>

<script type="application/json" data-type="svelte-data" data-url="/blog.json">{"status":200,"statusText":"","headers":{"content-type":"text/plain;charset=UTF-8"},"body":"[{\"slug\":\"4-power-user-vision\",\"title\":\"Vision: Sharing The Power of the PC You Already Own\",\"date\":\"2022-02-02T00:00:00.000Z\",\"summary\":\"Feather does more for power users. Learn more about how Feather is changing the world of compute.\",\"thumbnail\":\"\u002Fblog-4-vision-vision-Sharing-Thumbnail.webp\",\"tags\":[\"Vision\",\"Article\"],\"author\":\"Kyle Li\",\"html\":\"\u003Cp\u003EWhy would anyone want to remotely access their computer? In fact, lets ask this in another way: what do you gain from being able to use the processing power of a desktop PC, anywhere?\u003C\u002Fp\u003E\\n\u003Cp\u003EThe concept of computing began with massive computers - the size of rooms - purpose built for industrial applications. One of these firsts, the CDC 6600 was capable of performing over three million mathematical operations a second. Research and operations that once took hundreds of hours of \u003Cem\u003Eman-power\u003C\u002Fem\u003E, now required only seconds of computer \u003Cstrong\u003E\u003Cem\u003Eprocessing power\u003C\u002Fem\u003E\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-4-vision-cdc-6600-picture.webp\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-4-vision-cdc-6600-diagram.webp\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\u003Cp\u003EIn the decades following, we’ve seen the rise of home computing, a shift towards ultraportable laptops, and the global takeover of smartphones. Now, with even the average household game console capable of over 10 trillion operations (10 TFlops), it’s become clear that the future of computing is going portable. We’re constantly seeking more processing power than ever before and in increasingly small packages. Toss in the growing awareness of owning personal data and information, a shift towards work at home culture, and you have to ask yourself… what don’t you gain from accessing the resources of a powerful PC from any of your other devices?\u003C\u002Fp\u003E\\n\u003Ch3\u003ERemoving heat &amp; noise from where you work &amp; play?\u003C\u002Fh3\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-4-vision-move-heat-and-noise-from-where-you-work-and-play.webp\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\u003Cp\u003EA powerful computer turns a small room into a sauna in minutes. No matter if you’re rendering the last few minutes of a short film or cranking out killstreaks in the latest FPS, running a PC generates heat which gets uncomfortable, fast. In fact the average high end system in a bedroom increases room temperatures by up to 5-10f above room temperature.\u003C\u002Fp\u003E\\n\u003Cp\u003EWhere does remotely accessing your computer come into play? Well, what if we moved the source of the heat somewhere where it can’t bother you? Places where the heat and noise don’t matter as much. By remotely accessing your PC, you can have it run in a dedicated server room, a garage, or even your living room so the heat is out of sight and out of mind. \u003C\u002Fp\u003E\\n\u003Ch3\u003EAccessing processing power from anywhere in your house?\u003C\u002Fh3\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-4-vision-access-your-home-office-from-any-device.webp\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\u003Cp\u003EIf you own a powerful PC already, why can’t you access its resources from any device in your house? Leaving a noisy PC in a quiet home theater is just unacceptable, and you don’t want to move your desktop around whenever you want it on a different screen.\u003C\u002Fp\u003E\\n\u003Cp\u003EWhat if you could leave your PC connected to your home office, but still share the processing power around to your TV or laptop elsewhere? You can do the same work and access the same files as you would in your office or use your work PC to run games or enjoy entertainment from a central hub. You purchase one device for all.\u003C\u002Fp\u003E\\n\u003Ch3\u003ESharing a file, without ever needing to “share” the file?\u003C\u002Fh3\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-4-vision-work-from-home-actually-at-home.webp\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\u003Cp\u003ESharing files is annoying. It’s become easier than ever to link files for a detailed presentation, or to share an update with your coworkers. The easiest solution however, will always be to run the file natively, never having to move the file at all.\u003C\u002Fp\u003E\\n\u003Cp\u003EWhat if instead of having to plug your laptop into an HDMI projector, you’re already ready to demo at all times? Instead of sending a file to yourself through email or uploading it on a USB stick to take home, you’ve got access to the file on the computer you’re already on because you’ve never left it. With remote access, your files are already in a central location accessible just like your private cloud. Just log in, and you have your entire workspace ready and waiting all of the files already there as you left them.\u003C\u002Fp\u003E\\n\u003Ch2\u003EWhat Does Feather Do Different?\u003C\u002Fh2\u003E\\n\u003Cp\u003EThe concept of remotely accessing a computer itself is not a novel idea. When you think about remotely access however, what are your options? A hardwire solution is permanent, expensive and complex. Remote desktops scale poorly, are complex to set up, and unsecure. Cloud servers have high latency, are prohibitively expensive, and lack user control.\u003C\u002Fp\u003E\\n\u003Cp\u003EFeather isn’t in the business of being a remote desktop. Feather is built with the goal of providing freedom to how you access compute. Our goal is to enable anyone to turn their home PCs into home servers that load balance processing power across Wi-Fi. After all, why would you stream the text of a web page to a computer and have it end up blurry or try and drive complex games or render jobs on a weak laptop? If your device is better at rendering text and images, while a desktop PC is great at handling intensive processing like games and work, why not let the compute happen where it’s best for it to happen? Our vision of Feather enables this and so much more.\u003C\u002Fp\u003E\\n\u003Ch3\u003EAccelerating any Wi-Fi connected device\u003C\u002Fh3\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-4-vision-let-processing-happen-where-its-best.webp\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\u003Cp\u003ETraditional remote access software only allows you to share with similarly sized screens since all they do is record a desktop. Can you imagine trying to use a desktop UI on a smartphone or even a smartwatch? There’s a reason mobile UI is designed the way it is. By splitting the processing power of each application, we can run applications natively on devices and only speed up the parts that need to be improved. Multiple clients can be load balanced across multiple servers at once, and you can accelerate the performance of an entire family’s worth of Chromebooks with a single PC. \u003C\u002Fp\u003E\\n\u003Ch3\u003ECreating a processing power network\u003C\u002Fh3\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-4-vision-load-balancing-entire-neighborhoods.webp\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\u003Cp\u003EModern electricity grids load balance power across regions. When production is high in one region, the grid automatically sells power to high demand regions and vice versa. With the average user spending less than 10% of their time never utilizing their devices at peak processing, we waste massive amounts of not only money, but our global processing potential to fulfill rare peaks in our usage. \u003C\u002Fp\u003E\\n\u003Cp\u003EWhat if instead of electricity, we could load balance processing power? If processing power can be anonymized, devices sitting at home can automatically assist neighborhood workplaces and research institutions on processor heavy tasks. In return, when you return home and run the latest triple A title, the now available workplace devices can share their processing with you. The more people on the network, the more processing power available to everyone at once. Together we can upgrade all the devices everyone has, everywhere.\u003C\u002Fp\u003E\\n\u003Ch3\u003EPublic Wi-Fi nodes and feather light technology\u003C\u002Fh3\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-4-vision-processing-power-as-easily-accessible-as-public-wifi.webp\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\u003Cp\u003EWe are more connected than ever before, and the implementation of 5G enables us to do more over the internet wherever we need to be. By setting up feather nodes in public spaces, we now not only are more connected everywhere, but can do more everywhere. Developers will have a completely new ecosystem of tools to develop around. Imagine smart drones with image recognition powered locally instead of requiring data being sent to servers on the cloud, smart clothing and glasses that can be as thin and small as a Wi-Fi receiver, or even feather light low cost devices with amazing interfaces at the fraction of the cost of a full device. Anyone will be able to develop on this platform, for this platform to enable things that were once never possible before.\u003C\u002Fp\u003E\\n\u003Cp\u003ESo to answer the question about why someone would want to remotely access their computer, we at Feather ask a different question. What don’t we \u003Cstrong\u003E\u003Cem\u003Eall\u003C\u002Fem\u003E\u003C\u002Fstrong\u003E gain from being able to use the processing power of a desktop PC, anywhere? Here at Feather, we hope to enable a better connected future that blurs the lines between server and client, where society can have access to more powerful computing than ever before, and a world where processing power is as easily accessible as public Wi-Fi.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003EThanks for reading ✨\u003C\u002Fem\u003E\u003C\u002Fp\u003E\",\"css\":{\"code\":\"\",\"map\":null},\"head\":\"\",\"readingTime\":\"7 min read\",\"relatedPosts\":[]},{\"slug\":\"3-2021-in-Review\",\"title\":\"Looking Back at 2021, Gearing For Launch\",\"date\":\"2022-1-21\",\"summary\":\"Over the past year we’ve done a lot to rapidly build up a prototype, and have finally reached a point where we’ve been using it on your own workflows.\",\"thumbnail\":\"\u002Fblog-3-review-thumbnail.webp\",\"tags\":[\"Update\",\"Engineering\"],\"author\":\"Kyle Li, Jo Gao\",\"html\":\"\u003Cp\u003E2021 has been an exciting year for Feather. \u003C\u002Fp\u003E\\n\u003Cp\u003EWe’ve made massive strides towards reaching feature parity with key players in our field, expanded our team, and have plans for even more in 2022 (including a public launch!).\u003C\u002Fp\u003E\\n\u003Ciframe style=\\\"width: 100%;\\\" width=\\\"560\\\" height=\\\"315\\\" src=\\\"https:\u002F\u002Fwww.youtube.com\u002Fembed\u002Fzh7jbxOZipw\\\" title=\\\"YouTube video player\\\" frameborder=\\\"0\\\" allow=\\\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\\\" allowfullscreen\u003E\u003C\u002Fiframe\u003E\\n\u003Cp\u003E\u003Cem\u003EP.S. Stay tuned until the end of the video Progress Report to view a demo of Feather in action through long distances (Atlanta → New York).\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Ch2\u003EProgress So Far\u003C\u002Fh2\u003E\\n\u003Cp\u003EOver the past year we’ve done a lot to rapidly build up a prototype, and have finally reached a point where we’ve been using it on your own workflows. \u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003ERemote Desktop:\u003C\u002Fstrong\u003E FeatherStream currently allows users to access their full desktop remotely from any other PC utilizing webRTC.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003ECross OS Support:\u003C\u002Fstrong\u003E We have successfully configured CI for this project to automatically give us Linux, Windows, and MacOS builds for testing.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003EMulti-Server Support:\u003C\u002Fstrong\u003E To prepare for future plans in load balancing, FeatherStream allows you to set up and connect to multiple servers from the same client device, seamlessly across multiple devices and vice versa.\u003C\u002Fp\u003E\\n\u003Cp\u003EAll of this has brought Feather up to speed with other remote desktop solutions in months, building the core of our future innovations.\u003C\u002Fp\u003E\\n\u003Ch2\u003EThe Feather Vision\u003C\u002Fh2\u003E\\n\u003Cp\u003EFeather isn’t simply a Remote Desktop. In fact, we looked at the clunky existing remote desktop and VDI infrastructure and found it unusable. It’s not their fault. The fact is that simply streaming the entire desktop as a video can never feel like you’re natively browsing windows on your machine.\u003C\u002Fp\u003E\\n\u003Cp\u003EFeather isn’t a Remote Desktop because it’s a way for you to transform your home PC into a router for processing power itself. Anyone connected to your local Wi-Fi network should be able to accelerate the processing power they have available on the weakest of devices. Connecting to another machine should feel as smooth as running an app on your own device… and making these connections should be as simple and easily understood as connecting to Wi-Fi itself. \u003C\u002Fp\u003E\\n\u003Ch2\u003ELooking Forward\u003C\u002Fh2\u003E\\n\u003Cp\u003EWe’re a little ambitious, and it won’t be easy. This year, we have a few steps planned to achieve our vision.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003EIndividual Windows\u003C\u002Fstrong\u003E: Moving forward, we will implement application-level video streaming so users can access specific programs remotely. Users will be able to use different applications with a near-native experience.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003ECross-Platform Files:\u003C\u002Fstrong\u003E We will add a shared clipboard mechanism so users can copy and paste between their local and remote devices without problems. We will be setting up a file system view for users to be able to access both local and remote files and a way to transfer and share files between devices.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003EAlpha Testing:\u003C\u002Fstrong\u003E We will continue to improve and develop our testing framework to start multiple instances of FeatherStream and help us release more robust versions of this product.\u003C\u002Fp\u003E\\n\u003Cp\u003EIf you’re interested in being the first to hear about how we’re changing remote access, make sure to subscribe to the Feather newsletter.\u003C\u002Fp\u003E\\n\u003Cp\u003EIt has been an exciting year as we begin to gear up to bring Feather into the public eye. Lots have been celebrated, improved, and learned. We have exciting news planned for our next monthly update, so stay tuned to learn more because even we can’t wait to see what comes next. \u003C\u002Fp\u003E\\n\u003Cul\u003E\u003Cli\u003EFeather Team\u003C\u002Fli\u003E\u003C\u002Ful\u003E\",\"css\":{\"code\":\"\",\"map\":null},\"head\":\"\",\"readingTime\":\"3 min read\",\"relatedPosts\":[{\"slug\":\"2-webgl\",\"title\":\"WebGL with Emscripten: The Bare Minimum\",\"date\":\"2021-08-03T00:00:00.000Z\",\"summary\":\"Illustrating the bare minimum required to get WebGL up and running in C with the Emscripten compiler.\",\"thumbnail\":\"\u002Fblog-2-tri-thumbnail.webp\",\"tags\":[\"Engineering\"],\"author\":\"Jo Gao\",\"html\":\"\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-2-tri-thumbnail.webp\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\\n\u003Cp\u003EThe following article is something of a hybrid between the first \u003Ca href=\\\"https:\u002F\u002Femscripten.org\u002Fdocs\u002Fgetting_started\u002FTutorial.html\\\" rel=\\\"nofollow\\\"\u003EEmscripten tutorial\u003C\u002Fa\u003E and the \u003Ca href=\\\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FAPI\u002FWebGL_API\u002FTutorial\u002FGetting_started_with_WebGL\\\" rel=\\\"nofollow\\\"\u003EGetting Started with WebGL tutorial\u003C\u002Fa\u003E. It builds on the previous documentation to demonstrate how to render the same content in the WebGL tutorial, but in C.\u003C\u002Fp\u003E\\n\u003Cp\u003EThis is not an Introduction to C programming or WebGL, so a basic understanding of both will be helpful. If you are new to WebGL, I would recommend at least skimming the Getting Started with WebGL tutorial linked above.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe focus of this article is to illustrate the bare minimum required to get WebGL up and running in C with the Emscripten compiler. And thus, if you do not yet have Emscripten installed, I would suggest doing so now from their \u003Ca href=\\\"https:\u002F\u002Femscripten.org\u002Fdocs\u002Fgetting_started\u002Fdownloads.html\\\" rel=\\\"nofollow\\\"\u003Edownload page\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe Github repo for this tutorial is available on our \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002FAO-Design-Inc\u002FwebGL-with-emscripten\\\" rel=\\\"nofollow\\\"\u003EGithub\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Ch2\u003EHTML File\u003C\u002Fh2\u003E\\n\u003Cp\u003EThe following is a barebones HTML file with a canvas element. The \u003Ccode\u003Eindex.js\u003C\u002Fcode\u003E script after the canvas is the file that will be generated from compiling the C code.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-html\\\"\u003E&lt;!DOCTYPE html&gt;\\n&lt;html lang=&quot;en&quot;&gt;\\n\\t&lt;head&gt;\\n\\t\\t&lt;meta charset=&quot;UTF-8&quot; \u002F&gt;\\n\\t\\t&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot; \u002F&gt;\\n\\t\\t&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; \u002F&gt;\\n\\t\\t&lt;title&gt;Document&lt;\u002Ftitle&gt;\\n\\t&lt;\u002Fhead&gt;\\n\\t&lt;body&gt;\\n\\t\\t&lt;canvas id=&quot;canvas&quot; height=&quot;400px&quot; width=&quot;400px&quot;&gt;&lt;\u002Fcanvas&gt;\\n\\t\\t&lt;script src=&quot;index.js&quot;&gt;&lt;\u002Fscript&gt;\\n\\t&lt;\u002Fbody&gt;\\n&lt;\u002Fhtml&gt;\\n&lt;h1&gt;This is a header&lt;\u002Fh1&gt;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch2\u003EHeader Files\u003C\u002Fh2\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-c\\\"\u003E#include &lt;emscripten\u002Fhtml5.h&gt;\\n#include &lt;GLES2\u002Fgl2.h&gt;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe html5 header provides the bindings required to use html elements and events from native code. For this tutorial, it will allow us to set up the WebGL context in C. You can view the full documentation for \u003Ccode\u003Eemscripten\u002Fhtml.5.h\u003C\u002Fcode\u003E \u003Ca href=\\\"https:\u002F\u002Femscripten.org\u002Fdocs\u002Fapi_reference\u002Fhtml5.h.html\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EThe gl2 header provides the functions to draw and interact with the canvas context. The entire header file can be found \u003Ca href=\\\"https:\u002F\u002Fwww.khronos.org\u002Fregistry\u002FOpenGL\u002Fapi\u002FGLES2\u002Fgl2.h\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Ch2\u003ESetting up the Canvas\u003C\u002Fh2\u003E\\n\u003Cp\u003EBefore we can begin drawing, we must first obtain a canvas context. The html5 header file provides the functions needed to do this. To create a canvas context, the \u003Ccode\u003Eemscripten_webgl_create_context\u003C\u002Fcode\u003E function takes a target and an \u003Ccode\u003EEmscriptenWebGLContextAttributes\u003C\u002Fcode\u003E object, used to specify various attributes for the context. A complete list of the object’s attributes can be found \u003Ca href=\\\"https:\u002F\u002Femscripten.org\u002Fdocs\u002Fapi_reference\u002Fhtml5.h.html#c.EmscriptenWebGLContextAttributes\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-c\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-c\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002F beginning of main function\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002F setting up EmscriptenWebGLContextAttributes\u003C\u002Fspan\u003E\\n\\tEmscriptenWebGLContextAttributes attr\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Eemscripten_webgl_init_context_attributes\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Eattr\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\tattr\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ealpha \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002F target the canvas selector\u003C\u002Fspan\u003E\\n\\tEMSCRIPTEN_WEBGL_CONTEXT_HANDLE ctx \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Eemscripten_webgl_create_context\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"#canvas\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Eattr\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Eemscripten_webgl_make_context_current\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ectx\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EAt the start of the main function, we create and initialize the \u003Ccode\u003EEmscriptenWebGLContextAttributes\u003C\u002Fcode\u003E object with all the default attributes settings except the alpha attribute, which is set to false. This is done mostly for the purpose of illustrating how to set specific attributes.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe \u003Ccode\u003Eemscripten_webgl_create_context\u003C\u002Fcode\u003E function targets, \u003Ccode\u003E#canvas\u003C\u002Fcode\u003E, the selector for the canvas element in the html file. After creating the context, we must activate it using \u003Ccode\u003Eemscripten_webgl_make_context_current\u003C\u002Fcode\u003E, to specify that all following GL calls will be applied to that context.\u003C\u002Fp\u003E\\n\u003Ch2\u003EDrawing to the Canvas\u003C\u002Fh2\u003E\\n\u003Cp\u003EIn JavaScript, we would use \u003Ccode\u003EclearColor\u003C\u002Fcode\u003E and \u003Ccode\u003Eclear\u003C\u002Fcode\u003E on the canvas context to fill in the canvas. The equivalents of these methods are provided by the gl2 header as \u003Ccode\u003EglClearColor\u003C\u002Fcode\u003E and \u003Ccode\u003EglClear\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-c\\\"\u003E\u002F\u002F this goes after you have activated the webgl context\\n\\tglClearColor(0.984, 0.4627, 0.502, 1.0);\\n\\tglClear(GL_COLOR_BUFFER_BIT);\\n\\treturn 1;\\n} \u002F\u002F end of main function\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch2\u003ECompiling and Running\u003C\u002Fh2\u003E\\n\u003Cp\u003ETo compile with Emscripten, run the following command. This will output the index.js file that is sourced from the html file.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-bash\\\"\u003Eemcc main.c -o index.js\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe html file can now be opened and viewed in a browser. Huzzah!\u003C\u002Fp\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-2-tri-final.jpg\\\" alt=\\\"Final\\\"\u003E\u003C\u002Fdiv\u003E\",\"css\":{\"code\":\"\",\"map\":null},\"head\":\"\",\"readingTime\":\"4 min read\"},{\"slug\":\"1-mandel\",\"title\":\"One of the Fastest Web Mandelbrot Renderers\",\"date\":\"2021-06-21T00:00:00.000Z\",\"summary\":\"Our initial experiments rendering the Mandelbrot set with JavaScript, Web-workers & emerging web technologies like webassembly.\",\"thumbnail\":\"\u002Fblog-1-mandel-thumbnail.webp\",\"tags\":[\"Engineering\"],\"author\":\"Ojasvin Kirpane, Abhishek Cherath, Jo Gao & Abhinuv Allu\",\"html\":\"\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-1-mandel-thumbnail.webp\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\u003Ch2\u003EIntroduction\u003C\u002Fh2\u003E\\n\u003Cp\u003EHey, welcome to the Feather Systems blog. This is the first post of many, documenting our journey towards creating simpler systems for better performance on the web. This post will document our initial experiments rendering the Mandelbrot set with JavaScript, Web-workers &amp; emerging web technologies like webassembly. You can access the project \u003Ca href=\\\"https:\u002F\u002Fjs-wasm-mandelbrot-benchmark-3.vercel.app\u002F\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E and view the code \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002FAO-Design-Inc\u002Fjs-wasm-mandelbrot-benchmark\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E. These experiments were tested and measured by the team to properly document each technology’s advantages &amp; disadvantages.\u003C\u002Fp\u003E\\n\u003Cp\u003ETo elucidate, let’s start with fractals &amp; the mandelbrot set:\u003C\u002Fp\u003E\\n\u003Ch2\u003EThe Mandelbrot Set\u003C\u002Fh2\u003E\\n\u003Cp\u003EThe Mandelbrot Set is defined as the set of complex numbers for which the function \\n\\n\u003C!-- HTML_TAG_START --\u003E\u003Cspan class=\\\"katex\\\"\u003E\u003Cspan class=\\\"katex-mathml\\\"\u003E\u003Cmath xmlns=\\\"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML\\\"\u003E\u003Csemantics\u003E\u003Cmrow\u003E\u003Cmi\u003Ez\u003C\u002Fmi\u003E\u003Cmo\u003E∗\u003C\u002Fmo\u003E\u003Cmrow\u003E\u003Cmi\u003En\u003C\u002Fmi\u003E\u003Cmo\u003E+\u003C\u002Fmo\u003E\u003Cmn\u003E1\u003C\u002Fmn\u003E\u003C\u002Fmrow\u003E\u003Cmo\u003E=\u003C\u002Fmo\u003E\u003Cmsubsup\u003E\u003Cmi\u003Ez\u003C\u002Fmi\u003E\u003Cmi\u003En\u003C\u002Fmi\u003E\u003Cmn\u003E2\u003C\u002Fmn\u003E\u003C\u002Fmsubsup\u003E\u003Cmo\u003E+\u003C\u002Fmo\u003E\u003Cmi\u003Ec\u003C\u002Fmi\u003E\u003C\u002Fmrow\u003E\u003Cannotation encoding=\\\"application\u002Fx-tex\\\"\u003Ez*{n+1}=z_n^2+c\u003C\u002Fannotation\u003E\u003C\u002Fsemantics\u003E\u003C\u002Fmath\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"katex-html\\\" aria-hidden=\\\"true\\\"\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:0.4653em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord mathnormal\\\" style=\\\"margin-right:0.04398em;\\\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mbin\\\"\u003E∗\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:0.7278em;vertical-align:-0.0833em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord\\\"\u003E\u003Cspan class=\\\"mord mathnormal\\\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mbin\\\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord\\\"\u003E1\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2778em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mrel\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2778em;\\\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:1.0611em;vertical-align:-0.247em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord\\\"\u003E\u003Cspan class=\\\"mord mathnormal\\\" style=\\\"margin-right:0.04398em;\\\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\\\"msupsub\\\"\u003E\u003Cspan class=\\\"vlist-t vlist-t2\\\"\u003E\u003Cspan class=\\\"vlist-r\\\"\u003E\u003Cspan class=\\\"vlist\\\" style=\\\"height:0.8141em;\\\"\u003E\u003Cspan style=\\\"top:-2.453em;margin-left:-0.044em;margin-right:0.05em;\\\"\u003E\u003Cspan class=\\\"pstrut\\\" style=\\\"height:2.7em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"sizing reset-size6 size3 mtight\\\"\u003E\u003Cspan class=\\\"mord mathnormal mtight\\\"\u003En\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan style=\\\"top:-3.063em;margin-right:0.05em;\\\"\u003E\u003Cspan class=\\\"pstrut\\\" style=\\\"height:2.7em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"sizing reset-size6 size3 mtight\\\"\u003E\u003Cspan class=\\\"mord mtight\\\"\u003E2\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"vlist-s\\\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"vlist-r\\\"\u003E\u003Cspan class=\\\"vlist\\\" style=\\\"height:0.247em;\\\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mbin\\\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:0.4306em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord mathnormal\\\"\u003Ec\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C!-- HTML_TAG_END --\u003E does not diverge when \\n\\n\u003C!-- HTML_TAG_START --\u003E\u003Cspan class=\\\"katex\\\"\u003E\u003Cspan class=\\\"katex-mathml\\\"\u003E\u003Cmath xmlns=\\\"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML\\\"\u003E\u003Csemantics\u003E\u003Cmrow\u003E\u003Cmsub\u003E\u003Cmi\u003Ez\u003C\u002Fmi\u003E\u003Cmn\u003E0\u003C\u002Fmn\u003E\u003C\u002Fmsub\u003E\u003Cmo\u003E=\u003C\u002Fmo\u003E\u003Cmn\u003E0\u003C\u002Fmn\u003E\u003C\u002Fmrow\u003E\u003Cannotation encoding=\\\"application\u002Fx-tex\\\"\u003Ez_{0}=0\u003C\u002Fannotation\u003E\u003C\u002Fsemantics\u003E\u003C\u002Fmath\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"katex-html\\\" aria-hidden=\\\"true\\\"\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:0.5806em;vertical-align:-0.15em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord\\\"\u003E\u003Cspan class=\\\"mord mathnormal\\\" style=\\\"margin-right:0.04398em;\\\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\\\"msupsub\\\"\u003E\u003Cspan class=\\\"vlist-t vlist-t2\\\"\u003E\u003Cspan class=\\\"vlist-r\\\"\u003E\u003Cspan class=\\\"vlist\\\" style=\\\"height:0.3011em;\\\"\u003E\u003Cspan style=\\\"top:-2.55em;margin-left:-0.044em;margin-right:0.05em;\\\"\u003E\u003Cspan class=\\\"pstrut\\\" style=\\\"height:2.7em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"sizing reset-size6 size3 mtight\\\"\u003E\u003Cspan class=\\\"mord mtight\\\"\u003E\u003Cspan class=\\\"mord mtight\\\"\u003E0\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"vlist-s\\\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"vlist-r\\\"\u003E\u003Cspan class=\\\"vlist\\\" style=\\\"height:0.15em;\\\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2778em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mrel\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2778em;\\\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:0.6444em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord\\\"\u003E0\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C!-- HTML_TAG_END --\u003E. An image of how the Mandelbrot set looks as follows. Points shaded black are in the set. We are using the Mandelbrot set to benchmark our code.\u003C\u002Fp\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-1-mandel-renderer.png\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\u003Cp\u003EThe Mandelbrot Set is stunning. We highly recommend getting lost in its beauty using our rendering website (\u003Ca href=\\\"https:\u002F\u002Fmandelbrot-ascript.vercel.app\u002F\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fmandelbrot-ascript.vercel.app\u002F\u003C\u002Fa\u003E). Click to zoom and Shift + Click to zoom out.\u003C\u002Fp\u003E\\n\u003Ch2\u003EBenchmark Structure\u003C\u002Fh2\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fjs-wasm-mandelbrot-benchmark-3.vercel.app\u002F\\\" rel=\\\"nofollow\\\"\u003EThe benchmarking site\u003C\u002Fa\u003E is designed to display each iteration we developed with a rough estimate for performance measured in milliseconds. For each version, a function was written to perform the Mandelbrot calculations and return a JavaScript ImageData object that could be easily put on the Canvas. Once the user selects a version from the drop down menu, the corresponding function is called. Since the functions can take some time to complete, they are called from a Web-worker to prevent the main thread from freezing while the function runs. The performance is calculated using \u003Ccode\u003Eperformance.now()\u003C\u002Fcode\u003E calls before and after the function call that returns the ImageData object.\u003C\u002Fp\u003E\\n\u003Cp\u003EAcross all iterations, I used the following values:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.300283\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.48857\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.01\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_width\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_height\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E i32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E1000\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003E\u003Cstrong\u003EFOR MULTITHREADED\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_THREADS\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EWe assume that the canvas width and height are integers. To determine if a point was in the Mandelbrot set, we iterated the Mandelbrot function on the point up to \u003Ccode\u003EITER_CONST\u003C\u002Fcode\u003E, returning the number of times the function had iterated. We use the returned Mandelbrot value to set the color.\u003C\u002Fp\u003E\\n\u003Cp\u003EYou may notice that RGB values get clamped at 255, making it seem like the exercise of iterating all the way to 1000 is just for the sake of testing performance, which it is. (Here is a whole list of \u003Ca href=\\\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FPlotting_algorithms_for_the_Mandelbrot_set\\\" rel=\\\"nofollow\\\"\u003Esmarter and better coloring algorithms\u003C\u002Fa\u003E that we will not be using in this benchmarking exercise.)\u003C\u002Fp\u003E\\n\u003Cp\u003EAs of when this article was published, the following versions are available on the Benchmarking Site:\u003C\u002Fp\u003E\\n\u003Cul\u003E\u003Cli\u003ENaive JS single threaded\u003C\u002Fli\u003E\\n\u003Cli\u003ERust WASM using bindgen (single threaded)\u003C\u002Fli\u003E\\n\u003Cli\u003EAssemblyscript old version (single threaded, not thread safe)\u003C\u002Fli\u003E\\n\u003Cli\u003EAssemblyscript new version (single threaded, thread safe)\u003C\u002Fli\u003E\\n\u003Cli\u003EAssemblyscript SIMD WASM (singlethreaded, multithreaded)\u003C\u002Fli\u003E\\n\u003Cli\u003ENew JS(less memory allocation) singlethreaded\u003C\u002Fli\u003E\\n\u003Cli\u003ENew JS SharedMemoryBuffer multithreaded\u003C\u002Fli\u003E\u003C\u002Ful\u003E\\n\u003Cbr\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003EImplementing the Mandelbrot Set in JavaScript \u003Cem\u003Eby Abhinuv Allu\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\\n\u003Cdetails\u003E\u003Csummary\u003EClick to Read\u003C\u002Fsummary\u003E\\n\u003Cp\u003EI began the testing process with the web’s best frenemy, Javascipt.\u003C\u002Fp\u003E\\n\u003Cp\u003EI started with a naive approach to implement the Mandelbrot set in JavaScript and then try and optimize later. I started by creating a class for Complex numbers. This class would be able to add, multiply and return the magnitude. For the magnitude, I used a library function Math.hypot. Down below is our first initial implementation of the Complex class.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Econstructor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ereal\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E imag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E real\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E imag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FFunction that add this complex number with another complex number, cplx\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Eadd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ecplx\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FFuction that returns the magnitude of this complex number\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Emag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ecplx\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ehypot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FFunction that multiplies this complex number with another complex number, cplx\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Emul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ecplx\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E real_part \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E imag_part \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E real_part\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E imag_part\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe program iterated through each element of the canvas to compute whether or not they were in the Mandelbrot set.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ecplx\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E z \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E count \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Ewhile\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ez\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&lt;=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E2\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;&amp;\u003C\u002Fspan\u003E count \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\tz \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E z\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ez\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eadd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tcount\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThese data points were added to an array which is then painted onto the Canvas. I had some ideas about optimizations with help from the profiler, however the most fascinating insight was that the Math.hypot function for two numbers is an order of magnitude slower than squaring, adding, and then computing the square root. During the profiling of the initial code I found out that Math.hypot was taking up most of the time.\u003C\u002Fp\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-1-mandel-hypnot.png\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\\n\u003Ch3\u003EImproved JavaScript\u003C\u002Fh3\u003E\\n\u003Cp\u003ETo improve the initial naive approach, I decided to add multithreading. I started this with a naive way of having the worker compute each point and then send it back to receive the next point but, the message overhead was immense and resulted in a single threaded function as I only had one worker. The next step was experimenting with divisibility classes to add multiple workers. But this had the same problem where the overhead of sending &amp; receiving a message from the workers was just too much. Eventually, I figured out that I would have each worker compute a set number of rows at a time.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FThis is in the main function which calls the workers to do the work\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003EworkerCount\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E worker \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EWorker\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"worker.js\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EINDEXES_PER_WORKER\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efloor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003EworkerCount\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efloor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003EworkerCount\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_XC\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_INDEX\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EINDEXES_PER_WORKER\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EEND_INDEX\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_INDEX\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EINDEXES_PER_WORKER\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n  worker\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function-variable function\\\"\u003Eonmessage\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003Edata\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECOMPUTED_ROWS\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E data\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    points_array\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Ei\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECOMPUTED_ROWS\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n     doneCount\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EdoneCount \u003Cspan class=\\\"token operator\\\"\u003E==\u003C\u002Fspan\u003E workerCount\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n      points_array \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E points_array\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eflat\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\n      \u003Cspan class=\\\"token function\\\"\u003Edraw\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Epoints_array\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FThis is how it looks now in the worker function\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token function-variable function\\\"\u003Eonmessage\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E data \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_XC\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E data\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E points_in_thread \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EArray\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E2.0\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_XC\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tcount_x \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tx \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E2.0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\tpoints_in_thread\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Ecount_x \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E count_y\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ey\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E x\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003EpostMessage\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Epoints_in_thread\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Ch3\u003EShared Buffer\u003C\u002Fh3\u003E\\n\u003Cp\u003ESince all the points would be added to the same array it would make sense that having a shared buffer to reduce the overhead needed to send array points would decrease the compute time. So I added a shared buffer that was formatted like an ImageData object so it would be easier to paint it onto the canvas. This required some rewriting of the some steps here and there, but it ended up being faster.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe other issue with using a Shared Buffer is that I had to add promises to the code, so werefactored it to include promises.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FThis is in the main function which calls the workers to do the work\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EPromise\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Eresolve\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E worker \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EWorker\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"benchmarks\u002Fmultithreaded-js\u002Fsharedworker.js\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    worker\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EpostMessage\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Eparameters\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    worker\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function-variable function\\\"\u003Eonmessage\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n      \u003Cspan class=\\\"token function\\\"\u003Eresolve\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"worker finished\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003EreturnSharedBufferjs\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECANVAS_WIDTH\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECANVAS_HEIGHT\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECANVAS_WIDTH\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECANVAS_HEIGHT\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E window \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E window\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E window\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E workerCount \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E sharedBuffer \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003ESharedArrayBuffer\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E sharedArray \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EUint8ClampedArray\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EsharedBuffer\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  sharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efill\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efloor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003EworkerCount\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n  \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E parameters \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E sharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E promises \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n  \u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003EworkerCount\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\n    parameters\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    promises\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Epush\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EcreateWorker\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Eparameters\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FThis is how it looks now in the worker function\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token function-variable function\\\"\u003Eonmessage\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E data \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\tsharedArray\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E data\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tcount_y \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\ty \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E index \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecount_x \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\\tval \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E y\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\\tsharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Eindex \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E val\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\\tsharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Eindex \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E val\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\\tsharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Eindex \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E val\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\\tsharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Eindex \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003EpostMessage\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E'done'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThese changes made the code perform a lot better. You can check out it’s performance in the ”\u003Ca href=\\\"https:\u002F\u002Fwww.notion.so\u002FOn-WebAssembly-Performance-and-the-Mandelbrot-WORKING-TITLE-96760f3f113343c894c00f52cdef3ef0\\\" rel=\\\"nofollow\\\"\u003EResults\u003C\u002Fa\u003E” section. JavaScript was extremely performant (especially on Chrome) and gave us hope that pushing the boundaries of speed on the web was possible.\u003C\u002Fp\u003E\u003C\u002Fdetails\u003E\\n\u003Cbr\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003ESo, What is Webassembly? \u003Cem\u003Eby Abhishek Cherath\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\\n\u003Cdetails\u003E\u003Csummary\u003EClick to Read\u003C\u002Fsummary\u003E\\n\u003Cp\u003EIn our quest to further optimize performance, we used webassembly, an emerging web technology optimized for what we are trying to achieve. So, what is it?\\nInsofar as an overview is concerned, nothing beats Lin Clark’s cartoon intro \u003Ca href=\\\"https:\u002F\u002Fhacks.mozilla.org\u002F2017\u002F02\u002Fa-cartoon-intro-to-webassembly\u002F\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E, and the MDN docs \u003Ca href=\\\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWebAssembly\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E. Put simply, webassembly is a low level typed language that targets the browser’s VM. For some reasons[1] , it’s very quick and easy to compile into decently fast machine code.\u003C\u002Fp\u003E\\n\u003Cp\u003EFundamentally, the language was designed to offer the best possible latency (time to execution) and speed of execution. Low latency is achieved by having a small binary representation (vs javascript’s textual representation) and having type definitions and a function table at the start of a .wasm module, which allows compilers to compile in a streaming fashion, instead of needing to have access to the entire file before starting.\u003C\u002Fp\u003E\\n\u003Cp\u003ESpeed of execution requires slow compilation with multiple passes for the compiler to accurately assess the best register allocation, optimize out unnecessary instructions and do whatever other things compilers do. (\u003Cem\u003Enote: I have frankly no idea what goes into compiler optimization, I just know it takes time\u003C\u002Fem\u003E)\u003C\u002Fp\u003E\\n\u003Cp\u003ETo satisfy both these goals, browsers (atleast Firefox and Chrome) have two compilers for webassembly, the first compiles the module as it’s called from the network, and is basically instant (\u003Ca href=\\\"https:\u002F\u002Fv8.dev\u002Fdocs\u002Fwasm-compilation-pipeline\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E, chrome devs claim that theirs can do on the order of 10+ mb of code per second, so the bottleneck will almost always be the speed of the network rather than the compiler.) The second does optimization and dynamically replaces the unoptimized bytecode from the first when it’s done.\u003C\u002Fp\u003E\\n\u003Cp\u003EIt’s interesting to note here that, \u003Cem\u003Ea priori\u003C\u002Fem\u003E there’s no reason to expect that webassembly code for high performance stuff [2] (like fractal calculation) will be any faster than its javascript counterpart. Since the hot loop (calculating escape time) is running many thousands of times, one would expect the javascript JIT compiler to infer the output types and get basically similar bytecode, while amortizing its greater overhead considering workload size.\u003C\u002Fp\u003E\\n\u003Cp\u003EIn a later article, I will be examining this conjecture, and taking a deeper look at the flamegraphs and bytecode generated by our benchmarks.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe other interesting thing about webassembly is its memory model, programs do not have access to their own instructions and stack machine memory (so no self modifying code, and no messing with values on the stack). What they do have access to is a block of linear memory, which is backed by a javascript ArrayBuffer, and byte addressed (ie. memory[0] is 1 byte long.)\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003E[1]I’m not entirely sure why, but it’s some combination of coding for a simple stack machine, having type information, linear memory, and being easy to parse.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003E[2]This is \u003Cstrong\u003Emostly\u003C\u002Fstrong\u003E true, except for vectorization. SIMD (Single Instruction Multiple Data) instructions are featured in the webassembly spec and implemented by chrome and firefox, which do not expose them in js, and have no plans to do so. (although\u003C\u002Fem\u003E I \u003Cem\u003Esuppose there’s nothing stopping a JIT from autovectorizing, is there?)\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Fdetails\u003E\\n\u003Cbr\u003E\u003Cbr\u003E\\n\u003Cblockquote\u003E\u003Cp\u003E\u003Cstrong\u003EOur Approach to webassembly\u003C\u002Fstrong\u003E: As many languages can be compiled to webassembly, we looked at two of the most commonly used ones: Rust &amp; AssemblyScript. In the following sections we will describe our approach to these two languages.\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\\n\u003Cbr\u003E\u003Cbr\u003E\\n\u003Ch2\u003ERust Implementation \u003Cem\u003Eby Jo Gao\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\\n\u003Cdetails\u003E\u003Csummary\u003EClick to Read\u003C\u002Fsummary\u003E\\n\u003Ch3\u003ESinglethreaded\u003C\u002Fh3\u003E\\n\u003Cp\u003EI wrote a similar implementation of the function in Rust that would return an ImageData object of the Mandelbrot Set. It uses \u003Ca href=\\\"https:\u002F\u002Frustwasm.github.io\u002Fwasm-bindgen\u002F\\\" rel=\\\"nofollow\\\"\u003Ewasm-bindgen\u003C\u002Fa\u003E, a Rust library that will compile Rust code to webassembly, and then generate the bindings and glue between JavaScript and webassembly so that it can be run on the web. It handles all the type conversions between JavaScript and webassembly and facilitates the compilation of Rust to webassembly.\u003C\u002Fp\u003E\\n\u003Cp\u003EIn the iterative \u003Ccode\u003Ein_mandelbrot\u003C\u002Fcode\u003E function, \u003Ccode\u003Ecount\u003C\u002Fcode\u003E is set to iterate all the way to 1000 for benchmarking purposes. When returning, \u003Ccode\u003Ecount\u003C\u002Fcode\u003E is set to 255 if larger than 255 to prevent having to cast numbers larger than 255 to u8.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-rust\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-rust\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Efn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function-definition function\\\"\u003Ein_mandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E-\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu8\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E1000\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Emut\u003C\u002Fspan\u003E z \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ebuild_complex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Emut\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Ewhile\u003C\u002Fspan\u003E z\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&lt;=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E2.0\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;&amp;\u003C\u002Fspan\u003E count \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n        z \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ez\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Esquare\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eadd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002F z = z^2 + cplx\u003C\u002Fspan\u003E\\n        count \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E count \u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E255\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n        count \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n    count \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu8\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe magic of wasm-bindgen kicks in here, allowing us to create the ImageData object right in the Rust code by providing the type and the constructor signature:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-rust\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-rust\\\"\u003E\u003Cspan class=\\\"token attribute attr-name\\\"\u003E#[wasm_bindgen]\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Eextern\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\"C\\\"\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Epub\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Etype\u003C\u002Fspan\u003E \u003Cspan class=\\\"token type-definition class-name\\\"\u003EImageData\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token attribute attr-name\\\"\u003E#[wasm_bindgen(constructor, catch)]\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Efn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function-definition function\\\"\u003Enew\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Edata\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token class-name\\\"\u003EUint8ClampedArray\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E width\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E height\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E-\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EResult\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token class-name\\\"\u003EImageData\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EJsValue\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token attribute attr-name\\\"\u003E#[wasm_bindgen]\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Epub\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function-definition function\\\"\u003Erun\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Estart_x\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E start_y\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E width\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E height\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E window\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E-\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EImageData\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E y_len\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E height \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E x_len\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E width \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E pixels\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eusize\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ex_len \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E y_len\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eusize\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Emut\u003C\u002Fspan\u003E points_array \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token macro property\\\"\u003Evec!\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E pixels\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token function\\\"\u003Efill_mandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Emut\u003C\u002Fspan\u003E points_array\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E start_x\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E start_y\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E x_len\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E y_len\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E window\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E pointer \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E points_array\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eas_ptr\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eusize\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E mem \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token namespace\\\"\u003Ewasm_bindgen\u003Cspan class=\\\"token punctuation\\\"\u003E::\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ememory\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eunchecked_into\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token class-name\\\"\u003EWebAssembly\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\\\"token class-name\\\"\u003EMemory\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E new_array \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EUint8ClampedArray\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Enew\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Emem\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ebuffer\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eslice\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Epointer \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Epointer \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E pixels\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token class-name\\\"\u003EImageData\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Enew\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Enew_array\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E x_len\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Einto\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E y_len\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Einto\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eunwrap\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EAfter compiling this code, wasm-bindgen outputs a number of files that are meant to be bundled using \u003Ca href=\\\"https:\u002F\u002Fwebpack.js.org\u002F\\\" rel=\\\"nofollow\\\"\u003EWebpack\u003C\u002Fa\u003E and imported to your JavaScript file as an ES6 module, allowing access to the functions that were written in Rust. The idea is that after compiling and importing the module, calling \u003Ccode\u003Erun(...)\u003C\u002Fcode\u003Ewould return a whole JavaScript ImageData Object.\u003C\u002Fp\u003E\\n\u003Cp\u003EUnfortunately, our Benchmarking Site is structured to use a web worker to call this function. Modules cannot be imported to web workers. However, they can be imported to module workers, web workers that support module import, but as of today, Firefox does not support this feature.\u003C\u002Fp\u003E\\n\u003Cp\u003EThis is an infeasible solution because I was unwilling to limit the availability of our benchmark site for this implementation. After many hours of tinkering with the existing setup, I found a workaround that eliminated the need for Webpack altogether: after compiling with wasm-bindgen, I copy and pasted the entire outputted .js file with the import and exports removed, appended the wrapper function I had written to it, and called \u003Ccode\u003Einit(...)\u003C\u002Fcode\u003E on the outputted .wasm.\u003C\u002Fp\u003E\\n\u003Cp\u003EAfter confirming that this worked, A colleague and I wrote a shell script to automatically do this after compilation. Albeit a little unpleasant on the eyes, it does the job:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-bash\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-bash\\\"\u003E\u003Cspan class=\\\"token function\\\"\u003Esed\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'\u002FimportW\u002Fd;s\u002F^export\u002F\u002Fg;\u002Fdefault\u002Fd'\u003C\u002Fspan\u003E pkg\u002FMandelbrot.js \u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E tmp_mandel_import.js\\n\u003Cspan class=\\\"token function\\\"\u003Ecat\u003C\u002Fspan\u003E tmp_mandel_import.js  mandel_src.js \u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E Mandelbrot.js\\n\u003Cspan class=\\\"token function\\\"\u003Erm\u003C\u002Fspan\u003E tmp_mandel_import.js\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Ch3\u003ERust &amp; Webassembly Multi-Threaded\u003C\u002Fh3\u003E\\n\u003Cp\u003ETo further improve performance in Rust, I carried out the same calculations, but in parallel this time. An advantage of the Mandelbrot Set is that determining whether a pixel falls within the set or not can be done completely independently of other pixels. The outcome of each pixel has no effect on the others, making the transition to multithreading straightforward.\u003C\u002Fp\u003E\\n\u003Cp\u003EI used the \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Frustwasm\u002Fwasm-bindgen\u002Ftree\u002Fmaster\u002Fexamples\u002Fraytrace-parallel\\\" rel=\\\"nofollow\\\"\u003EParallel Raytracing example\u003C\u002Fa\u003E. given in the Wasm-Bindgen repo, as a starting point. Using a combination of web workers and the Rayon Crate for data parallelism in Rust yielded a pretty fast multithreaded Mandelbrot Set.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003EUnfortunately,\u003C\u002Fem\u003E I \u003Cem\u003Ewas unable to include this version of the Mandelbrot in the final Benchmarking website\u003C\u002Fem\u003E because I ran into a similar problem with the wasm-bindgen and module output. This time, it was further complicated by the Webworkers being created from within the Rust code. The funky workaround that had allowed for the singlethreaded RustWasm example to run on the Benchmarking Site failed to work the same magic for this implementation.\u003C\u002Fp\u003E\\n\u003Cp\u003EThis version of the Mandelbrot also makes use of the SharedArrayBuffer, and had it been on the site, would not work in Safari and browsers that do not support SharedArrayBuffer Objects.\u003C\u002Fp\u003E\u003C\u002Fdetails\u003E\\n\u003Cbr\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003EAssemblyScript \u003Cem\u003Eby Abhishek Cherath\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\\n\u003Cdetails\u003E\u003Csummary\u003EClick to Read\u003C\u002Fsummary\u003E\\n\u003Cp\u003EAssemblyScript compiles a subset of typescript to webassembly. To get an idea of how simple it is to write it, here’s essentially the same javascript code from earlier, with type annotations and minor changes for webassembly:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003Edeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ecanvas_width\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E i32\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\ndeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ecanvas_height\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E i32\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\ndeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E i16\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\ndeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32\\ndeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32\\ndeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32\\n\\n@unmanaged\\n\u003Cspan class=\\\"token keyword\\\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token literal-property property\\\"\u003Ereal\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token literal-property property\\\"\u003Eimag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token function\\\"\u003Econstructor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Ereal\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Eimag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E real\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E imag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\\t@inline\\n\\t\u003Cspan class=\\\"token function\\\"\u003Eadd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E Complex\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E Complex \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\\t@inline\\n\\t\u003Cspan class=\\\"token function\\\"\u003Emag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f64 \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Esqrt\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\\t@inline\\n\\t\u003Cspan class=\\\"token function\\\"\u003Emul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E Complex\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E Complex \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E __tempr  \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E __tempi \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E __tempr\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E __tempi\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token function\\\"\u003Eset\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Eimag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E real\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E imag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003EComplex \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ecplx\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003EComplex \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\\n@inline\\n\u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Ereal\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Eimag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ei16\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\tz\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eset\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\\tcplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eset\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ecount\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ei16 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E z\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&lt;=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ez\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ez\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eadd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002F z = z^2 + cplx\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecount \u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token comment\\\"\u003E\u002F*\\nstores array of i16s at start of memory\\ncorresponding to escape count at pixels in\\narray\\n*\u002F\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ecompute\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E memcounter \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_width\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_height\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E canvas_height\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E step_Y\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E canvas_width\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E step_X\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\tstore\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ei16\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(memcounter, mandelbrot(x,y));\\n\\t\\t\\tmemcounter += 2\\n\\t\\t&#125;\\n\\t&#125;\\n&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe only really noteworthy change was to not have \u003Ccode\u003Enew\u003C\u002Fcode\u003E in the hot loop. The Assemblyscript garbage collector had some trouble with it and total allocation would exceed webassembly’s 100 page memory limit[1]. I suspect that sort of code will be usable once the webassembly GC proposals, which allow wasm modules to hook into the browser’s GC, are implemented.\u003C\u002Fp\u003E\\n\u003Ch3\u003EThreading\u003C\u002Fh3\u003E\\n\u003Cp\u003EThe fastest way to thread code in browsers is to use \u003Ca href=\\\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FJavaScript\u002FReference\u002FGlobal_Objects\u002FSharedArrayBuffer\\\" rel=\\\"nofollow\\\"\u003ESharedArrayBuffer\u003C\u002Fa\u003E, this also requires the following CORS headers.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003ECross\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EOrigin\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EOpener\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EPolicy\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E same\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Eorigin\\nCross\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EOrigin\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EEmbedder\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EPolicy\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E require\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Ecorp\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThis is to ensure cross-origin isolation, which protects against memory being exfiltrated somehow (I might explore this in the future, but that’s about all I know for the moment.) webassembly memories can also be created with a backing SharedArrayBuffer, which allows fast multithreading, as separate web-workers can run the same webassembly module and write their results to the same memory, meaning that large objects don’t need to be passed around using postmessage, and the many O(N) overheads to do with copying and creating new arrays can be avoided.\u003C\u002Fp\u003E\\n\u003Cp\u003EHowever, while Assemblyscript \u003Ca href=\\\"https:\u002F\u002Fwww.assemblyscript.org\u002Fstdlib\u002Fbuiltins.html#atomics-%F0%9F%A6%84\\\" rel=\\\"nofollow\\\"\u003Eallows\u003C\u002Fa\u003E access to atomic instructions, it does not implement any sort of locking. So any program that reads and writes to memory will need to be adjusted to thread with shared memory. This means that the program seen above, with its Complex class and set calls reading and wrxiting to the linear memory quite often, is very prone to… interesting behaviour when threaded.\u003C\u002Fp\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-1-mandel-glitch.png\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\\n\u003Cp\u003EExhibit A of nondeterministic behavior\u003C\u002Fp\u003E\\n\u003Cp\u003EThat being said, for small examples such as fractal calculation, it’s quite easy to limit mutability to local variables (which are on the stack, not in the linear memory, and so are not shared) and avoid the problem entirely. Like in the following code:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E@inline\\n\u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Ec_r\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ec_i\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ei16\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ecount\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ei16 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ez_r\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ez_i\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Et_r\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Et_i\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E z_r\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_r \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E z_i\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_i \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\tt_r \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E z_r\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_r \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E z_i\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_i \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E c_r\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tt_i \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_i\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_r \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E c_i\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tz_r \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E t_r\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tz_i \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E t_i\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecount \u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token comment\\\"\u003E\u002F*\\nstores array of i16s at start of memory\\ncorresponding to escape count at pixels in\\narray\\n*\u002F\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ecompute\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E memcounter \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_width\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_height\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E canvas_height\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E step_Y\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E canvas_width\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E step_X\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\tstore\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ei16\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(memcounter, mandelbrot(x,y));\\n\\t\\t\\tmemcounter += 2\\n\\t\\t&#125;\\n\\t&#125;\\n&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003E\u003Cem\u003Enote that the store instruction there might look like it would cause issues, but as long as threads work on different parts of the image, that should not be a problem.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Ch3\u003ESIMD\u003C\u002Fh3\u003E\\n\u003Cp\u003ESIMD (Single Instruction Multiple Data) instructions are special instructions on the CPU that allow multiple additions, multiplications etc to be carried out in parallel on the same core)\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cimg src=\\\"https:\u002F\u002Fupload.wikimedia.org\u002Fwikipedia\u002Fcommons\u002Fc\u002Fce\u002FSIMD2.svg\\\" alt=\\\"SIMD Explaination\\\"\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EBy Vadikus - Own work, CC BY-SA 4.0, \u003Ca href=\\\"https:\u002F\u002Fcommons.wikimedia.org\u002Fw\u002Findex.php?curid=39715273\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fcommons.wikimedia.org\u002Fw\u002Findex.php?curid=39715273\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EThey’re not in the webassembly spec as yet, but should be \u003Ca href=\\\"https:\u002F\u002Fwebassembly.github.io\u002Fsimd\u002Fcore\u002Fexec\u002Finstructions.html#simd-instructions\\\" rel=\\\"nofollow\\\"\u003Esoon\u003C\u002Fa\u003E, and are currently available on chrome and firefox (although not on ARM in firefox 89, ie. apple M1.) Assemblyscript does not autovectorize code, but \u003Ca href=\\\"https:\u002F\u002Fwww.assemblyscript.org\u002Fstdlib\u002Fbuiltins.html#simd-%F0%9F%A6%84\\\" rel=\\\"nofollow\\\"\u003Eallows\u003C\u002Fa\u003E access to the instructions, and provides some sugar for different types and functions to initialise constant vectors.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe vector size in the proposal is 128 bit, which is a decent compromise and is backed by hardware instructions on most modern computers. In the future, \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002FWebAssembly\u002Fflexible-vectors\\\" rel=\\\"nofollow\\\"\u003Eflexible vectors\u003C\u002Fa\u003E, should be able to allow access to 256, 512 bit vectors that modern intel and AMD CPUs support (consumer ARM chips currently only have 128 bit vectors, as far as I’m aware, although \u003Ca href=\\\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FAArch64#Scalable_Vector_Extension_(SVE)\\\" rel=\\\"nofollow\\\"\u003Esupercomputer ARM chips do have 512 bit vectors\u003C\u002Fa\u003E.)\u003C\u002Fp\u003E\\n\u003Cp\u003EVectorizing the mandelbrot code above is not too bad, althought it does look rather messy:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E@inline\\n\u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot_simd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Ec_rl\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ev128\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Ec_il\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ev128\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ev128\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ein_set\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E v128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ei32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ez_r\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E v128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ez_i\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E v128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Et_r\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E v128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Et_i\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E v128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E ones \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ei32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E fours \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONSTS\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ev128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E v128\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Esplat\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ei32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(ITER_CONST);\\n    let count:v128=i32x4(0,0,0,0)\\n    for(\\n        let total_count:i32 = 0, any_in_convergence_region:boolean = true;\\n        any_in_convergence_region &amp;&amp;\\n        total_count &lt; ITER_CONST;\\n        total_count++;\\n    ) \u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n        z_i \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E v128\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eadd\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(c_il, v128.mul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(v128.add\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(z_r,z_r),z_i));\\n        z_r = v128.add\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(c_rl, v128.sub\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(t_r,t_i));\\n        t_r = v128.mul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(z_r,z_r);\\n        t_i = v128.mul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(z_i,z_i);\\n        const mask = v128.le\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(v128.add\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(t_r,t_i),fours);\\n        any_in_convergence_region = v128.any_true(mask);\\n        count = v128.add\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ei32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(count, v128.and(ones,mask));\\n    &#125;\\n    return count;\\n&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThis should basically be a 4x speedup over the previous code, when run single threaded. Multithreaded, that number will vary depending on how threads are allocated, as work only gets completed as fast as the slowest thread.\u003C\u002Fp\u003E\\n\u003Ch3\u003ECompiler Flags\u003C\u002Fh3\u003E\\n\u003Cp\u003EFor the examples above, some memory is reserved for the purposes of storing the image, in assemblyscript this is achieved by passing the \u003Ccode\u003E--memoryBase\u003C\u002Fcode\u003E flag to the \u003Ccode\u003Easc\u003C\u002Fcode\u003E compiler (as seen in the makefile below)\u003C\u002Fp\u003E\\n\u003Cp\u003EThe other flags are tuned for maximum performance (thanks to \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002FMaxGraey\\\" rel=\\\"nofollow\\\"\u003EMax Graey\u003C\u002Fa\u003E for -O3 instead of -O3s\u002Fz) and to enable necessary features (threads, SIMD.)\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-makefile\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-makefile\\\"\u003EMEMORY_FLAGS \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E --maximumMemory 80 --importMemory --noExportMemory --initialMemory 80 --memoryBase 4000000\\nOPTIMIZATION_FLAGS \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E -O3 --converge\\nDEBUG_FLAGS \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E --sourceMap\\nFEATURE_FLAGS \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E --enable simd --enable threads\\nRUNTIME_FLAGS \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E --runtime stub\\n\u003Cspan class=\\\"token target symbol\\\"\u003Estart\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E install\\n\\tnpx asc assembly\u002Fmandel_final.ts -b build\u002Fmandel_final.wasm -t build\u002Fmandel_final.wat \u003Cspan class=\\\"token variable\\\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EOPTIMIZATION_FLAGS\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token variable\\\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EMEMORY_FLAGS\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token variable\\\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EFEATURE_FLAGS\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token variable\\\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003ERUNTIME_FLAGS\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token variable\\\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EDEBUG_FLAGS\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token target symbol\\\"\u003Einstall\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E\\n\\tnpm i\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Ch3\u003EMultithreaded SIMD Speed\u003C\u002Fh3\u003E\\n\u003Cp\u003EBenchmark results will be discussed near the end of this article, but the speed of the multithreaded SIMD code is quite astonishing, roughly 3x the speed of multithreaded JS using sharedarraybuffers, and I’m guessing that’s held back by module message passing overheads. \u003Ca href=\\\"https:\u002F\u002Fmandelbrot-ascript.vercel.app\u002F\\\" rel=\\\"nofollow\\\"\u003EHERE\u003C\u002Fa\u003E is a basic mandelbrot zoom implementation using it (only works in firefox(≥90 on apple m1) and chrome, \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fpretentious7\u002Fmandelbrot-ascript\\\" rel=\\\"nofollow\\\"\u003Ehere’s\u003C\u002Fa\u003E the github repo.) I’ll be working in boundary estimation and period checking along with xaos zoom algorithm into it in a couple of months, so stay tuned for that!\u003C\u002Fp\u003E\\n\u003Cp\u003EI’m also fairly certain that this is the first(?) SIMD mandelbrot implementation for webassembly, so if anyone wants to use it for anything (under the terms of the GPLv3 License) feel free!\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003E[1] A page being 64KiB (65,536 bytes), so about 6.5 mb max memory\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Fdetails\u003E\\n\u003Cbr\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003EResults\u003C\u002Fh2\u003E\\n\u003Cp\u003EFirst, we know that our benchmarks here are not rigorous in the slightest. Their purpose was to give us an idea of the rough performance capabilities of the tools we’re working with, to help inform our choices as we port certain programs (stay tuned!) to webassembly. We will be refining this tool in the future, and hope to have (somehow) bytecode outputs and flamegraphs on the site.\u003C\u002Fp\u003E\\n\u003Ctable\u003E\u003Cthead\u003E\u003Ctr\u003E\u003Cth\u003EBenchmark\u003C\u002Fth\u003E\\n\u003Cth\u003EFirefox 89(ms)\u003C\u002Fth\u003E\\n\u003Cth\u003EChrome 91 (ms)\u003C\u002Fth\u003E\u003C\u002Ftr\u003E\u003C\u002Fthead\u003E\\n\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003ENaive-js\u003C\u002Ftd\u003E\\n\u003Ctd\u003E2992\u003C\u002Ftd\u003E\\n\u003Ctd\u003E631\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003EImproved-js\u003C\u002Ftd\u003E\\n\u003Ctd\u003E1755\u003C\u002Ftd\u003E\\n\u003Ctd\u003E292\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003EMultithreaded-js\u003C\u002Ftd\u003E\\n\u003Ctd\u003E705\u003C\u002Ftd\u003E\\n\u003Ctd\u003E129\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003ESinglethreaded-Rust * **\u003C\u002Ftd\u003E\\n\u003Ctd\u003E296\u003C\u002Ftd\u003E\\n\u003Ctd\u003E300\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003ESimple Assemblyscript\u003C\u002Ftd\u003E\\n\u003Ctd\u003E494\u003C\u002Ftd\u003E\\n\u003Ctd\u003E497\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003EOptimized non-SIMD AssemblyScript\u003C\u002Ftd\u003E\\n\u003Ctd\u003E250\u003C\u002Ftd\u003E\\n\u003Ctd\u003E262\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003EOptimized SIMD AssemblyScript\u003C\u002Ftd\u003E\\n\u003Ctd\u003E124\u003C\u002Ftd\u003E\\n\u003Ctd\u003E108\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003ESIMD Multithreaded AssemblyScript\u003C\u002Ftd\u003E\\n\u003Ctd\u003E43\u003C\u002Ftd\u003E\\n\u003Ctd\u003E43\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\\n\u003Cp\u003E\u003Cem\u003EAll numbers approximate, gathered from fresh browser session after reboot on an HP Envy 13 with an i5-8265U CPU @ 1.60GHz and 8gb of RAM running Ubuntu 20.04.2 with kernel 5.8.0. Average of 5 runs (first 2 runs dropped)\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EThe results of our benchmark (at least approximately) line up with what one would expect, but we find a few items of interest. First, as far as the javascript implementations are concerned, Firefox is \u003Cem\u003Esignificantly\u003C\u002Fem\u003E slower than chrome. Second, webassembly speeds are comparable for both browsers.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe performance advantage of webassembly (without SIMD) over javascript for this benchmark is basically negligible for chrome. In a future article it’ll be interesting to see whether the bytecode generated is also similar.\u003C\u002Fp\u003E\\n\u003Cp\u003EBut the key insight here is clear, webassembly offers \u003Cem\u003Epredictable\u003C\u002Fem\u003E performance, across browser engines. We’ll be adding fallbacks for safari later to see if this holds there as well. Further, we’ll compare the results to native code.\u003C\u002Fp\u003E\\n\u003Cp\u003E*\u003Cem\u003EThe rust code can likely be sped up with some optimizations here and there, but for a rough effort from a novice rust programmer, this is representative.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003E** The rust code was improved by @MaxGraey and now lines up with what one would expect\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003ESee the demo \u003Ca href=\\\"https:\u002F\u002Fjs-wasm-mandelbrot-benchmark-3.vercel.app\u002F\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003EFinal Thoughts\u003C\u002Fh2\u003E\\n\u003Cp\u003EAs tools of application distribution, browsers have some undeniable advantages over the traditional pipeline of download → extract onto disk → load from disk for execution. For most programs, it is technically unnecessary to have \u003Cem\u003Eall\u003C\u002Fem\u003E of their assets present to be able to enjoy some subset of their capabilities. Of course, adding such partial update capabilities is non-trivial, and would add significant complexity. But web developers and browser vendors have made a lot of progress in enabling this essentially by default, and with webassembly, enabling it in areas where it’s not previously been feasible.\u003C\u002Fp\u003E\\n\u003Cp\u003EFurther, cloud offloading enables users to easily sustain state across devices and in some cases avoid calculation heavy code in the interests of battery life or smooth performance. The easiest way to realize these advantages is to distribute one’s application in an environment that does this \u003Cem\u003Eby default\u003C\u002Fem\u003E: the browser. But a prerequisite for this is that the experience is not overly hampered by being in the browser, and bringing webassembly to near native performance is a key part of that.\u003C\u002Fp\u003E\\n\u003Cp\u003EThere is an opportunity here to allow people to access performance heavy applications like games and simulations on their devices without having to get into the nasty business of managing local state, which accounts for what, 99% of problems installing and using software? We want to help build this, and over the next few weeks, will be releasing demos to show what it might look like, so stay tuned!\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003EOf course, the possible bad end here is that the canvas ends up as an inefficient GUI toolkit to have fungible programmers at the cost of user experience, we hope that doesn’t happen.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003EFurther Reading:\u003C\u002Fh2\u003E\\n\u003Cp\u003EDavid Beazley. (2019). A Talk Near the Future of Python (a.k.a., Dave live-codes a Webassembly Interpreter). \u003Ca href=\\\"https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=r-A78RgMhZU\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fwww.youtube.com\u002Fwatch?v=r-A78RgMhZU\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EFirefox’s low-latency webassembly compiler – wingolog. (n.d.). Retrieved June 19, 2021, from \u003Ca href=\\\"https:\u002F\u002Fwingolog.org\u002Farchives\u002F2020\u002F03\u002F25\u002Ffirefoxs-low-latency-webassembly-compiler\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fwingolog.org\u002Farchives\u002F2020\u002F03\u002F25\u002Ffirefoxs-low-latency-webassembly-compiler\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003Efirefox’s low-latency webassembly compiler—Wingolog. (n.d.). Retrieved June 19, 2021, from \u003Ca href=\\\"https:\u002F\u002Fwingolog.org\u002Farchives\u002F2020\u002F03\u002F25\u002Ffirefoxs-low-latency-webassembly-compiler\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fwingolog.org\u002Farchives\u002F2020\u002F03\u002F25\u002Ffirefoxs-low-latency-webassembly-compiler\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EPereira, F. M. Q., &amp; Palsberg, J. (2006). Register Allocation After Classical SSA Elimination is NP-Complete. In L. Aceto &amp; A. Ingólfsdóttir (Eds.), Foundations of Software Science and Computation Structures (Vol. 3921, pp. 79–93). Springer Berlin Heidelberg. \u003Ca href=\\\"https:\u002F\u002Fdoi.org\u002F10.1007\u002F11690634_6\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fdoi.org\u002F10.1007\u002F11690634_6\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EWebAssembly. (n.d.). Retrieved June 19, 2021, from \u003Ca href=\\\"https:\u002F\u002Fwebassembly.org\u002F\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fwebassembly.org\u002F\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EWebAssembly compilation pipeline · V8. (n.d.). Retrieved June 19, 2021, from \u003Ca href=\\\"https:\u002F\u002Fv8.dev\u002Fdocs\u002Fwasm-compilation-pipeline\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fv8.dev\u002Fdocs\u002Fwasm-compilation-pipeline\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003EOjasvin Kirpane, Abhishek Cherath, Jo Gao &amp; Abhinuv Allu\u003C\u002Fem\u003E\u003C\u002Fp\u003E\",\"css\":{\"code\":\"\",\"map\":null},\"head\":\"\u003Clink rel=\\\"stylesheet\\\" href=\\\"https:\u002F\u002Fcdn.jsdelivr.net\u002Fnpm\u002Fkatex@0.12.0\u002Fdist\u002Fkatex.min.css\\\" integrity=\\\"sha384-AfEj0r4\u002FOFrOo5t7NnNe46zW\u002FtFgW6x\u002FbCJG8FqQCEo3+Aro6EYUG4+cU+KJWu\u002FX\\\" crossorigin=\\\"anonymous\\\" data-svelte=\\\"svelte-r30au3\\\"\u003E\u003Clink rel=\\\"stylesheet\\\" href=\\\"https:\u002F\u002Fcdn.jsdelivr.net\u002Fnpm\u002Fkatex@0.12.0\u002Fdist\u002Fkatex.min.css\\\" integrity=\\\"sha384-AfEj0r4\u002FOFrOo5t7NnNe46zW\u002FtFgW6x\u002FbCJG8FqQCEo3+Aro6EYUG4+cU+KJWu\u002FX\\\" crossorigin=\\\"anonymous\\\" data-svelte=\\\"svelte-r30au3\\\"\u003E\",\"readingTime\":\"42 min read\"}]},{\"slug\":\"2-webgl\",\"title\":\"WebGL with Emscripten: The Bare Minimum\",\"date\":\"2021-08-03T00:00:00.000Z\",\"summary\":\"Illustrating the bare minimum required to get WebGL up and running in C with the Emscripten compiler.\",\"thumbnail\":\"\u002Fblog-2-tri-thumbnail.webp\",\"tags\":[\"Engineering\"],\"author\":\"Jo Gao\",\"html\":\"\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-2-tri-thumbnail.webp\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\\n\u003Cp\u003EThe following article is something of a hybrid between the first \u003Ca href=\\\"https:\u002F\u002Femscripten.org\u002Fdocs\u002Fgetting_started\u002FTutorial.html\\\" rel=\\\"nofollow\\\"\u003EEmscripten tutorial\u003C\u002Fa\u003E and the \u003Ca href=\\\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FAPI\u002FWebGL_API\u002FTutorial\u002FGetting_started_with_WebGL\\\" rel=\\\"nofollow\\\"\u003EGetting Started with WebGL tutorial\u003C\u002Fa\u003E. It builds on the previous documentation to demonstrate how to render the same content in the WebGL tutorial, but in C.\u003C\u002Fp\u003E\\n\u003Cp\u003EThis is not an Introduction to C programming or WebGL, so a basic understanding of both will be helpful. If you are new to WebGL, I would recommend at least skimming the Getting Started with WebGL tutorial linked above.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe focus of this article is to illustrate the bare minimum required to get WebGL up and running in C with the Emscripten compiler. And thus, if you do not yet have Emscripten installed, I would suggest doing so now from their \u003Ca href=\\\"https:\u002F\u002Femscripten.org\u002Fdocs\u002Fgetting_started\u002Fdownloads.html\\\" rel=\\\"nofollow\\\"\u003Edownload page\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe Github repo for this tutorial is available on our \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002FAO-Design-Inc\u002FwebGL-with-emscripten\\\" rel=\\\"nofollow\\\"\u003EGithub\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Ch2\u003EHTML File\u003C\u002Fh2\u003E\\n\u003Cp\u003EThe following is a barebones HTML file with a canvas element. The \u003Ccode\u003Eindex.js\u003C\u002Fcode\u003E script after the canvas is the file that will be generated from compiling the C code.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-html\\\"\u003E&lt;!DOCTYPE html&gt;\\n&lt;html lang=&quot;en&quot;&gt;\\n\\t&lt;head&gt;\\n\\t\\t&lt;meta charset=&quot;UTF-8&quot; \u002F&gt;\\n\\t\\t&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot; \u002F&gt;\\n\\t\\t&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; \u002F&gt;\\n\\t\\t&lt;title&gt;Document&lt;\u002Ftitle&gt;\\n\\t&lt;\u002Fhead&gt;\\n\\t&lt;body&gt;\\n\\t\\t&lt;canvas id=&quot;canvas&quot; height=&quot;400px&quot; width=&quot;400px&quot;&gt;&lt;\u002Fcanvas&gt;\\n\\t\\t&lt;script src=&quot;index.js&quot;&gt;&lt;\u002Fscript&gt;\\n\\t&lt;\u002Fbody&gt;\\n&lt;\u002Fhtml&gt;\\n&lt;h1&gt;This is a header&lt;\u002Fh1&gt;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch2\u003EHeader Files\u003C\u002Fh2\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-c\\\"\u003E#include &lt;emscripten\u002Fhtml5.h&gt;\\n#include &lt;GLES2\u002Fgl2.h&gt;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe html5 header provides the bindings required to use html elements and events from native code. For this tutorial, it will allow us to set up the WebGL context in C. You can view the full documentation for \u003Ccode\u003Eemscripten\u002Fhtml.5.h\u003C\u002Fcode\u003E \u003Ca href=\\\"https:\u002F\u002Femscripten.org\u002Fdocs\u002Fapi_reference\u002Fhtml5.h.html\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EThe gl2 header provides the functions to draw and interact with the canvas context. The entire header file can be found \u003Ca href=\\\"https:\u002F\u002Fwww.khronos.org\u002Fregistry\u002FOpenGL\u002Fapi\u002FGLES2\u002Fgl2.h\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Ch2\u003ESetting up the Canvas\u003C\u002Fh2\u003E\\n\u003Cp\u003EBefore we can begin drawing, we must first obtain a canvas context. The html5 header file provides the functions needed to do this. To create a canvas context, the \u003Ccode\u003Eemscripten_webgl_create_context\u003C\u002Fcode\u003E function takes a target and an \u003Ccode\u003EEmscriptenWebGLContextAttributes\u003C\u002Fcode\u003E object, used to specify various attributes for the context. A complete list of the object’s attributes can be found \u003Ca href=\\\"https:\u002F\u002Femscripten.org\u002Fdocs\u002Fapi_reference\u002Fhtml5.h.html#c.EmscriptenWebGLContextAttributes\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-c\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-c\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002F beginning of main function\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002F setting up EmscriptenWebGLContextAttributes\u003C\u002Fspan\u003E\\n\\tEmscriptenWebGLContextAttributes attr\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Eemscripten_webgl_init_context_attributes\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Eattr\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\tattr\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ealpha \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002F target the canvas selector\u003C\u002Fspan\u003E\\n\\tEMSCRIPTEN_WEBGL_CONTEXT_HANDLE ctx \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Eemscripten_webgl_create_context\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"#canvas\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Eattr\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Eemscripten_webgl_make_context_current\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ectx\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EAt the start of the main function, we create and initialize the \u003Ccode\u003EEmscriptenWebGLContextAttributes\u003C\u002Fcode\u003E object with all the default attributes settings except the alpha attribute, which is set to false. This is done mostly for the purpose of illustrating how to set specific attributes.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe \u003Ccode\u003Eemscripten_webgl_create_context\u003C\u002Fcode\u003E function targets, \u003Ccode\u003E#canvas\u003C\u002Fcode\u003E, the selector for the canvas element in the html file. After creating the context, we must activate it using \u003Ccode\u003Eemscripten_webgl_make_context_current\u003C\u002Fcode\u003E, to specify that all following GL calls will be applied to that context.\u003C\u002Fp\u003E\\n\u003Ch2\u003EDrawing to the Canvas\u003C\u002Fh2\u003E\\n\u003Cp\u003EIn JavaScript, we would use \u003Ccode\u003EclearColor\u003C\u002Fcode\u003E and \u003Ccode\u003Eclear\u003C\u002Fcode\u003E on the canvas context to fill in the canvas. The equivalents of these methods are provided by the gl2 header as \u003Ccode\u003EglClearColor\u003C\u002Fcode\u003E and \u003Ccode\u003EglClear\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-c\\\"\u003E\u002F\u002F this goes after you have activated the webgl context\\n\\tglClearColor(0.984, 0.4627, 0.502, 1.0);\\n\\tglClear(GL_COLOR_BUFFER_BIT);\\n\\treturn 1;\\n} \u002F\u002F end of main function\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch2\u003ECompiling and Running\u003C\u002Fh2\u003E\\n\u003Cp\u003ETo compile with Emscripten, run the following command. This will output the index.js file that is sourced from the html file.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-bash\\\"\u003Eemcc main.c -o index.js\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe html file can now be opened and viewed in a browser. Huzzah!\u003C\u002Fp\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-2-tri-final.jpg\\\" alt=\\\"Final\\\"\u003E\u003C\u002Fdiv\u003E\",\"css\":{\"code\":\"\",\"map\":null},\"head\":\"\",\"readingTime\":\"4 min read\",\"relatedPosts\":[{\"slug\":\"3-2021-in-Review\",\"title\":\"Looking Back at 2021, Gearing For Launch\",\"date\":\"2022-1-21\",\"summary\":\"Over the past year we’ve done a lot to rapidly build up a prototype, and have finally reached a point where we’ve been using it on your own workflows.\",\"thumbnail\":\"\u002Fblog-3-review-thumbnail.webp\",\"tags\":[\"Update\",\"Engineering\"],\"author\":\"Kyle Li, Jo Gao\",\"html\":\"\u003Cp\u003E2021 has been an exciting year for Feather. \u003C\u002Fp\u003E\\n\u003Cp\u003EWe’ve made massive strides towards reaching feature parity with key players in our field, expanded our team, and have plans for even more in 2022 (including a public launch!).\u003C\u002Fp\u003E\\n\u003Ciframe style=\\\"width: 100%;\\\" width=\\\"560\\\" height=\\\"315\\\" src=\\\"https:\u002F\u002Fwww.youtube.com\u002Fembed\u002Fzh7jbxOZipw\\\" title=\\\"YouTube video player\\\" frameborder=\\\"0\\\" allow=\\\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\\\" allowfullscreen\u003E\u003C\u002Fiframe\u003E\\n\u003Cp\u003E\u003Cem\u003EP.S. Stay tuned until the end of the video Progress Report to view a demo of Feather in action through long distances (Atlanta → New York).\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Ch2\u003EProgress So Far\u003C\u002Fh2\u003E\\n\u003Cp\u003EOver the past year we’ve done a lot to rapidly build up a prototype, and have finally reached a point where we’ve been using it on your own workflows. \u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003ERemote Desktop:\u003C\u002Fstrong\u003E FeatherStream currently allows users to access their full desktop remotely from any other PC utilizing webRTC.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003ECross OS Support:\u003C\u002Fstrong\u003E We have successfully configured CI for this project to automatically give us Linux, Windows, and MacOS builds for testing.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003EMulti-Server Support:\u003C\u002Fstrong\u003E To prepare for future plans in load balancing, FeatherStream allows you to set up and connect to multiple servers from the same client device, seamlessly across multiple devices and vice versa.\u003C\u002Fp\u003E\\n\u003Cp\u003EAll of this has brought Feather up to speed with other remote desktop solutions in months, building the core of our future innovations.\u003C\u002Fp\u003E\\n\u003Ch2\u003EThe Feather Vision\u003C\u002Fh2\u003E\\n\u003Cp\u003EFeather isn’t simply a Remote Desktop. In fact, we looked at the clunky existing remote desktop and VDI infrastructure and found it unusable. It’s not their fault. The fact is that simply streaming the entire desktop as a video can never feel like you’re natively browsing windows on your machine.\u003C\u002Fp\u003E\\n\u003Cp\u003EFeather isn’t a Remote Desktop because it’s a way for you to transform your home PC into a router for processing power itself. Anyone connected to your local Wi-Fi network should be able to accelerate the processing power they have available on the weakest of devices. Connecting to another machine should feel as smooth as running an app on your own device… and making these connections should be as simple and easily understood as connecting to Wi-Fi itself. \u003C\u002Fp\u003E\\n\u003Ch2\u003ELooking Forward\u003C\u002Fh2\u003E\\n\u003Cp\u003EWe’re a little ambitious, and it won’t be easy. This year, we have a few steps planned to achieve our vision.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003EIndividual Windows\u003C\u002Fstrong\u003E: Moving forward, we will implement application-level video streaming so users can access specific programs remotely. Users will be able to use different applications with a near-native experience.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003ECross-Platform Files:\u003C\u002Fstrong\u003E We will add a shared clipboard mechanism so users can copy and paste between their local and remote devices without problems. We will be setting up a file system view for users to be able to access both local and remote files and a way to transfer and share files between devices.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003EAlpha Testing:\u003C\u002Fstrong\u003E We will continue to improve and develop our testing framework to start multiple instances of FeatherStream and help us release more robust versions of this product.\u003C\u002Fp\u003E\\n\u003Cp\u003EIf you’re interested in being the first to hear about how we’re changing remote access, make sure to subscribe to the Feather newsletter.\u003C\u002Fp\u003E\\n\u003Cp\u003EIt has been an exciting year as we begin to gear up to bring Feather into the public eye. Lots have been celebrated, improved, and learned. We have exciting news planned for our next monthly update, so stay tuned to learn more because even we can’t wait to see what comes next. \u003C\u002Fp\u003E\\n\u003Cul\u003E\u003Cli\u003EFeather Team\u003C\u002Fli\u003E\u003C\u002Ful\u003E\",\"css\":{\"code\":\"\",\"map\":null},\"head\":\"\",\"readingTime\":\"3 min read\"},{\"slug\":\"1-mandel\",\"title\":\"One of the Fastest Web Mandelbrot Renderers\",\"date\":\"2021-06-21T00:00:00.000Z\",\"summary\":\"Our initial experiments rendering the Mandelbrot set with JavaScript, Web-workers & emerging web technologies like webassembly.\",\"thumbnail\":\"\u002Fblog-1-mandel-thumbnail.webp\",\"tags\":[\"Engineering\"],\"author\":\"Ojasvin Kirpane, Abhishek Cherath, Jo Gao & Abhinuv Allu\",\"html\":\"\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-1-mandel-thumbnail.webp\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\u003Ch2\u003EIntroduction\u003C\u002Fh2\u003E\\n\u003Cp\u003EHey, welcome to the Feather Systems blog. This is the first post of many, documenting our journey towards creating simpler systems for better performance on the web. This post will document our initial experiments rendering the Mandelbrot set with JavaScript, Web-workers &amp; emerging web technologies like webassembly. You can access the project \u003Ca href=\\\"https:\u002F\u002Fjs-wasm-mandelbrot-benchmark-3.vercel.app\u002F\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E and view the code \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002FAO-Design-Inc\u002Fjs-wasm-mandelbrot-benchmark\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E. These experiments were tested and measured by the team to properly document each technology’s advantages &amp; disadvantages.\u003C\u002Fp\u003E\\n\u003Cp\u003ETo elucidate, let’s start with fractals &amp; the mandelbrot set:\u003C\u002Fp\u003E\\n\u003Ch2\u003EThe Mandelbrot Set\u003C\u002Fh2\u003E\\n\u003Cp\u003EThe Mandelbrot Set is defined as the set of complex numbers for which the function \\n\\n\u003C!-- HTML_TAG_START --\u003E\u003Cspan class=\\\"katex\\\"\u003E\u003Cspan class=\\\"katex-mathml\\\"\u003E\u003Cmath xmlns=\\\"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML\\\"\u003E\u003Csemantics\u003E\u003Cmrow\u003E\u003Cmi\u003Ez\u003C\u002Fmi\u003E\u003Cmo\u003E∗\u003C\u002Fmo\u003E\u003Cmrow\u003E\u003Cmi\u003En\u003C\u002Fmi\u003E\u003Cmo\u003E+\u003C\u002Fmo\u003E\u003Cmn\u003E1\u003C\u002Fmn\u003E\u003C\u002Fmrow\u003E\u003Cmo\u003E=\u003C\u002Fmo\u003E\u003Cmsubsup\u003E\u003Cmi\u003Ez\u003C\u002Fmi\u003E\u003Cmi\u003En\u003C\u002Fmi\u003E\u003Cmn\u003E2\u003C\u002Fmn\u003E\u003C\u002Fmsubsup\u003E\u003Cmo\u003E+\u003C\u002Fmo\u003E\u003Cmi\u003Ec\u003C\u002Fmi\u003E\u003C\u002Fmrow\u003E\u003Cannotation encoding=\\\"application\u002Fx-tex\\\"\u003Ez*{n+1}=z_n^2+c\u003C\u002Fannotation\u003E\u003C\u002Fsemantics\u003E\u003C\u002Fmath\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"katex-html\\\" aria-hidden=\\\"true\\\"\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:0.4653em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord mathnormal\\\" style=\\\"margin-right:0.04398em;\\\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mbin\\\"\u003E∗\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:0.7278em;vertical-align:-0.0833em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord\\\"\u003E\u003Cspan class=\\\"mord mathnormal\\\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mbin\\\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord\\\"\u003E1\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2778em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mrel\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2778em;\\\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:1.0611em;vertical-align:-0.247em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord\\\"\u003E\u003Cspan class=\\\"mord mathnormal\\\" style=\\\"margin-right:0.04398em;\\\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\\\"msupsub\\\"\u003E\u003Cspan class=\\\"vlist-t vlist-t2\\\"\u003E\u003Cspan class=\\\"vlist-r\\\"\u003E\u003Cspan class=\\\"vlist\\\" style=\\\"height:0.8141em;\\\"\u003E\u003Cspan style=\\\"top:-2.453em;margin-left:-0.044em;margin-right:0.05em;\\\"\u003E\u003Cspan class=\\\"pstrut\\\" style=\\\"height:2.7em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"sizing reset-size6 size3 mtight\\\"\u003E\u003Cspan class=\\\"mord mathnormal mtight\\\"\u003En\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan style=\\\"top:-3.063em;margin-right:0.05em;\\\"\u003E\u003Cspan class=\\\"pstrut\\\" style=\\\"height:2.7em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"sizing reset-size6 size3 mtight\\\"\u003E\u003Cspan class=\\\"mord mtight\\\"\u003E2\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"vlist-s\\\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"vlist-r\\\"\u003E\u003Cspan class=\\\"vlist\\\" style=\\\"height:0.247em;\\\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mbin\\\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:0.4306em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord mathnormal\\\"\u003Ec\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C!-- HTML_TAG_END --\u003E does not diverge when \\n\\n\u003C!-- HTML_TAG_START --\u003E\u003Cspan class=\\\"katex\\\"\u003E\u003Cspan class=\\\"katex-mathml\\\"\u003E\u003Cmath xmlns=\\\"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML\\\"\u003E\u003Csemantics\u003E\u003Cmrow\u003E\u003Cmsub\u003E\u003Cmi\u003Ez\u003C\u002Fmi\u003E\u003Cmn\u003E0\u003C\u002Fmn\u003E\u003C\u002Fmsub\u003E\u003Cmo\u003E=\u003C\u002Fmo\u003E\u003Cmn\u003E0\u003C\u002Fmn\u003E\u003C\u002Fmrow\u003E\u003Cannotation encoding=\\\"application\u002Fx-tex\\\"\u003Ez_{0}=0\u003C\u002Fannotation\u003E\u003C\u002Fsemantics\u003E\u003C\u002Fmath\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"katex-html\\\" aria-hidden=\\\"true\\\"\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:0.5806em;vertical-align:-0.15em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord\\\"\u003E\u003Cspan class=\\\"mord mathnormal\\\" style=\\\"margin-right:0.04398em;\\\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\\\"msupsub\\\"\u003E\u003Cspan class=\\\"vlist-t vlist-t2\\\"\u003E\u003Cspan class=\\\"vlist-r\\\"\u003E\u003Cspan class=\\\"vlist\\\" style=\\\"height:0.3011em;\\\"\u003E\u003Cspan style=\\\"top:-2.55em;margin-left:-0.044em;margin-right:0.05em;\\\"\u003E\u003Cspan class=\\\"pstrut\\\" style=\\\"height:2.7em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"sizing reset-size6 size3 mtight\\\"\u003E\u003Cspan class=\\\"mord mtight\\\"\u003E\u003Cspan class=\\\"mord mtight\\\"\u003E0\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"vlist-s\\\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"vlist-r\\\"\u003E\u003Cspan class=\\\"vlist\\\" style=\\\"height:0.15em;\\\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2778em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mrel\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2778em;\\\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:0.6444em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord\\\"\u003E0\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C!-- HTML_TAG_END --\u003E. An image of how the Mandelbrot set looks as follows. Points shaded black are in the set. We are using the Mandelbrot set to benchmark our code.\u003C\u002Fp\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-1-mandel-renderer.png\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\u003Cp\u003EThe Mandelbrot Set is stunning. We highly recommend getting lost in its beauty using our rendering website (\u003Ca href=\\\"https:\u002F\u002Fmandelbrot-ascript.vercel.app\u002F\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fmandelbrot-ascript.vercel.app\u002F\u003C\u002Fa\u003E). Click to zoom and Shift + Click to zoom out.\u003C\u002Fp\u003E\\n\u003Ch2\u003EBenchmark Structure\u003C\u002Fh2\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fjs-wasm-mandelbrot-benchmark-3.vercel.app\u002F\\\" rel=\\\"nofollow\\\"\u003EThe benchmarking site\u003C\u002Fa\u003E is designed to display each iteration we developed with a rough estimate for performance measured in milliseconds. For each version, a function was written to perform the Mandelbrot calculations and return a JavaScript ImageData object that could be easily put on the Canvas. Once the user selects a version from the drop down menu, the corresponding function is called. Since the functions can take some time to complete, they are called from a Web-worker to prevent the main thread from freezing while the function runs. The performance is calculated using \u003Ccode\u003Eperformance.now()\u003C\u002Fcode\u003E calls before and after the function call that returns the ImageData object.\u003C\u002Fp\u003E\\n\u003Cp\u003EAcross all iterations, I used the following values:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.300283\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.48857\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.01\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_width\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_height\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E i32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E1000\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003E\u003Cstrong\u003EFOR MULTITHREADED\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_THREADS\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EWe assume that the canvas width and height are integers. To determine if a point was in the Mandelbrot set, we iterated the Mandelbrot function on the point up to \u003Ccode\u003EITER_CONST\u003C\u002Fcode\u003E, returning the number of times the function had iterated. We use the returned Mandelbrot value to set the color.\u003C\u002Fp\u003E\\n\u003Cp\u003EYou may notice that RGB values get clamped at 255, making it seem like the exercise of iterating all the way to 1000 is just for the sake of testing performance, which it is. (Here is a whole list of \u003Ca href=\\\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FPlotting_algorithms_for_the_Mandelbrot_set\\\" rel=\\\"nofollow\\\"\u003Esmarter and better coloring algorithms\u003C\u002Fa\u003E that we will not be using in this benchmarking exercise.)\u003C\u002Fp\u003E\\n\u003Cp\u003EAs of when this article was published, the following versions are available on the Benchmarking Site:\u003C\u002Fp\u003E\\n\u003Cul\u003E\u003Cli\u003ENaive JS single threaded\u003C\u002Fli\u003E\\n\u003Cli\u003ERust WASM using bindgen (single threaded)\u003C\u002Fli\u003E\\n\u003Cli\u003EAssemblyscript old version (single threaded, not thread safe)\u003C\u002Fli\u003E\\n\u003Cli\u003EAssemblyscript new version (single threaded, thread safe)\u003C\u002Fli\u003E\\n\u003Cli\u003EAssemblyscript SIMD WASM (singlethreaded, multithreaded)\u003C\u002Fli\u003E\\n\u003Cli\u003ENew JS(less memory allocation) singlethreaded\u003C\u002Fli\u003E\\n\u003Cli\u003ENew JS SharedMemoryBuffer multithreaded\u003C\u002Fli\u003E\u003C\u002Ful\u003E\\n\u003Cbr\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003EImplementing the Mandelbrot Set in JavaScript \u003Cem\u003Eby Abhinuv Allu\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\\n\u003Cdetails\u003E\u003Csummary\u003EClick to Read\u003C\u002Fsummary\u003E\\n\u003Cp\u003EI began the testing process with the web’s best frenemy, Javascipt.\u003C\u002Fp\u003E\\n\u003Cp\u003EI started with a naive approach to implement the Mandelbrot set in JavaScript and then try and optimize later. I started by creating a class for Complex numbers. This class would be able to add, multiply and return the magnitude. For the magnitude, I used a library function Math.hypot. Down below is our first initial implementation of the Complex class.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Econstructor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ereal\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E imag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E real\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E imag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FFunction that add this complex number with another complex number, cplx\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Eadd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ecplx\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FFuction that returns the magnitude of this complex number\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Emag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ecplx\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ehypot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FFunction that multiplies this complex number with another complex number, cplx\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Emul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ecplx\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E real_part \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E imag_part \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E real_part\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E imag_part\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe program iterated through each element of the canvas to compute whether or not they were in the Mandelbrot set.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ecplx\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E z \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E count \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Ewhile\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ez\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&lt;=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E2\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;&amp;\u003C\u002Fspan\u003E count \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\tz \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E z\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ez\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eadd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tcount\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThese data points were added to an array which is then painted onto the Canvas. I had some ideas about optimizations with help from the profiler, however the most fascinating insight was that the Math.hypot function for two numbers is an order of magnitude slower than squaring, adding, and then computing the square root. During the profiling of the initial code I found out that Math.hypot was taking up most of the time.\u003C\u002Fp\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-1-mandel-hypnot.png\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\\n\u003Ch3\u003EImproved JavaScript\u003C\u002Fh3\u003E\\n\u003Cp\u003ETo improve the initial naive approach, I decided to add multithreading. I started this with a naive way of having the worker compute each point and then send it back to receive the next point but, the message overhead was immense and resulted in a single threaded function as I only had one worker. The next step was experimenting with divisibility classes to add multiple workers. But this had the same problem where the overhead of sending &amp; receiving a message from the workers was just too much. Eventually, I figured out that I would have each worker compute a set number of rows at a time.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FThis is in the main function which calls the workers to do the work\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003EworkerCount\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E worker \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EWorker\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"worker.js\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EINDEXES_PER_WORKER\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efloor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003EworkerCount\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efloor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003EworkerCount\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_XC\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_INDEX\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EINDEXES_PER_WORKER\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EEND_INDEX\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_INDEX\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EINDEXES_PER_WORKER\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n  worker\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function-variable function\\\"\u003Eonmessage\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003Edata\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECOMPUTED_ROWS\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E data\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    points_array\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Ei\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECOMPUTED_ROWS\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n     doneCount\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EdoneCount \u003Cspan class=\\\"token operator\\\"\u003E==\u003C\u002Fspan\u003E workerCount\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n      points_array \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E points_array\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eflat\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\n      \u003Cspan class=\\\"token function\\\"\u003Edraw\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Epoints_array\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FThis is how it looks now in the worker function\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token function-variable function\\\"\u003Eonmessage\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E data \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_XC\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E data\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E points_in_thread \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EArray\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E2.0\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_XC\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tcount_x \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tx \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E2.0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\tpoints_in_thread\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Ecount_x \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E count_y\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ey\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E x\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003EpostMessage\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Epoints_in_thread\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Ch3\u003EShared Buffer\u003C\u002Fh3\u003E\\n\u003Cp\u003ESince all the points would be added to the same array it would make sense that having a shared buffer to reduce the overhead needed to send array points would decrease the compute time. So I added a shared buffer that was formatted like an ImageData object so it would be easier to paint it onto the canvas. This required some rewriting of the some steps here and there, but it ended up being faster.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe other issue with using a Shared Buffer is that I had to add promises to the code, so werefactored it to include promises.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FThis is in the main function which calls the workers to do the work\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EPromise\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Eresolve\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E worker \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EWorker\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"benchmarks\u002Fmultithreaded-js\u002Fsharedworker.js\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    worker\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EpostMessage\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Eparameters\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    worker\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function-variable function\\\"\u003Eonmessage\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n      \u003Cspan class=\\\"token function\\\"\u003Eresolve\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"worker finished\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003EreturnSharedBufferjs\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECANVAS_WIDTH\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECANVAS_HEIGHT\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECANVAS_WIDTH\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECANVAS_HEIGHT\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E window \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E window\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E window\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E workerCount \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E sharedBuffer \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003ESharedArrayBuffer\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E sharedArray \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EUint8ClampedArray\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EsharedBuffer\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  sharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efill\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efloor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003EworkerCount\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n  \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E parameters \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E sharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E promises \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n  \u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003EworkerCount\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\n    parameters\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    promises\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Epush\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EcreateWorker\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Eparameters\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FThis is how it looks now in the worker function\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token function-variable function\\\"\u003Eonmessage\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E data \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\tsharedArray\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E data\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tcount_y \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\ty \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E index \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecount_x \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\\tval \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E y\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\\tsharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Eindex \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E val\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\\tsharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Eindex \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E val\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\\tsharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Eindex \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E val\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\\tsharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Eindex \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003EpostMessage\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E'done'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThese changes made the code perform a lot better. You can check out it’s performance in the ”\u003Ca href=\\\"https:\u002F\u002Fwww.notion.so\u002FOn-WebAssembly-Performance-and-the-Mandelbrot-WORKING-TITLE-96760f3f113343c894c00f52cdef3ef0\\\" rel=\\\"nofollow\\\"\u003EResults\u003C\u002Fa\u003E” section. JavaScript was extremely performant (especially on Chrome) and gave us hope that pushing the boundaries of speed on the web was possible.\u003C\u002Fp\u003E\u003C\u002Fdetails\u003E\\n\u003Cbr\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003ESo, What is Webassembly? \u003Cem\u003Eby Abhishek Cherath\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\\n\u003Cdetails\u003E\u003Csummary\u003EClick to Read\u003C\u002Fsummary\u003E\\n\u003Cp\u003EIn our quest to further optimize performance, we used webassembly, an emerging web technology optimized for what we are trying to achieve. So, what is it?\\nInsofar as an overview is concerned, nothing beats Lin Clark’s cartoon intro \u003Ca href=\\\"https:\u002F\u002Fhacks.mozilla.org\u002F2017\u002F02\u002Fa-cartoon-intro-to-webassembly\u002F\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E, and the MDN docs \u003Ca href=\\\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWebAssembly\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E. Put simply, webassembly is a low level typed language that targets the browser’s VM. For some reasons[1] , it’s very quick and easy to compile into decently fast machine code.\u003C\u002Fp\u003E\\n\u003Cp\u003EFundamentally, the language was designed to offer the best possible latency (time to execution) and speed of execution. Low latency is achieved by having a small binary representation (vs javascript’s textual representation) and having type definitions and a function table at the start of a .wasm module, which allows compilers to compile in a streaming fashion, instead of needing to have access to the entire file before starting.\u003C\u002Fp\u003E\\n\u003Cp\u003ESpeed of execution requires slow compilation with multiple passes for the compiler to accurately assess the best register allocation, optimize out unnecessary instructions and do whatever other things compilers do. (\u003Cem\u003Enote: I have frankly no idea what goes into compiler optimization, I just know it takes time\u003C\u002Fem\u003E)\u003C\u002Fp\u003E\\n\u003Cp\u003ETo satisfy both these goals, browsers (atleast Firefox and Chrome) have two compilers for webassembly, the first compiles the module as it’s called from the network, and is basically instant (\u003Ca href=\\\"https:\u002F\u002Fv8.dev\u002Fdocs\u002Fwasm-compilation-pipeline\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E, chrome devs claim that theirs can do on the order of 10+ mb of code per second, so the bottleneck will almost always be the speed of the network rather than the compiler.) The second does optimization and dynamically replaces the unoptimized bytecode from the first when it’s done.\u003C\u002Fp\u003E\\n\u003Cp\u003EIt’s interesting to note here that, \u003Cem\u003Ea priori\u003C\u002Fem\u003E there’s no reason to expect that webassembly code for high performance stuff [2] (like fractal calculation) will be any faster than its javascript counterpart. Since the hot loop (calculating escape time) is running many thousands of times, one would expect the javascript JIT compiler to infer the output types and get basically similar bytecode, while amortizing its greater overhead considering workload size.\u003C\u002Fp\u003E\\n\u003Cp\u003EIn a later article, I will be examining this conjecture, and taking a deeper look at the flamegraphs and bytecode generated by our benchmarks.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe other interesting thing about webassembly is its memory model, programs do not have access to their own instructions and stack machine memory (so no self modifying code, and no messing with values on the stack). What they do have access to is a block of linear memory, which is backed by a javascript ArrayBuffer, and byte addressed (ie. memory[0] is 1 byte long.)\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003E[1]I’m not entirely sure why, but it’s some combination of coding for a simple stack machine, having type information, linear memory, and being easy to parse.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003E[2]This is \u003Cstrong\u003Emostly\u003C\u002Fstrong\u003E true, except for vectorization. SIMD (Single Instruction Multiple Data) instructions are featured in the webassembly spec and implemented by chrome and firefox, which do not expose them in js, and have no plans to do so. (although\u003C\u002Fem\u003E I \u003Cem\u003Esuppose there’s nothing stopping a JIT from autovectorizing, is there?)\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Fdetails\u003E\\n\u003Cbr\u003E\u003Cbr\u003E\\n\u003Cblockquote\u003E\u003Cp\u003E\u003Cstrong\u003EOur Approach to webassembly\u003C\u002Fstrong\u003E: As many languages can be compiled to webassembly, we looked at two of the most commonly used ones: Rust &amp; AssemblyScript. In the following sections we will describe our approach to these two languages.\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\\n\u003Cbr\u003E\u003Cbr\u003E\\n\u003Ch2\u003ERust Implementation \u003Cem\u003Eby Jo Gao\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\\n\u003Cdetails\u003E\u003Csummary\u003EClick to Read\u003C\u002Fsummary\u003E\\n\u003Ch3\u003ESinglethreaded\u003C\u002Fh3\u003E\\n\u003Cp\u003EI wrote a similar implementation of the function in Rust that would return an ImageData object of the Mandelbrot Set. It uses \u003Ca href=\\\"https:\u002F\u002Frustwasm.github.io\u002Fwasm-bindgen\u002F\\\" rel=\\\"nofollow\\\"\u003Ewasm-bindgen\u003C\u002Fa\u003E, a Rust library that will compile Rust code to webassembly, and then generate the bindings and glue between JavaScript and webassembly so that it can be run on the web. It handles all the type conversions between JavaScript and webassembly and facilitates the compilation of Rust to webassembly.\u003C\u002Fp\u003E\\n\u003Cp\u003EIn the iterative \u003Ccode\u003Ein_mandelbrot\u003C\u002Fcode\u003E function, \u003Ccode\u003Ecount\u003C\u002Fcode\u003E is set to iterate all the way to 1000 for benchmarking purposes. When returning, \u003Ccode\u003Ecount\u003C\u002Fcode\u003E is set to 255 if larger than 255 to prevent having to cast numbers larger than 255 to u8.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-rust\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-rust\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Efn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function-definition function\\\"\u003Ein_mandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E-\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu8\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E1000\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Emut\u003C\u002Fspan\u003E z \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ebuild_complex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Emut\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Ewhile\u003C\u002Fspan\u003E z\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&lt;=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E2.0\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;&amp;\u003C\u002Fspan\u003E count \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n        z \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ez\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Esquare\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eadd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002F z = z^2 + cplx\u003C\u002Fspan\u003E\\n        count \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E count \u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E255\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n        count \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n    count \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu8\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe magic of wasm-bindgen kicks in here, allowing us to create the ImageData object right in the Rust code by providing the type and the constructor signature:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-rust\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-rust\\\"\u003E\u003Cspan class=\\\"token attribute attr-name\\\"\u003E#[wasm_bindgen]\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Eextern\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\"C\\\"\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Epub\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Etype\u003C\u002Fspan\u003E \u003Cspan class=\\\"token type-definition class-name\\\"\u003EImageData\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token attribute attr-name\\\"\u003E#[wasm_bindgen(constructor, catch)]\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Efn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function-definition function\\\"\u003Enew\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Edata\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token class-name\\\"\u003EUint8ClampedArray\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E width\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E height\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E-\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EResult\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token class-name\\\"\u003EImageData\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EJsValue\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token attribute attr-name\\\"\u003E#[wasm_bindgen]\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Epub\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function-definition function\\\"\u003Erun\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Estart_x\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E start_y\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E width\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E height\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E window\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E-\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EImageData\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E y_len\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E height \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E x_len\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E width \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E pixels\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eusize\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ex_len \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E y_len\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eusize\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Emut\u003C\u002Fspan\u003E points_array \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token macro property\\\"\u003Evec!\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E pixels\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token function\\\"\u003Efill_mandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Emut\u003C\u002Fspan\u003E points_array\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E start_x\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E start_y\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E x_len\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E y_len\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E window\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E pointer \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E points_array\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eas_ptr\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eusize\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E mem \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token namespace\\\"\u003Ewasm_bindgen\u003Cspan class=\\\"token punctuation\\\"\u003E::\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ememory\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eunchecked_into\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token class-name\\\"\u003EWebAssembly\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\\\"token class-name\\\"\u003EMemory\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E new_array \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EUint8ClampedArray\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Enew\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Emem\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ebuffer\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eslice\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Epointer \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Epointer \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E pixels\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token class-name\\\"\u003EImageData\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Enew\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Enew_array\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E x_len\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Einto\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E y_len\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Einto\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eunwrap\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EAfter compiling this code, wasm-bindgen outputs a number of files that are meant to be bundled using \u003Ca href=\\\"https:\u002F\u002Fwebpack.js.org\u002F\\\" rel=\\\"nofollow\\\"\u003EWebpack\u003C\u002Fa\u003E and imported to your JavaScript file as an ES6 module, allowing access to the functions that were written in Rust. The idea is that after compiling and importing the module, calling \u003Ccode\u003Erun(...)\u003C\u002Fcode\u003Ewould return a whole JavaScript ImageData Object.\u003C\u002Fp\u003E\\n\u003Cp\u003EUnfortunately, our Benchmarking Site is structured to use a web worker to call this function. Modules cannot be imported to web workers. However, they can be imported to module workers, web workers that support module import, but as of today, Firefox does not support this feature.\u003C\u002Fp\u003E\\n\u003Cp\u003EThis is an infeasible solution because I was unwilling to limit the availability of our benchmark site for this implementation. After many hours of tinkering with the existing setup, I found a workaround that eliminated the need for Webpack altogether: after compiling with wasm-bindgen, I copy and pasted the entire outputted .js file with the import and exports removed, appended the wrapper function I had written to it, and called \u003Ccode\u003Einit(...)\u003C\u002Fcode\u003E on the outputted .wasm.\u003C\u002Fp\u003E\\n\u003Cp\u003EAfter confirming that this worked, A colleague and I wrote a shell script to automatically do this after compilation. Albeit a little unpleasant on the eyes, it does the job:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-bash\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-bash\\\"\u003E\u003Cspan class=\\\"token function\\\"\u003Esed\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'\u002FimportW\u002Fd;s\u002F^export\u002F\u002Fg;\u002Fdefault\u002Fd'\u003C\u002Fspan\u003E pkg\u002FMandelbrot.js \u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E tmp_mandel_import.js\\n\u003Cspan class=\\\"token function\\\"\u003Ecat\u003C\u002Fspan\u003E tmp_mandel_import.js  mandel_src.js \u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E Mandelbrot.js\\n\u003Cspan class=\\\"token function\\\"\u003Erm\u003C\u002Fspan\u003E tmp_mandel_import.js\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Ch3\u003ERust &amp; Webassembly Multi-Threaded\u003C\u002Fh3\u003E\\n\u003Cp\u003ETo further improve performance in Rust, I carried out the same calculations, but in parallel this time. An advantage of the Mandelbrot Set is that determining whether a pixel falls within the set or not can be done completely independently of other pixels. The outcome of each pixel has no effect on the others, making the transition to multithreading straightforward.\u003C\u002Fp\u003E\\n\u003Cp\u003EI used the \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Frustwasm\u002Fwasm-bindgen\u002Ftree\u002Fmaster\u002Fexamples\u002Fraytrace-parallel\\\" rel=\\\"nofollow\\\"\u003EParallel Raytracing example\u003C\u002Fa\u003E. given in the Wasm-Bindgen repo, as a starting point. Using a combination of web workers and the Rayon Crate for data parallelism in Rust yielded a pretty fast multithreaded Mandelbrot Set.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003EUnfortunately,\u003C\u002Fem\u003E I \u003Cem\u003Ewas unable to include this version of the Mandelbrot in the final Benchmarking website\u003C\u002Fem\u003E because I ran into a similar problem with the wasm-bindgen and module output. This time, it was further complicated by the Webworkers being created from within the Rust code. The funky workaround that had allowed for the singlethreaded RustWasm example to run on the Benchmarking Site failed to work the same magic for this implementation.\u003C\u002Fp\u003E\\n\u003Cp\u003EThis version of the Mandelbrot also makes use of the SharedArrayBuffer, and had it been on the site, would not work in Safari and browsers that do not support SharedArrayBuffer Objects.\u003C\u002Fp\u003E\u003C\u002Fdetails\u003E\\n\u003Cbr\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003EAssemblyScript \u003Cem\u003Eby Abhishek Cherath\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\\n\u003Cdetails\u003E\u003Csummary\u003EClick to Read\u003C\u002Fsummary\u003E\\n\u003Cp\u003EAssemblyScript compiles a subset of typescript to webassembly. To get an idea of how simple it is to write it, here’s essentially the same javascript code from earlier, with type annotations and minor changes for webassembly:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003Edeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ecanvas_width\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E i32\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\ndeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ecanvas_height\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E i32\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\ndeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E i16\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\ndeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32\\ndeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32\\ndeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32\\n\\n@unmanaged\\n\u003Cspan class=\\\"token keyword\\\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token literal-property property\\\"\u003Ereal\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token literal-property property\\\"\u003Eimag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token function\\\"\u003Econstructor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Ereal\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Eimag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E real\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E imag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\\t@inline\\n\\t\u003Cspan class=\\\"token function\\\"\u003Eadd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E Complex\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E Complex \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\\t@inline\\n\\t\u003Cspan class=\\\"token function\\\"\u003Emag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f64 \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Esqrt\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\\t@inline\\n\\t\u003Cspan class=\\\"token function\\\"\u003Emul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E Complex\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E Complex \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E __tempr  \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E __tempi \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E __tempr\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E __tempi\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token function\\\"\u003Eset\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Eimag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E real\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E imag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003EComplex \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ecplx\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003EComplex \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\\n@inline\\n\u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Ereal\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Eimag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ei16\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\tz\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eset\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\\tcplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eset\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ecount\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ei16 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E z\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&lt;=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ez\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ez\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eadd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002F z = z^2 + cplx\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecount \u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token comment\\\"\u003E\u002F*\\nstores array of i16s at start of memory\\ncorresponding to escape count at pixels in\\narray\\n*\u002F\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ecompute\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E memcounter \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_width\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_height\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E canvas_height\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E step_Y\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E canvas_width\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E step_X\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\tstore\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ei16\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(memcounter, mandelbrot(x,y));\\n\\t\\t\\tmemcounter += 2\\n\\t\\t&#125;\\n\\t&#125;\\n&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe only really noteworthy change was to not have \u003Ccode\u003Enew\u003C\u002Fcode\u003E in the hot loop. The Assemblyscript garbage collector had some trouble with it and total allocation would exceed webassembly’s 100 page memory limit[1]. I suspect that sort of code will be usable once the webassembly GC proposals, which allow wasm modules to hook into the browser’s GC, are implemented.\u003C\u002Fp\u003E\\n\u003Ch3\u003EThreading\u003C\u002Fh3\u003E\\n\u003Cp\u003EThe fastest way to thread code in browsers is to use \u003Ca href=\\\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FJavaScript\u002FReference\u002FGlobal_Objects\u002FSharedArrayBuffer\\\" rel=\\\"nofollow\\\"\u003ESharedArrayBuffer\u003C\u002Fa\u003E, this also requires the following CORS headers.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003ECross\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EOrigin\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EOpener\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EPolicy\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E same\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Eorigin\\nCross\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EOrigin\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EEmbedder\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EPolicy\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E require\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Ecorp\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThis is to ensure cross-origin isolation, which protects against memory being exfiltrated somehow (I might explore this in the future, but that’s about all I know for the moment.) webassembly memories can also be created with a backing SharedArrayBuffer, which allows fast multithreading, as separate web-workers can run the same webassembly module and write their results to the same memory, meaning that large objects don’t need to be passed around using postmessage, and the many O(N) overheads to do with copying and creating new arrays can be avoided.\u003C\u002Fp\u003E\\n\u003Cp\u003EHowever, while Assemblyscript \u003Ca href=\\\"https:\u002F\u002Fwww.assemblyscript.org\u002Fstdlib\u002Fbuiltins.html#atomics-%F0%9F%A6%84\\\" rel=\\\"nofollow\\\"\u003Eallows\u003C\u002Fa\u003E access to atomic instructions, it does not implement any sort of locking. So any program that reads and writes to memory will need to be adjusted to thread with shared memory. This means that the program seen above, with its Complex class and set calls reading and wrxiting to the linear memory quite often, is very prone to… interesting behaviour when threaded.\u003C\u002Fp\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-1-mandel-glitch.png\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\\n\u003Cp\u003EExhibit A of nondeterministic behavior\u003C\u002Fp\u003E\\n\u003Cp\u003EThat being said, for small examples such as fractal calculation, it’s quite easy to limit mutability to local variables (which are on the stack, not in the linear memory, and so are not shared) and avoid the problem entirely. Like in the following code:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E@inline\\n\u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Ec_r\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ec_i\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ei16\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ecount\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ei16 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ez_r\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ez_i\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Et_r\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Et_i\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E z_r\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_r \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E z_i\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_i \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\tt_r \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E z_r\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_r \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E z_i\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_i \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E c_r\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tt_i \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_i\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_r \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E c_i\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tz_r \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E t_r\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tz_i \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E t_i\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecount \u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token comment\\\"\u003E\u002F*\\nstores array of i16s at start of memory\\ncorresponding to escape count at pixels in\\narray\\n*\u002F\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ecompute\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E memcounter \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_width\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_height\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E canvas_height\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E step_Y\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E canvas_width\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E step_X\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\tstore\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ei16\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(memcounter, mandelbrot(x,y));\\n\\t\\t\\tmemcounter += 2\\n\\t\\t&#125;\\n\\t&#125;\\n&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003E\u003Cem\u003Enote that the store instruction there might look like it would cause issues, but as long as threads work on different parts of the image, that should not be a problem.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Ch3\u003ESIMD\u003C\u002Fh3\u003E\\n\u003Cp\u003ESIMD (Single Instruction Multiple Data) instructions are special instructions on the CPU that allow multiple additions, multiplications etc to be carried out in parallel on the same core)\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cimg src=\\\"https:\u002F\u002Fupload.wikimedia.org\u002Fwikipedia\u002Fcommons\u002Fc\u002Fce\u002FSIMD2.svg\\\" alt=\\\"SIMD Explaination\\\"\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EBy Vadikus - Own work, CC BY-SA 4.0, \u003Ca href=\\\"https:\u002F\u002Fcommons.wikimedia.org\u002Fw\u002Findex.php?curid=39715273\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fcommons.wikimedia.org\u002Fw\u002Findex.php?curid=39715273\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EThey’re not in the webassembly spec as yet, but should be \u003Ca href=\\\"https:\u002F\u002Fwebassembly.github.io\u002Fsimd\u002Fcore\u002Fexec\u002Finstructions.html#simd-instructions\\\" rel=\\\"nofollow\\\"\u003Esoon\u003C\u002Fa\u003E, and are currently available on chrome and firefox (although not on ARM in firefox 89, ie. apple M1.) Assemblyscript does not autovectorize code, but \u003Ca href=\\\"https:\u002F\u002Fwww.assemblyscript.org\u002Fstdlib\u002Fbuiltins.html#simd-%F0%9F%A6%84\\\" rel=\\\"nofollow\\\"\u003Eallows\u003C\u002Fa\u003E access to the instructions, and provides some sugar for different types and functions to initialise constant vectors.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe vector size in the proposal is 128 bit, which is a decent compromise and is backed by hardware instructions on most modern computers. In the future, \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002FWebAssembly\u002Fflexible-vectors\\\" rel=\\\"nofollow\\\"\u003Eflexible vectors\u003C\u002Fa\u003E, should be able to allow access to 256, 512 bit vectors that modern intel and AMD CPUs support (consumer ARM chips currently only have 128 bit vectors, as far as I’m aware, although \u003Ca href=\\\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FAArch64#Scalable_Vector_Extension_(SVE)\\\" rel=\\\"nofollow\\\"\u003Esupercomputer ARM chips do have 512 bit vectors\u003C\u002Fa\u003E.)\u003C\u002Fp\u003E\\n\u003Cp\u003EVectorizing the mandelbrot code above is not too bad, althought it does look rather messy:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E@inline\\n\u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot_simd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Ec_rl\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ev128\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Ec_il\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ev128\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ev128\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ein_set\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E v128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ei32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ez_r\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E v128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ez_i\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E v128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Et_r\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E v128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Et_i\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E v128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E ones \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ei32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E fours \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONSTS\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ev128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E v128\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Esplat\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ei32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(ITER_CONST);\\n    let count:v128=i32x4(0,0,0,0)\\n    for(\\n        let total_count:i32 = 0, any_in_convergence_region:boolean = true;\\n        any_in_convergence_region &amp;&amp;\\n        total_count &lt; ITER_CONST;\\n        total_count++;\\n    ) \u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n        z_i \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E v128\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eadd\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(c_il, v128.mul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(v128.add\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(z_r,z_r),z_i));\\n        z_r = v128.add\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(c_rl, v128.sub\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(t_r,t_i));\\n        t_r = v128.mul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(z_r,z_r);\\n        t_i = v128.mul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(z_i,z_i);\\n        const mask = v128.le\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(v128.add\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(t_r,t_i),fours);\\n        any_in_convergence_region = v128.any_true(mask);\\n        count = v128.add\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ei32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(count, v128.and(ones,mask));\\n    &#125;\\n    return count;\\n&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThis should basically be a 4x speedup over the previous code, when run single threaded. Multithreaded, that number will vary depending on how threads are allocated, as work only gets completed as fast as the slowest thread.\u003C\u002Fp\u003E\\n\u003Ch3\u003ECompiler Flags\u003C\u002Fh3\u003E\\n\u003Cp\u003EFor the examples above, some memory is reserved for the purposes of storing the image, in assemblyscript this is achieved by passing the \u003Ccode\u003E--memoryBase\u003C\u002Fcode\u003E flag to the \u003Ccode\u003Easc\u003C\u002Fcode\u003E compiler (as seen in the makefile below)\u003C\u002Fp\u003E\\n\u003Cp\u003EThe other flags are tuned for maximum performance (thanks to \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002FMaxGraey\\\" rel=\\\"nofollow\\\"\u003EMax Graey\u003C\u002Fa\u003E for -O3 instead of -O3s\u002Fz) and to enable necessary features (threads, SIMD.)\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-makefile\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-makefile\\\"\u003EMEMORY_FLAGS \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E --maximumMemory 80 --importMemory --noExportMemory --initialMemory 80 --memoryBase 4000000\\nOPTIMIZATION_FLAGS \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E -O3 --converge\\nDEBUG_FLAGS \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E --sourceMap\\nFEATURE_FLAGS \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E --enable simd --enable threads\\nRUNTIME_FLAGS \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E --runtime stub\\n\u003Cspan class=\\\"token target symbol\\\"\u003Estart\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E install\\n\\tnpx asc assembly\u002Fmandel_final.ts -b build\u002Fmandel_final.wasm -t build\u002Fmandel_final.wat \u003Cspan class=\\\"token variable\\\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EOPTIMIZATION_FLAGS\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token variable\\\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EMEMORY_FLAGS\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token variable\\\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EFEATURE_FLAGS\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token variable\\\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003ERUNTIME_FLAGS\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token variable\\\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EDEBUG_FLAGS\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token target symbol\\\"\u003Einstall\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E\\n\\tnpm i\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Ch3\u003EMultithreaded SIMD Speed\u003C\u002Fh3\u003E\\n\u003Cp\u003EBenchmark results will be discussed near the end of this article, but the speed of the multithreaded SIMD code is quite astonishing, roughly 3x the speed of multithreaded JS using sharedarraybuffers, and I’m guessing that’s held back by module message passing overheads. \u003Ca href=\\\"https:\u002F\u002Fmandelbrot-ascript.vercel.app\u002F\\\" rel=\\\"nofollow\\\"\u003EHERE\u003C\u002Fa\u003E is a basic mandelbrot zoom implementation using it (only works in firefox(≥90 on apple m1) and chrome, \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fpretentious7\u002Fmandelbrot-ascript\\\" rel=\\\"nofollow\\\"\u003Ehere’s\u003C\u002Fa\u003E the github repo.) I’ll be working in boundary estimation and period checking along with xaos zoom algorithm into it in a couple of months, so stay tuned for that!\u003C\u002Fp\u003E\\n\u003Cp\u003EI’m also fairly certain that this is the first(?) SIMD mandelbrot implementation for webassembly, so if anyone wants to use it for anything (under the terms of the GPLv3 License) feel free!\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003E[1] A page being 64KiB (65,536 bytes), so about 6.5 mb max memory\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Fdetails\u003E\\n\u003Cbr\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003EResults\u003C\u002Fh2\u003E\\n\u003Cp\u003EFirst, we know that our benchmarks here are not rigorous in the slightest. Their purpose was to give us an idea of the rough performance capabilities of the tools we’re working with, to help inform our choices as we port certain programs (stay tuned!) to webassembly. We will be refining this tool in the future, and hope to have (somehow) bytecode outputs and flamegraphs on the site.\u003C\u002Fp\u003E\\n\u003Ctable\u003E\u003Cthead\u003E\u003Ctr\u003E\u003Cth\u003EBenchmark\u003C\u002Fth\u003E\\n\u003Cth\u003EFirefox 89(ms)\u003C\u002Fth\u003E\\n\u003Cth\u003EChrome 91 (ms)\u003C\u002Fth\u003E\u003C\u002Ftr\u003E\u003C\u002Fthead\u003E\\n\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003ENaive-js\u003C\u002Ftd\u003E\\n\u003Ctd\u003E2992\u003C\u002Ftd\u003E\\n\u003Ctd\u003E631\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003EImproved-js\u003C\u002Ftd\u003E\\n\u003Ctd\u003E1755\u003C\u002Ftd\u003E\\n\u003Ctd\u003E292\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003EMultithreaded-js\u003C\u002Ftd\u003E\\n\u003Ctd\u003E705\u003C\u002Ftd\u003E\\n\u003Ctd\u003E129\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003ESinglethreaded-Rust * **\u003C\u002Ftd\u003E\\n\u003Ctd\u003E296\u003C\u002Ftd\u003E\\n\u003Ctd\u003E300\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003ESimple Assemblyscript\u003C\u002Ftd\u003E\\n\u003Ctd\u003E494\u003C\u002Ftd\u003E\\n\u003Ctd\u003E497\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003EOptimized non-SIMD AssemblyScript\u003C\u002Ftd\u003E\\n\u003Ctd\u003E250\u003C\u002Ftd\u003E\\n\u003Ctd\u003E262\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003EOptimized SIMD AssemblyScript\u003C\u002Ftd\u003E\\n\u003Ctd\u003E124\u003C\u002Ftd\u003E\\n\u003Ctd\u003E108\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003ESIMD Multithreaded AssemblyScript\u003C\u002Ftd\u003E\\n\u003Ctd\u003E43\u003C\u002Ftd\u003E\\n\u003Ctd\u003E43\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\\n\u003Cp\u003E\u003Cem\u003EAll numbers approximate, gathered from fresh browser session after reboot on an HP Envy 13 with an i5-8265U CPU @ 1.60GHz and 8gb of RAM running Ubuntu 20.04.2 with kernel 5.8.0. Average of 5 runs (first 2 runs dropped)\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EThe results of our benchmark (at least approximately) line up with what one would expect, but we find a few items of interest. First, as far as the javascript implementations are concerned, Firefox is \u003Cem\u003Esignificantly\u003C\u002Fem\u003E slower than chrome. Second, webassembly speeds are comparable for both browsers.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe performance advantage of webassembly (without SIMD) over javascript for this benchmark is basically negligible for chrome. In a future article it’ll be interesting to see whether the bytecode generated is also similar.\u003C\u002Fp\u003E\\n\u003Cp\u003EBut the key insight here is clear, webassembly offers \u003Cem\u003Epredictable\u003C\u002Fem\u003E performance, across browser engines. We’ll be adding fallbacks for safari later to see if this holds there as well. Further, we’ll compare the results to native code.\u003C\u002Fp\u003E\\n\u003Cp\u003E*\u003Cem\u003EThe rust code can likely be sped up with some optimizations here and there, but for a rough effort from a novice rust programmer, this is representative.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003E** The rust code was improved by @MaxGraey and now lines up with what one would expect\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003ESee the demo \u003Ca href=\\\"https:\u002F\u002Fjs-wasm-mandelbrot-benchmark-3.vercel.app\u002F\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003EFinal Thoughts\u003C\u002Fh2\u003E\\n\u003Cp\u003EAs tools of application distribution, browsers have some undeniable advantages over the traditional pipeline of download → extract onto disk → load from disk for execution. For most programs, it is technically unnecessary to have \u003Cem\u003Eall\u003C\u002Fem\u003E of their assets present to be able to enjoy some subset of their capabilities. Of course, adding such partial update capabilities is non-trivial, and would add significant complexity. But web developers and browser vendors have made a lot of progress in enabling this essentially by default, and with webassembly, enabling it in areas where it’s not previously been feasible.\u003C\u002Fp\u003E\\n\u003Cp\u003EFurther, cloud offloading enables users to easily sustain state across devices and in some cases avoid calculation heavy code in the interests of battery life or smooth performance. The easiest way to realize these advantages is to distribute one’s application in an environment that does this \u003Cem\u003Eby default\u003C\u002Fem\u003E: the browser. But a prerequisite for this is that the experience is not overly hampered by being in the browser, and bringing webassembly to near native performance is a key part of that.\u003C\u002Fp\u003E\\n\u003Cp\u003EThere is an opportunity here to allow people to access performance heavy applications like games and simulations on their devices without having to get into the nasty business of managing local state, which accounts for what, 99% of problems installing and using software? We want to help build this, and over the next few weeks, will be releasing demos to show what it might look like, so stay tuned!\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003EOf course, the possible bad end here is that the canvas ends up as an inefficient GUI toolkit to have fungible programmers at the cost of user experience, we hope that doesn’t happen.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003EFurther Reading:\u003C\u002Fh2\u003E\\n\u003Cp\u003EDavid Beazley. (2019). A Talk Near the Future of Python (a.k.a., Dave live-codes a Webassembly Interpreter). \u003Ca href=\\\"https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=r-A78RgMhZU\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fwww.youtube.com\u002Fwatch?v=r-A78RgMhZU\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EFirefox’s low-latency webassembly compiler – wingolog. (n.d.). Retrieved June 19, 2021, from \u003Ca href=\\\"https:\u002F\u002Fwingolog.org\u002Farchives\u002F2020\u002F03\u002F25\u002Ffirefoxs-low-latency-webassembly-compiler\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fwingolog.org\u002Farchives\u002F2020\u002F03\u002F25\u002Ffirefoxs-low-latency-webassembly-compiler\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003Efirefox’s low-latency webassembly compiler—Wingolog. (n.d.). Retrieved June 19, 2021, from \u003Ca href=\\\"https:\u002F\u002Fwingolog.org\u002Farchives\u002F2020\u002F03\u002F25\u002Ffirefoxs-low-latency-webassembly-compiler\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fwingolog.org\u002Farchives\u002F2020\u002F03\u002F25\u002Ffirefoxs-low-latency-webassembly-compiler\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EPereira, F. M. Q., &amp; Palsberg, J. (2006). Register Allocation After Classical SSA Elimination is NP-Complete. In L. Aceto &amp; A. Ingólfsdóttir (Eds.), Foundations of Software Science and Computation Structures (Vol. 3921, pp. 79–93). Springer Berlin Heidelberg. \u003Ca href=\\\"https:\u002F\u002Fdoi.org\u002F10.1007\u002F11690634_6\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fdoi.org\u002F10.1007\u002F11690634_6\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EWebAssembly. (n.d.). Retrieved June 19, 2021, from \u003Ca href=\\\"https:\u002F\u002Fwebassembly.org\u002F\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fwebassembly.org\u002F\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EWebAssembly compilation pipeline · V8. (n.d.). Retrieved June 19, 2021, from \u003Ca href=\\\"https:\u002F\u002Fv8.dev\u002Fdocs\u002Fwasm-compilation-pipeline\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fv8.dev\u002Fdocs\u002Fwasm-compilation-pipeline\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003EOjasvin Kirpane, Abhishek Cherath, Jo Gao &amp; Abhinuv Allu\u003C\u002Fem\u003E\u003C\u002Fp\u003E\",\"css\":{\"code\":\"\",\"map\":null},\"head\":\"\u003Clink rel=\\\"stylesheet\\\" href=\\\"https:\u002F\u002Fcdn.jsdelivr.net\u002Fnpm\u002Fkatex@0.12.0\u002Fdist\u002Fkatex.min.css\\\" integrity=\\\"sha384-AfEj0r4\u002FOFrOo5t7NnNe46zW\u002FtFgW6x\u002FbCJG8FqQCEo3+Aro6EYUG4+cU+KJWu\u002FX\\\" crossorigin=\\\"anonymous\\\" data-svelte=\\\"svelte-r30au3\\\"\u003E\u003Clink rel=\\\"stylesheet\\\" href=\\\"https:\u002F\u002Fcdn.jsdelivr.net\u002Fnpm\u002Fkatex@0.12.0\u002Fdist\u002Fkatex.min.css\\\" integrity=\\\"sha384-AfEj0r4\u002FOFrOo5t7NnNe46zW\u002FtFgW6x\u002FbCJG8FqQCEo3+Aro6EYUG4+cU+KJWu\u002FX\\\" crossorigin=\\\"anonymous\\\" data-svelte=\\\"svelte-r30au3\\\"\u003E\",\"readingTime\":\"42 min read\"}]},{\"slug\":\"1-mandel\",\"title\":\"One of the Fastest Web Mandelbrot Renderers\",\"date\":\"2021-06-21T00:00:00.000Z\",\"summary\":\"Our initial experiments rendering the Mandelbrot set with JavaScript, Web-workers & emerging web technologies like webassembly.\",\"thumbnail\":\"\u002Fblog-1-mandel-thumbnail.webp\",\"tags\":[\"Engineering\"],\"author\":\"Ojasvin Kirpane, Abhishek Cherath, Jo Gao & Abhinuv Allu\",\"html\":\"\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-1-mandel-thumbnail.webp\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\u003Ch2\u003EIntroduction\u003C\u002Fh2\u003E\\n\u003Cp\u003EHey, welcome to the Feather Systems blog. This is the first post of many, documenting our journey towards creating simpler systems for better performance on the web. This post will document our initial experiments rendering the Mandelbrot set with JavaScript, Web-workers &amp; emerging web technologies like webassembly. You can access the project \u003Ca href=\\\"https:\u002F\u002Fjs-wasm-mandelbrot-benchmark-3.vercel.app\u002F\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E and view the code \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002FAO-Design-Inc\u002Fjs-wasm-mandelbrot-benchmark\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E. These experiments were tested and measured by the team to properly document each technology’s advantages &amp; disadvantages.\u003C\u002Fp\u003E\\n\u003Cp\u003ETo elucidate, let’s start with fractals &amp; the mandelbrot set:\u003C\u002Fp\u003E\\n\u003Ch2\u003EThe Mandelbrot Set\u003C\u002Fh2\u003E\\n\u003Cp\u003EThe Mandelbrot Set is defined as the set of complex numbers for which the function \\n\\n\u003C!-- HTML_TAG_START --\u003E\u003Cspan class=\\\"katex\\\"\u003E\u003Cspan class=\\\"katex-mathml\\\"\u003E\u003Cmath xmlns=\\\"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML\\\"\u003E\u003Csemantics\u003E\u003Cmrow\u003E\u003Cmi\u003Ez\u003C\u002Fmi\u003E\u003Cmo\u003E∗\u003C\u002Fmo\u003E\u003Cmrow\u003E\u003Cmi\u003En\u003C\u002Fmi\u003E\u003Cmo\u003E+\u003C\u002Fmo\u003E\u003Cmn\u003E1\u003C\u002Fmn\u003E\u003C\u002Fmrow\u003E\u003Cmo\u003E=\u003C\u002Fmo\u003E\u003Cmsubsup\u003E\u003Cmi\u003Ez\u003C\u002Fmi\u003E\u003Cmi\u003En\u003C\u002Fmi\u003E\u003Cmn\u003E2\u003C\u002Fmn\u003E\u003C\u002Fmsubsup\u003E\u003Cmo\u003E+\u003C\u002Fmo\u003E\u003Cmi\u003Ec\u003C\u002Fmi\u003E\u003C\u002Fmrow\u003E\u003Cannotation encoding=\\\"application\u002Fx-tex\\\"\u003Ez*{n+1}=z_n^2+c\u003C\u002Fannotation\u003E\u003C\u002Fsemantics\u003E\u003C\u002Fmath\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"katex-html\\\" aria-hidden=\\\"true\\\"\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:0.4653em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord mathnormal\\\" style=\\\"margin-right:0.04398em;\\\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mbin\\\"\u003E∗\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:0.7278em;vertical-align:-0.0833em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord\\\"\u003E\u003Cspan class=\\\"mord mathnormal\\\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mbin\\\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord\\\"\u003E1\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2778em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mrel\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2778em;\\\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:1.0611em;vertical-align:-0.247em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord\\\"\u003E\u003Cspan class=\\\"mord mathnormal\\\" style=\\\"margin-right:0.04398em;\\\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\\\"msupsub\\\"\u003E\u003Cspan class=\\\"vlist-t vlist-t2\\\"\u003E\u003Cspan class=\\\"vlist-r\\\"\u003E\u003Cspan class=\\\"vlist\\\" style=\\\"height:0.8141em;\\\"\u003E\u003Cspan style=\\\"top:-2.453em;margin-left:-0.044em;margin-right:0.05em;\\\"\u003E\u003Cspan class=\\\"pstrut\\\" style=\\\"height:2.7em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"sizing reset-size6 size3 mtight\\\"\u003E\u003Cspan class=\\\"mord mathnormal mtight\\\"\u003En\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan style=\\\"top:-3.063em;margin-right:0.05em;\\\"\u003E\u003Cspan class=\\\"pstrut\\\" style=\\\"height:2.7em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"sizing reset-size6 size3 mtight\\\"\u003E\u003Cspan class=\\\"mord mtight\\\"\u003E2\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"vlist-s\\\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"vlist-r\\\"\u003E\u003Cspan class=\\\"vlist\\\" style=\\\"height:0.247em;\\\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mbin\\\"\u003E+\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2222em;\\\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:0.4306em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord mathnormal\\\"\u003Ec\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C!-- HTML_TAG_END --\u003E does not diverge when \\n\\n\u003C!-- HTML_TAG_START --\u003E\u003Cspan class=\\\"katex\\\"\u003E\u003Cspan class=\\\"katex-mathml\\\"\u003E\u003Cmath xmlns=\\\"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML\\\"\u003E\u003Csemantics\u003E\u003Cmrow\u003E\u003Cmsub\u003E\u003Cmi\u003Ez\u003C\u002Fmi\u003E\u003Cmn\u003E0\u003C\u002Fmn\u003E\u003C\u002Fmsub\u003E\u003Cmo\u003E=\u003C\u002Fmo\u003E\u003Cmn\u003E0\u003C\u002Fmn\u003E\u003C\u002Fmrow\u003E\u003Cannotation encoding=\\\"application\u002Fx-tex\\\"\u003Ez_{0}=0\u003C\u002Fannotation\u003E\u003C\u002Fsemantics\u003E\u003C\u002Fmath\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"katex-html\\\" aria-hidden=\\\"true\\\"\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:0.5806em;vertical-align:-0.15em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord\\\"\u003E\u003Cspan class=\\\"mord mathnormal\\\" style=\\\"margin-right:0.04398em;\\\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\\\"msupsub\\\"\u003E\u003Cspan class=\\\"vlist-t vlist-t2\\\"\u003E\u003Cspan class=\\\"vlist-r\\\"\u003E\u003Cspan class=\\\"vlist\\\" style=\\\"height:0.3011em;\\\"\u003E\u003Cspan style=\\\"top:-2.55em;margin-left:-0.044em;margin-right:0.05em;\\\"\u003E\u003Cspan class=\\\"pstrut\\\" style=\\\"height:2.7em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"sizing reset-size6 size3 mtight\\\"\u003E\u003Cspan class=\\\"mord mtight\\\"\u003E\u003Cspan class=\\\"mord mtight\\\"\u003E0\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"vlist-s\\\"\u003E​\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"vlist-r\\\"\u003E\u003Cspan class=\\\"vlist\\\" style=\\\"height:0.15em;\\\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2778em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mrel\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"mspace\\\" style=\\\"margin-right:0.2778em;\\\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"base\\\"\u003E\u003Cspan class=\\\"strut\\\" style=\\\"height:0.6444em;\\\"\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"mord\\\"\u003E0\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C!-- HTML_TAG_END --\u003E. An image of how the Mandelbrot set looks as follows. Points shaded black are in the set. We are using the Mandelbrot set to benchmark our code.\u003C\u002Fp\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-1-mandel-renderer.png\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\u003Cp\u003EThe Mandelbrot Set is stunning. We highly recommend getting lost in its beauty using our rendering website (\u003Ca href=\\\"https:\u002F\u002Fmandelbrot-ascript.vercel.app\u002F\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fmandelbrot-ascript.vercel.app\u002F\u003C\u002Fa\u003E). Click to zoom and Shift + Click to zoom out.\u003C\u002Fp\u003E\\n\u003Ch2\u003EBenchmark Structure\u003C\u002Fh2\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fjs-wasm-mandelbrot-benchmark-3.vercel.app\u002F\\\" rel=\\\"nofollow\\\"\u003EThe benchmarking site\u003C\u002Fa\u003E is designed to display each iteration we developed with a rough estimate for performance measured in milliseconds. For each version, a function was written to perform the Mandelbrot calculations and return a JavaScript ImageData object that could be easily put on the Canvas. Once the user selects a version from the drop down menu, the corresponding function is called. Since the functions can take some time to complete, they are called from a Web-worker to prevent the main thread from freezing while the function runs. The performance is calculated using \u003Ccode\u003Eperformance.now()\u003C\u002Fcode\u003E calls before and after the function call that returns the ImageData object.\u003C\u002Fp\u003E\\n\u003Cp\u003EAcross all iterations, I used the following values:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.300283\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.48857\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.01\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_width\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_height\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E i32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E1000\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003E\u003Cstrong\u003EFOR MULTITHREADED\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_THREADS\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EWe assume that the canvas width and height are integers. To determine if a point was in the Mandelbrot set, we iterated the Mandelbrot function on the point up to \u003Ccode\u003EITER_CONST\u003C\u002Fcode\u003E, returning the number of times the function had iterated. We use the returned Mandelbrot value to set the color.\u003C\u002Fp\u003E\\n\u003Cp\u003EYou may notice that RGB values get clamped at 255, making it seem like the exercise of iterating all the way to 1000 is just for the sake of testing performance, which it is. (Here is a whole list of \u003Ca href=\\\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FPlotting_algorithms_for_the_Mandelbrot_set\\\" rel=\\\"nofollow\\\"\u003Esmarter and better coloring algorithms\u003C\u002Fa\u003E that we will not be using in this benchmarking exercise.)\u003C\u002Fp\u003E\\n\u003Cp\u003EAs of when this article was published, the following versions are available on the Benchmarking Site:\u003C\u002Fp\u003E\\n\u003Cul\u003E\u003Cli\u003ENaive JS single threaded\u003C\u002Fli\u003E\\n\u003Cli\u003ERust WASM using bindgen (single threaded)\u003C\u002Fli\u003E\\n\u003Cli\u003EAssemblyscript old version (single threaded, not thread safe)\u003C\u002Fli\u003E\\n\u003Cli\u003EAssemblyscript new version (single threaded, thread safe)\u003C\u002Fli\u003E\\n\u003Cli\u003EAssemblyscript SIMD WASM (singlethreaded, multithreaded)\u003C\u002Fli\u003E\\n\u003Cli\u003ENew JS(less memory allocation) singlethreaded\u003C\u002Fli\u003E\\n\u003Cli\u003ENew JS SharedMemoryBuffer multithreaded\u003C\u002Fli\u003E\u003C\u002Ful\u003E\\n\u003Cbr\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003EImplementing the Mandelbrot Set in JavaScript \u003Cem\u003Eby Abhinuv Allu\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\\n\u003Cdetails\u003E\u003Csummary\u003EClick to Read\u003C\u002Fsummary\u003E\\n\u003Cp\u003EI began the testing process with the web’s best frenemy, Javascipt.\u003C\u002Fp\u003E\\n\u003Cp\u003EI started with a naive approach to implement the Mandelbrot set in JavaScript and then try and optimize later. I started by creating a class for Complex numbers. This class would be able to add, multiply and return the magnitude. For the magnitude, I used a library function Math.hypot. Down below is our first initial implementation of the Complex class.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Econstructor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ereal\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E imag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E real\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E imag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FFunction that add this complex number with another complex number, cplx\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Eadd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ecplx\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FFuction that returns the magnitude of this complex number\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Emag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ecplx\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ehypot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FFunction that multiplies this complex number with another complex number, cplx\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Emul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ecplx\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E real_part \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E imag_part \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E real_part\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E imag_part\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe program iterated through each element of the canvas to compute whether or not they were in the Mandelbrot set.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Ecplx\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E z \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E count \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Ewhile\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ez\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&lt;=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E2\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;&amp;\u003C\u002Fspan\u003E count \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\tz \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E z\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ez\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eadd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tcount\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThese data points were added to an array which is then painted onto the Canvas. I had some ideas about optimizations with help from the profiler, however the most fascinating insight was that the Math.hypot function for two numbers is an order of magnitude slower than squaring, adding, and then computing the square root. During the profiling of the initial code I found out that Math.hypot was taking up most of the time.\u003C\u002Fp\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-1-mandel-hypnot.png\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\\n\u003Ch3\u003EImproved JavaScript\u003C\u002Fh3\u003E\\n\u003Cp\u003ETo improve the initial naive approach, I decided to add multithreading. I started this with a naive way of having the worker compute each point and then send it back to receive the next point but, the message overhead was immense and resulted in a single threaded function as I only had one worker. The next step was experimenting with divisibility classes to add multiple workers. But this had the same problem where the overhead of sending &amp; receiving a message from the workers was just too much. Eventually, I figured out that I would have each worker compute a set number of rows at a time.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FThis is in the main function which calls the workers to do the work\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003EworkerCount\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E worker \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EWorker\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"worker.js\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EINDEXES_PER_WORKER\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efloor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003EworkerCount\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efloor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003EworkerCount\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_XC\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_INDEX\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EINDEXES_PER_WORKER\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EEND_INDEX\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_INDEX\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EINDEXES_PER_WORKER\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n  worker\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function-variable function\\\"\u003Eonmessage\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003Edata\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECOMPUTED_ROWS\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E data\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    points_array\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Ei\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECOMPUTED_ROWS\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n     doneCount\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EdoneCount \u003Cspan class=\\\"token operator\\\"\u003E==\u003C\u002Fspan\u003E workerCount\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n      points_array \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E points_array\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eflat\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\n      \u003Cspan class=\\\"token function\\\"\u003Edraw\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Epoints_array\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FThis is how it looks now in the worker function\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token function-variable function\\\"\u003Eonmessage\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E data \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_XC\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E data\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E points_in_thread \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EArray\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E2.0\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_XC\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tcount_x \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tx \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E2.0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\tpoints_in_thread\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Ecount_x \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E count_y\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ey\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E x\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003EpostMessage\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Epoints_in_thread\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Ch3\u003EShared Buffer\u003C\u002Fh3\u003E\\n\u003Cp\u003ESince all the points would be added to the same array it would make sense that having a shared buffer to reduce the overhead needed to send array points would decrease the compute time. So I added a shared buffer that was formatted like an ImageData object so it would be easier to paint it onto the canvas. This required some rewriting of the some steps here and there, but it ended up being faster.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe other issue with using a Shared Buffer is that I had to add promises to the code, so werefactored it to include promises.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FThis is in the main function which calls the workers to do the work\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EPromise\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003Eresolve\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E worker \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EWorker\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"benchmarks\u002Fmultithreaded-js\u002Fsharedworker.js\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    worker\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EpostMessage\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Eparameters\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    worker\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function-variable function\\\"\u003Eonmessage\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n      \u003Cspan class=\\\"token function\\\"\u003Eresolve\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"worker finished\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003EreturnSharedBufferjs\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECANVAS_WIDTH\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECANVAS_HEIGHT\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECANVAS_WIDTH\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ECANVAS_HEIGHT\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E window \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E window\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E window\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E workerCount \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E sharedBuffer \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003ESharedArrayBuffer\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EY_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E sharedArray \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EUint8ClampedArray\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EsharedBuffer\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  sharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efill\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n  \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Efloor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003EworkerCount\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n  \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E parameters \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E sharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token keyword\\\"\u003Evar\u003C\u002Fspan\u003E promises \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n  \u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003EworkerCount\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\n    parameters\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E i\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    promises\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Epush\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003EcreateWorker\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Eparameters\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002FThis is how it looks now in the worker function\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token function-variable function\\\"\u003Eonmessage\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E data \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\\n\\t\\tsharedArray\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E data\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tcount_y \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EN_ROWS_PER_THREAD\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_YC\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\ty \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTEP_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E index \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecount_x \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EX_LEN\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\\tval \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ex\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E y\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\\tsharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Eindex \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E val\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\\tsharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Eindex \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E val\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\\tsharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Eindex \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E val\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\\tsharedArray\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003Eindex \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003EpostMessage\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E'done'\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThese changes made the code perform a lot better. You can check out it’s performance in the ”\u003Ca href=\\\"https:\u002F\u002Fwww.notion.so\u002FOn-WebAssembly-Performance-and-the-Mandelbrot-WORKING-TITLE-96760f3f113343c894c00f52cdef3ef0\\\" rel=\\\"nofollow\\\"\u003EResults\u003C\u002Fa\u003E” section. JavaScript was extremely performant (especially on Chrome) and gave us hope that pushing the boundaries of speed on the web was possible.\u003C\u002Fp\u003E\u003C\u002Fdetails\u003E\\n\u003Cbr\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003ESo, What is Webassembly? \u003Cem\u003Eby Abhishek Cherath\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\\n\u003Cdetails\u003E\u003Csummary\u003EClick to Read\u003C\u002Fsummary\u003E\\n\u003Cp\u003EIn our quest to further optimize performance, we used webassembly, an emerging web technology optimized for what we are trying to achieve. So, what is it?\\nInsofar as an overview is concerned, nothing beats Lin Clark’s cartoon intro \u003Ca href=\\\"https:\u002F\u002Fhacks.mozilla.org\u002F2017\u002F02\u002Fa-cartoon-intro-to-webassembly\u002F\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E, and the MDN docs \u003Ca href=\\\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWebAssembly\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E. Put simply, webassembly is a low level typed language that targets the browser’s VM. For some reasons[1] , it’s very quick and easy to compile into decently fast machine code.\u003C\u002Fp\u003E\\n\u003Cp\u003EFundamentally, the language was designed to offer the best possible latency (time to execution) and speed of execution. Low latency is achieved by having a small binary representation (vs javascript’s textual representation) and having type definitions and a function table at the start of a .wasm module, which allows compilers to compile in a streaming fashion, instead of needing to have access to the entire file before starting.\u003C\u002Fp\u003E\\n\u003Cp\u003ESpeed of execution requires slow compilation with multiple passes for the compiler to accurately assess the best register allocation, optimize out unnecessary instructions and do whatever other things compilers do. (\u003Cem\u003Enote: I have frankly no idea what goes into compiler optimization, I just know it takes time\u003C\u002Fem\u003E)\u003C\u002Fp\u003E\\n\u003Cp\u003ETo satisfy both these goals, browsers (atleast Firefox and Chrome) have two compilers for webassembly, the first compiles the module as it’s called from the network, and is basically instant (\u003Ca href=\\\"https:\u002F\u002Fv8.dev\u002Fdocs\u002Fwasm-compilation-pipeline\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E, chrome devs claim that theirs can do on the order of 10+ mb of code per second, so the bottleneck will almost always be the speed of the network rather than the compiler.) The second does optimization and dynamically replaces the unoptimized bytecode from the first when it’s done.\u003C\u002Fp\u003E\\n\u003Cp\u003EIt’s interesting to note here that, \u003Cem\u003Ea priori\u003C\u002Fem\u003E there’s no reason to expect that webassembly code for high performance stuff [2] (like fractal calculation) will be any faster than its javascript counterpart. Since the hot loop (calculating escape time) is running many thousands of times, one would expect the javascript JIT compiler to infer the output types and get basically similar bytecode, while amortizing its greater overhead considering workload size.\u003C\u002Fp\u003E\\n\u003Cp\u003EIn a later article, I will be examining this conjecture, and taking a deeper look at the flamegraphs and bytecode generated by our benchmarks.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe other interesting thing about webassembly is its memory model, programs do not have access to their own instructions and stack machine memory (so no self modifying code, and no messing with values on the stack). What they do have access to is a block of linear memory, which is backed by a javascript ArrayBuffer, and byte addressed (ie. memory[0] is 1 byte long.)\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003E[1]I’m not entirely sure why, but it’s some combination of coding for a simple stack machine, having type information, linear memory, and being easy to parse.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003E[2]This is \u003Cstrong\u003Emostly\u003C\u002Fstrong\u003E true, except for vectorization. SIMD (Single Instruction Multiple Data) instructions are featured in the webassembly spec and implemented by chrome and firefox, which do not expose them in js, and have no plans to do so. (although\u003C\u002Fem\u003E I \u003Cem\u003Esuppose there’s nothing stopping a JIT from autovectorizing, is there?)\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Fdetails\u003E\\n\u003Cbr\u003E\u003Cbr\u003E\\n\u003Cblockquote\u003E\u003Cp\u003E\u003Cstrong\u003EOur Approach to webassembly\u003C\u002Fstrong\u003E: As many languages can be compiled to webassembly, we looked at two of the most commonly used ones: Rust &amp; AssemblyScript. In the following sections we will describe our approach to these two languages.\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\\n\u003Cbr\u003E\u003Cbr\u003E\\n\u003Ch2\u003ERust Implementation \u003Cem\u003Eby Jo Gao\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\\n\u003Cdetails\u003E\u003Csummary\u003EClick to Read\u003C\u002Fsummary\u003E\\n\u003Ch3\u003ESinglethreaded\u003C\u002Fh3\u003E\\n\u003Cp\u003EI wrote a similar implementation of the function in Rust that would return an ImageData object of the Mandelbrot Set. It uses \u003Ca href=\\\"https:\u002F\u002Frustwasm.github.io\u002Fwasm-bindgen\u002F\\\" rel=\\\"nofollow\\\"\u003Ewasm-bindgen\u003C\u002Fa\u003E, a Rust library that will compile Rust code to webassembly, and then generate the bindings and glue between JavaScript and webassembly so that it can be run on the web. It handles all the type conversions between JavaScript and webassembly and facilitates the compilation of Rust to webassembly.\u003C\u002Fp\u003E\\n\u003Cp\u003EIn the iterative \u003Ccode\u003Ein_mandelbrot\u003C\u002Fcode\u003E function, \u003Ccode\u003Ecount\u003C\u002Fcode\u003E is set to iterate all the way to 1000 for benchmarking purposes. When returning, \u003Ccode\u003Ecount\u003C\u002Fcode\u003E is set to 255 if larger than 255 to prevent having to cast numbers larger than 255 to u8.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-rust\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-rust\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Efn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function-definition function\\\"\u003Ein_mandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E-\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu8\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E1000\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Emut\u003C\u002Fspan\u003E z \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ebuild_complex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Emut\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Ewhile\u003C\u002Fspan\u003E z\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&lt;=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E2.0\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;&amp;\u003C\u002Fspan\u003E count \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n        z \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ez\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Esquare\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eadd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002F z = z^2 + cplx\u003C\u002Fspan\u003E\\n        count \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E count \u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E255\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n        count \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E255\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n    count \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu8\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe magic of wasm-bindgen kicks in here, allowing us to create the ImageData object right in the Rust code by providing the type and the constructor signature:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-rust\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-rust\\\"\u003E\u003Cspan class=\\\"token attribute attr-name\\\"\u003E#[wasm_bindgen]\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Eextern\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E\\\"C\\\"\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Epub\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Etype\u003C\u002Fspan\u003E \u003Cspan class=\\\"token type-definition class-name\\\"\u003EImageData\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token attribute attr-name\\\"\u003E#[wasm_bindgen(constructor, catch)]\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Efn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function-definition function\\\"\u003Enew\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Edata\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token class-name\\\"\u003EUint8ClampedArray\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E width\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E height\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E-\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EResult\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token class-name\\\"\u003EImageData\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EJsValue\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token attribute attr-name\\\"\u003E#[wasm_bindgen]\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Epub\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function-definition function\\\"\u003Erun\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Estart_x\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E start_y\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E width\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E height\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E window\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E-\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EImageData\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E y_len\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E height \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E x_len\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E width \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ei32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E pixels\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eusize\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ex_len \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E y_len\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eusize\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Emut\u003C\u002Fspan\u003E points_array \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token macro property\\\"\u003Evec!\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E pixels\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token function\\\"\u003Efill_mandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Emut\u003C\u002Fspan\u003E points_array\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E start_x\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E start_y\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E x_len\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E y_len\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E window\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E pointer \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E points_array\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eas_ptr\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eusize\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E mem \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token namespace\\\"\u003Ewasm_bindgen\u003Cspan class=\\\"token punctuation\\\"\u003E::\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ememory\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eunchecked_into\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\\\"token class-name\\\"\u003EWebAssembly\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\\\"token class-name\\\"\u003EMemory\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E new_array \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EUint8ClampedArray\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Enew\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Emem\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ebuffer\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eslice\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Epointer \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Epointer \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E pixels\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eas\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Eu32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token class-name\\\"\u003EImageData\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Enew\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Enew_array\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E x_len\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Einto\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E y_len\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Einto\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eunwrap\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EAfter compiling this code, wasm-bindgen outputs a number of files that are meant to be bundled using \u003Ca href=\\\"https:\u002F\u002Fwebpack.js.org\u002F\\\" rel=\\\"nofollow\\\"\u003EWebpack\u003C\u002Fa\u003E and imported to your JavaScript file as an ES6 module, allowing access to the functions that were written in Rust. The idea is that after compiling and importing the module, calling \u003Ccode\u003Erun(...)\u003C\u002Fcode\u003Ewould return a whole JavaScript ImageData Object.\u003C\u002Fp\u003E\\n\u003Cp\u003EUnfortunately, our Benchmarking Site is structured to use a web worker to call this function. Modules cannot be imported to web workers. However, they can be imported to module workers, web workers that support module import, but as of today, Firefox does not support this feature.\u003C\u002Fp\u003E\\n\u003Cp\u003EThis is an infeasible solution because I was unwilling to limit the availability of our benchmark site for this implementation. After many hours of tinkering with the existing setup, I found a workaround that eliminated the need for Webpack altogether: after compiling with wasm-bindgen, I copy and pasted the entire outputted .js file with the import and exports removed, appended the wrapper function I had written to it, and called \u003Ccode\u003Einit(...)\u003C\u002Fcode\u003E on the outputted .wasm.\u003C\u002Fp\u003E\\n\u003Cp\u003EAfter confirming that this worked, A colleague and I wrote a shell script to automatically do this after compilation. Albeit a little unpleasant on the eyes, it does the job:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-bash\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-bash\\\"\u003E\u003Cspan class=\\\"token function\\\"\u003Esed\u003C\u002Fspan\u003E \u003Cspan class=\\\"token string\\\"\u003E'\u002FimportW\u002Fd;s\u002F^export\u002F\u002Fg;\u002Fdefault\u002Fd'\u003C\u002Fspan\u003E pkg\u002FMandelbrot.js \u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E tmp_mandel_import.js\\n\u003Cspan class=\\\"token function\\\"\u003Ecat\u003C\u002Fspan\u003E tmp_mandel_import.js  mandel_src.js \u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E Mandelbrot.js\\n\u003Cspan class=\\\"token function\\\"\u003Erm\u003C\u002Fspan\u003E tmp_mandel_import.js\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Ch3\u003ERust &amp; Webassembly Multi-Threaded\u003C\u002Fh3\u003E\\n\u003Cp\u003ETo further improve performance in Rust, I carried out the same calculations, but in parallel this time. An advantage of the Mandelbrot Set is that determining whether a pixel falls within the set or not can be done completely independently of other pixels. The outcome of each pixel has no effect on the others, making the transition to multithreading straightforward.\u003C\u002Fp\u003E\\n\u003Cp\u003EI used the \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Frustwasm\u002Fwasm-bindgen\u002Ftree\u002Fmaster\u002Fexamples\u002Fraytrace-parallel\\\" rel=\\\"nofollow\\\"\u003EParallel Raytracing example\u003C\u002Fa\u003E. given in the Wasm-Bindgen repo, as a starting point. Using a combination of web workers and the Rayon Crate for data parallelism in Rust yielded a pretty fast multithreaded Mandelbrot Set.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003EUnfortunately,\u003C\u002Fem\u003E I \u003Cem\u003Ewas unable to include this version of the Mandelbrot in the final Benchmarking website\u003C\u002Fem\u003E because I ran into a similar problem with the wasm-bindgen and module output. This time, it was further complicated by the Webworkers being created from within the Rust code. The funky workaround that had allowed for the singlethreaded RustWasm example to run on the Benchmarking Site failed to work the same magic for this implementation.\u003C\u002Fp\u003E\\n\u003Cp\u003EThis version of the Mandelbrot also makes use of the SharedArrayBuffer, and had it been on the site, would not work in Safari and browsers that do not support SharedArrayBuffer Objects.\u003C\u002Fp\u003E\u003C\u002Fdetails\u003E\\n\u003Cbr\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003EAssemblyScript \u003Cem\u003Eby Abhishek Cherath\u003C\u002Fem\u003E\u003C\u002Fh2\u003E\\n\u003Cdetails\u003E\u003Csummary\u003EClick to Read\u003C\u002Fsummary\u003E\\n\u003Cp\u003EAssemblyScript compiles a subset of typescript to webassembly. To get an idea of how simple it is to write it, here’s essentially the same javascript code from earlier, with type annotations and minor changes for webassembly:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003Edeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ecanvas_width\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E i32\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\ndeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ecanvas_height\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E i32\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\ndeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E i16\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\ndeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32\\ndeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32\\ndeclare \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32\\n\\n@unmanaged\\n\u003Cspan class=\\\"token keyword\\\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token literal-property property\\\"\u003Ereal\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token literal-property property\\\"\u003Eimag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token function\\\"\u003Econstructor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Ereal\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Eimag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E real\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E imag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\\t@inline\\n\\t\u003Cspan class=\\\"token function\\\"\u003Eadd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E Complex\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E Complex \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E cplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\\t@inline\\n\\t\u003Cspan class=\\\"token function\\\"\u003Emag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E f64 \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E Math\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Esqrt\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\\t@inline\\n\\t\u003Cspan class=\\\"token function\\\"\u003Emul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E Complex\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E Complex \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E __tempr  \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E __tempi \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E __tempr\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E __tempi\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token function\\\"\u003Eset\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Eimag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ereal \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E real\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eimag \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E imag\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ez\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003EComplex \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ecplx\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003EComplex \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"token class-name\\\"\u003EComplex\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\\n@inline\\n\u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Ereal\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Eimag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ei16\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\tz\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eset\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\\tcplx\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eset\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ereal\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003Eimag\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ecount\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ei16 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E z\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emag\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&lt;=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ez\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Emul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ez\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Eadd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecplx\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002F z = z^2 + cplx\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecount \u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token comment\\\"\u003E\u002F*\\nstores array of i16s at start of memory\\ncorresponding to escape count at pixels in\\narray\\n*\u002F\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ecompute\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E memcounter \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_width\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_height\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E canvas_height\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E step_Y\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E canvas_width\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E step_X\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\tstore\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ei16\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(memcounter, mandelbrot(x,y));\\n\\t\\t\\tmemcounter += 2\\n\\t\\t&#125;\\n\\t&#125;\\n&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe only really noteworthy change was to not have \u003Ccode\u003Enew\u003C\u002Fcode\u003E in the hot loop. The Assemblyscript garbage collector had some trouble with it and total allocation would exceed webassembly’s 100 page memory limit[1]. I suspect that sort of code will be usable once the webassembly GC proposals, which allow wasm modules to hook into the browser’s GC, are implemented.\u003C\u002Fp\u003E\\n\u003Ch3\u003EThreading\u003C\u002Fh3\u003E\\n\u003Cp\u003EThe fastest way to thread code in browsers is to use \u003Ca href=\\\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FJavaScript\u002FReference\u002FGlobal_Objects\u002FSharedArrayBuffer\\\" rel=\\\"nofollow\\\"\u003ESharedArrayBuffer\u003C\u002Fa\u003E, this also requires the following CORS headers.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003ECross\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EOrigin\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EOpener\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EPolicy\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E same\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Eorigin\\nCross\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EOrigin\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EEmbedder\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003EPolicy\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E require\u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003Ecorp\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThis is to ensure cross-origin isolation, which protects against memory being exfiltrated somehow (I might explore this in the future, but that’s about all I know for the moment.) webassembly memories can also be created with a backing SharedArrayBuffer, which allows fast multithreading, as separate web-workers can run the same webassembly module and write their results to the same memory, meaning that large objects don’t need to be passed around using postmessage, and the many O(N) overheads to do with copying and creating new arrays can be avoided.\u003C\u002Fp\u003E\\n\u003Cp\u003EHowever, while Assemblyscript \u003Ca href=\\\"https:\u002F\u002Fwww.assemblyscript.org\u002Fstdlib\u002Fbuiltins.html#atomics-%F0%9F%A6%84\\\" rel=\\\"nofollow\\\"\u003Eallows\u003C\u002Fa\u003E access to atomic instructions, it does not implement any sort of locking. So any program that reads and writes to memory will need to be adjusted to thread with shared memory. This means that the program seen above, with its Complex class and set calls reading and wrxiting to the linear memory quite often, is very prone to… interesting behaviour when threaded.\u003C\u002Fp\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-1-mandel-glitch.png\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\\n\u003Cp\u003EExhibit A of nondeterministic behavior\u003C\u002Fp\u003E\\n\u003Cp\u003EThat being said, for small examples such as fractal calculation, it’s quite easy to limit mutability to local variables (which are on the stack, not in the linear memory, and so are not shared) and avoid the problem entirely. Like in the following code:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E@inline\\n\u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Ec_r\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ec_i\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ei16\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ecount\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ei16 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ez_r\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ez_i\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Et_r\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Et_i\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef64 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E z_r\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_r \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E z_i\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_i \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\tt_r \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E z_r\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_r \u003Cspan class=\\\"token operator\\\"\u003E-\u003C\u002Fspan\u003E z_i\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_i \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E c_r\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tt_i \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_i\u003Cspan class=\\\"token operator\\\"\u003E*\u003C\u002Fspan\u003Ez_r \u003Cspan class=\\\"token operator\\\"\u003E+\u003C\u002Fspan\u003E c_i\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tz_r \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E t_r\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\tz_i \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E t_i\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Eif\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecount \u003Cspan class=\\\"token operator\\\"\u003E\u003E\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONST\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Ebreak\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E count\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token punctuation\\\"\u003E&#125;\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token comment\\\"\u003E\u002F*\\nstores array of i16s at start of memory\\ncorresponding to escape count at pixels in\\narray\\n*\u002F\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"token keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ecompute\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Evoid\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E memcounter \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_X\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_width\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Estep_Y\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ef32 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EWINDOW\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E\u002F\u003C\u002Fspan\u003E\u003Cspan class=\\\"token function\\\"\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ecanvas_height\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_Y_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_y \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E canvas_height\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E y \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E step_Y\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_y\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\u003Cspan class=\\\"token keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003ESTART_X_TOTAL\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E count_x \u003Cspan class=\\\"token operator\\\"\u003E&lt;\u003C\u002Fspan\u003E canvas_width\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E x \u003Cspan class=\\\"token operator\\\"\u003E+=\u003C\u002Fspan\u003E step_X\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E count_x\u003Cspan class=\\\"token operator\\\"\u003E++\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n\\t\\t\\tstore\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ei16\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(memcounter, mandelbrot(x,y));\\n\\t\\t\\tmemcounter += 2\\n\\t\\t&#125;\\n\\t&#125;\\n&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003E\u003Cem\u003Enote that the store instruction there might look like it would cause issues, but as long as threads work on different parts of the image, that should not be a problem.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Ch3\u003ESIMD\u003C\u002Fh3\u003E\\n\u003Cp\u003ESIMD (Single Instruction Multiple Data) instructions are special instructions on the CPU that allow multiple additions, multiplications etc to be carried out in parallel on the same core)\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cimg src=\\\"https:\u002F\u002Fupload.wikimedia.org\u002Fwikipedia\u002Fcommons\u002Fc\u002Fce\u002FSIMD2.svg\\\" alt=\\\"SIMD Explaination\\\"\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EBy Vadikus - Own work, CC BY-SA 4.0, \u003Ca href=\\\"https:\u002F\u002Fcommons.wikimedia.org\u002Fw\u002Findex.php?curid=39715273\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fcommons.wikimedia.org\u002Fw\u002Findex.php?curid=39715273\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EThey’re not in the webassembly spec as yet, but should be \u003Ca href=\\\"https:\u002F\u002Fwebassembly.github.io\u002Fsimd\u002Fcore\u002Fexec\u002Finstructions.html#simd-instructions\\\" rel=\\\"nofollow\\\"\u003Esoon\u003C\u002Fa\u003E, and are currently available on chrome and firefox (although not on ARM in firefox 89, ie. apple M1.) Assemblyscript does not autovectorize code, but \u003Ca href=\\\"https:\u002F\u002Fwww.assemblyscript.org\u002Fstdlib\u002Fbuiltins.html#simd-%F0%9F%A6%84\\\" rel=\\\"nofollow\\\"\u003Eallows\u003C\u002Fa\u003E access to the instructions, and provides some sugar for different types and functions to initialise constant vectors.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe vector size in the proposal is 128 bit, which is a decent compromise and is backed by hardware instructions on most modern computers. In the future, \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002FWebAssembly\u002Fflexible-vectors\\\" rel=\\\"nofollow\\\"\u003Eflexible vectors\u003C\u002Fa\u003E, should be able to allow access to 256, 512 bit vectors that modern intel and AMD CPUs support (consumer ARM chips currently only have 128 bit vectors, as far as I’m aware, although \u003Ca href=\\\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FAArch64#Scalable_Vector_Extension_(SVE)\\\" rel=\\\"nofollow\\\"\u003Esupercomputer ARM chips do have 512 bit vectors\u003C\u002Fa\u003E.)\u003C\u002Fp\u003E\\n\u003Cp\u003EVectorizing the mandelbrot code above is not too bad, althought it does look rather messy:\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-jsx\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-jsx\\\"\u003E@inline\\n\u003Cspan class=\\\"token keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emandelbrot_simd\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token parameter\\\"\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Ec_rl\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ev128\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token literal-property property\\\"\u003Ec_il\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ev128\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ev128\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ein_set\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E v128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ei32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ez_r\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E v128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Ez_i\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E v128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Et_r\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E v128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\\\"token literal-property property\\\"\u003Et_i\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003E v128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E0.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E ones \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ei32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E fours \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Ef32x4\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\\\"token number\\\"\u003E4.\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"token keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"token constant\\\"\u003EITER_CONSTS\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E:\u003C\u002Fspan\u003Ev128 \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E v128\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Esplat\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ei32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(ITER_CONST);\\n    let count:v128=i32x4(0,0,0,0)\\n    for(\\n        let total_count:i32 = 0, any_in_convergence_region:boolean = true;\\n        any_in_convergence_region &amp;&amp;\\n        total_count &lt; ITER_CONST;\\n        total_count++;\\n    ) \u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E\\n        z_i \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E v128\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Eadd\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(c_il, v128.mul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(v128.add\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(z_r,z_r),z_i));\\n        z_r = v128.add\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(c_rl, v128.sub\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(t_r,t_i));\\n        t_r = v128.mul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(z_r,z_r);\\n        t_i = v128.mul\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(z_i,z_i);\\n        const mask = v128.le\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(v128.add\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ef32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(t_r,t_i),fours);\\n        any_in_convergence_region = v128.any_true(mask);\\n        count = v128.add\u003C\u002Fspan\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token tag\\\"\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&lt;\u003C\u002Fspan\u003Ei32\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"token plain-text\\\"\u003E(count, v128.and(ones,mask));\\n    &#125;\\n    return count;\\n&#125;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThis should basically be a 4x speedup over the previous code, when run single threaded. Multithreaded, that number will vary depending on how threads are allocated, as work only gets completed as fast as the slowest thread.\u003C\u002Fp\u003E\\n\u003Ch3\u003ECompiler Flags\u003C\u002Fh3\u003E\\n\u003Cp\u003EFor the examples above, some memory is reserved for the purposes of storing the image, in assemblyscript this is achieved by passing the \u003Ccode\u003E--memoryBase\u003C\u002Fcode\u003E flag to the \u003Ccode\u003Easc\u003C\u002Fcode\u003E compiler (as seen in the makefile below)\u003C\u002Fp\u003E\\n\u003Cp\u003EThe other flags are tuned for maximum performance (thanks to \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002FMaxGraey\\\" rel=\\\"nofollow\\\"\u003EMax Graey\u003C\u002Fa\u003E for -O3 instead of -O3s\u002Fz) and to enable necessary features (threads, SIMD.)\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-makefile\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-makefile\\\"\u003EMEMORY_FLAGS \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E --maximumMemory 80 --importMemory --noExportMemory --initialMemory 80 --memoryBase 4000000\\nOPTIMIZATION_FLAGS \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E -O3 --converge\\nDEBUG_FLAGS \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E --sourceMap\\nFEATURE_FLAGS \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E --enable simd --enable threads\\nRUNTIME_FLAGS \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E --runtime stub\\n\u003Cspan class=\\\"token target symbol\\\"\u003Estart\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E install\\n\\tnpx asc assembly\u002Fmandel_final.ts -b build\u002Fmandel_final.wasm -t build\u002Fmandel_final.wat \u003Cspan class=\\\"token variable\\\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EOPTIMIZATION_FLAGS\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token variable\\\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EMEMORY_FLAGS\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token variable\\\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EFEATURE_FLAGS\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token variable\\\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003ERUNTIME_FLAGS\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\\\"token variable\\\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003EDEBUG_FLAGS\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"token target symbol\\\"\u003Einstall\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E:\u003C\u002Fspan\u003E\\n\\tnpm i\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Ch3\u003EMultithreaded SIMD Speed\u003C\u002Fh3\u003E\\n\u003Cp\u003EBenchmark results will be discussed near the end of this article, but the speed of the multithreaded SIMD code is quite astonishing, roughly 3x the speed of multithreaded JS using sharedarraybuffers, and I’m guessing that’s held back by module message passing overheads. \u003Ca href=\\\"https:\u002F\u002Fmandelbrot-ascript.vercel.app\u002F\\\" rel=\\\"nofollow\\\"\u003EHERE\u003C\u002Fa\u003E is a basic mandelbrot zoom implementation using it (only works in firefox(≥90 on apple m1) and chrome, \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fpretentious7\u002Fmandelbrot-ascript\\\" rel=\\\"nofollow\\\"\u003Ehere’s\u003C\u002Fa\u003E the github repo.) I’ll be working in boundary estimation and period checking along with xaos zoom algorithm into it in a couple of months, so stay tuned for that!\u003C\u002Fp\u003E\\n\u003Cp\u003EI’m also fairly certain that this is the first(?) SIMD mandelbrot implementation for webassembly, so if anyone wants to use it for anything (under the terms of the GPLv3 License) feel free!\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003E[1] A page being 64KiB (65,536 bytes), so about 6.5 mb max memory\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Fdetails\u003E\\n\u003Cbr\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003EResults\u003C\u002Fh2\u003E\\n\u003Cp\u003EFirst, we know that our benchmarks here are not rigorous in the slightest. Their purpose was to give us an idea of the rough performance capabilities of the tools we’re working with, to help inform our choices as we port certain programs (stay tuned!) to webassembly. We will be refining this tool in the future, and hope to have (somehow) bytecode outputs and flamegraphs on the site.\u003C\u002Fp\u003E\\n\u003Ctable\u003E\u003Cthead\u003E\u003Ctr\u003E\u003Cth\u003EBenchmark\u003C\u002Fth\u003E\\n\u003Cth\u003EFirefox 89(ms)\u003C\u002Fth\u003E\\n\u003Cth\u003EChrome 91 (ms)\u003C\u002Fth\u003E\u003C\u002Ftr\u003E\u003C\u002Fthead\u003E\\n\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003ENaive-js\u003C\u002Ftd\u003E\\n\u003Ctd\u003E2992\u003C\u002Ftd\u003E\\n\u003Ctd\u003E631\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003EImproved-js\u003C\u002Ftd\u003E\\n\u003Ctd\u003E1755\u003C\u002Ftd\u003E\\n\u003Ctd\u003E292\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003EMultithreaded-js\u003C\u002Ftd\u003E\\n\u003Ctd\u003E705\u003C\u002Ftd\u003E\\n\u003Ctd\u003E129\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003ESinglethreaded-Rust * **\u003C\u002Ftd\u003E\\n\u003Ctd\u003E296\u003C\u002Ftd\u003E\\n\u003Ctd\u003E300\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003ESimple Assemblyscript\u003C\u002Ftd\u003E\\n\u003Ctd\u003E494\u003C\u002Ftd\u003E\\n\u003Ctd\u003E497\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003EOptimized non-SIMD AssemblyScript\u003C\u002Ftd\u003E\\n\u003Ctd\u003E250\u003C\u002Ftd\u003E\\n\u003Ctd\u003E262\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003EOptimized SIMD AssemblyScript\u003C\u002Ftd\u003E\\n\u003Ctd\u003E124\u003C\u002Ftd\u003E\\n\u003Ctd\u003E108\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\\n\u003Ctr\u003E\u003Ctd\u003ESIMD Multithreaded AssemblyScript\u003C\u002Ftd\u003E\\n\u003Ctd\u003E43\u003C\u002Ftd\u003E\\n\u003Ctd\u003E43\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\\n\u003Cp\u003E\u003Cem\u003EAll numbers approximate, gathered from fresh browser session after reboot on an HP Envy 13 with an i5-8265U CPU @ 1.60GHz and 8gb of RAM running Ubuntu 20.04.2 with kernel 5.8.0. Average of 5 runs (first 2 runs dropped)\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EThe results of our benchmark (at least approximately) line up with what one would expect, but we find a few items of interest. First, as far as the javascript implementations are concerned, Firefox is \u003Cem\u003Esignificantly\u003C\u002Fem\u003E slower than chrome. Second, webassembly speeds are comparable for both browsers.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe performance advantage of webassembly (without SIMD) over javascript for this benchmark is basically negligible for chrome. In a future article it’ll be interesting to see whether the bytecode generated is also similar.\u003C\u002Fp\u003E\\n\u003Cp\u003EBut the key insight here is clear, webassembly offers \u003Cem\u003Epredictable\u003C\u002Fem\u003E performance, across browser engines. We’ll be adding fallbacks for safari later to see if this holds there as well. Further, we’ll compare the results to native code.\u003C\u002Fp\u003E\\n\u003Cp\u003E*\u003Cem\u003EThe rust code can likely be sped up with some optimizations here and there, but for a rough effort from a novice rust programmer, this is representative.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003E** The rust code was improved by @MaxGraey and now lines up with what one would expect\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003ESee the demo \u003Ca href=\\\"https:\u002F\u002Fjs-wasm-mandelbrot-benchmark-3.vercel.app\u002F\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003EFinal Thoughts\u003C\u002Fh2\u003E\\n\u003Cp\u003EAs tools of application distribution, browsers have some undeniable advantages over the traditional pipeline of download → extract onto disk → load from disk for execution. For most programs, it is technically unnecessary to have \u003Cem\u003Eall\u003C\u002Fem\u003E of their assets present to be able to enjoy some subset of their capabilities. Of course, adding such partial update capabilities is non-trivial, and would add significant complexity. But web developers and browser vendors have made a lot of progress in enabling this essentially by default, and with webassembly, enabling it in areas where it’s not previously been feasible.\u003C\u002Fp\u003E\\n\u003Cp\u003EFurther, cloud offloading enables users to easily sustain state across devices and in some cases avoid calculation heavy code in the interests of battery life or smooth performance. The easiest way to realize these advantages is to distribute one’s application in an environment that does this \u003Cem\u003Eby default\u003C\u002Fem\u003E: the browser. But a prerequisite for this is that the experience is not overly hampered by being in the browser, and bringing webassembly to near native performance is a key part of that.\u003C\u002Fp\u003E\\n\u003Cp\u003EThere is an opportunity here to allow people to access performance heavy applications like games and simulations on their devices without having to get into the nasty business of managing local state, which accounts for what, 99% of problems installing and using software? We want to help build this, and over the next few weeks, will be releasing demos to show what it might look like, so stay tuned!\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003EOf course, the possible bad end here is that the canvas ends up as an inefficient GUI toolkit to have fungible programmers at the cost of user experience, we hope that doesn’t happen.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Cbr\u003E\\n\u003Ch2\u003EFurther Reading:\u003C\u002Fh2\u003E\\n\u003Cp\u003EDavid Beazley. (2019). A Talk Near the Future of Python (a.k.a., Dave live-codes a Webassembly Interpreter). \u003Ca href=\\\"https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=r-A78RgMhZU\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fwww.youtube.com\u002Fwatch?v=r-A78RgMhZU\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EFirefox’s low-latency webassembly compiler – wingolog. (n.d.). Retrieved June 19, 2021, from \u003Ca href=\\\"https:\u002F\u002Fwingolog.org\u002Farchives\u002F2020\u002F03\u002F25\u002Ffirefoxs-low-latency-webassembly-compiler\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fwingolog.org\u002Farchives\u002F2020\u002F03\u002F25\u002Ffirefoxs-low-latency-webassembly-compiler\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003Efirefox’s low-latency webassembly compiler—Wingolog. (n.d.). Retrieved June 19, 2021, from \u003Ca href=\\\"https:\u002F\u002Fwingolog.org\u002Farchives\u002F2020\u002F03\u002F25\u002Ffirefoxs-low-latency-webassembly-compiler\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fwingolog.org\u002Farchives\u002F2020\u002F03\u002F25\u002Ffirefoxs-low-latency-webassembly-compiler\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EPereira, F. M. Q., &amp; Palsberg, J. (2006). Register Allocation After Classical SSA Elimination is NP-Complete. In L. Aceto &amp; A. Ingólfsdóttir (Eds.), Foundations of Software Science and Computation Structures (Vol. 3921, pp. 79–93). Springer Berlin Heidelberg. \u003Ca href=\\\"https:\u002F\u002Fdoi.org\u002F10.1007\u002F11690634_6\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fdoi.org\u002F10.1007\u002F11690634_6\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EWebAssembly. (n.d.). Retrieved June 19, 2021, from \u003Ca href=\\\"https:\u002F\u002Fwebassembly.org\u002F\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fwebassembly.org\u002F\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EWebAssembly compilation pipeline · V8. (n.d.). Retrieved June 19, 2021, from \u003Ca href=\\\"https:\u002F\u002Fv8.dev\u002Fdocs\u002Fwasm-compilation-pipeline\\\" rel=\\\"nofollow\\\"\u003Ehttps:\u002F\u002Fv8.dev\u002Fdocs\u002Fwasm-compilation-pipeline\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cem\u003EOjasvin Kirpane, Abhishek Cherath, Jo Gao &amp; Abhinuv Allu\u003C\u002Fem\u003E\u003C\u002Fp\u003E\",\"css\":{\"code\":\"\",\"map\":null},\"head\":\"\u003Clink rel=\\\"stylesheet\\\" href=\\\"https:\u002F\u002Fcdn.jsdelivr.net\u002Fnpm\u002Fkatex@0.12.0\u002Fdist\u002Fkatex.min.css\\\" integrity=\\\"sha384-AfEj0r4\u002FOFrOo5t7NnNe46zW\u002FtFgW6x\u002FbCJG8FqQCEo3+Aro6EYUG4+cU+KJWu\u002FX\\\" crossorigin=\\\"anonymous\\\" data-svelte=\\\"svelte-r30au3\\\"\u003E\u003Clink rel=\\\"stylesheet\\\" href=\\\"https:\u002F\u002Fcdn.jsdelivr.net\u002Fnpm\u002Fkatex@0.12.0\u002Fdist\u002Fkatex.min.css\\\" integrity=\\\"sha384-AfEj0r4\u002FOFrOo5t7NnNe46zW\u002FtFgW6x\u002FbCJG8FqQCEo3+Aro6EYUG4+cU+KJWu\u002FX\\\" crossorigin=\\\"anonymous\\\" data-svelte=\\\"svelte-r30au3\\\"\u003E\",\"readingTime\":\"42 min read\",\"relatedPosts\":[{\"slug\":\"3-2021-in-Review\",\"title\":\"Looking Back at 2021, Gearing For Launch\",\"date\":\"2022-1-21\",\"summary\":\"Over the past year we’ve done a lot to rapidly build up a prototype, and have finally reached a point where we’ve been using it on your own workflows.\",\"thumbnail\":\"\u002Fblog-3-review-thumbnail.webp\",\"tags\":[\"Update\",\"Engineering\"],\"author\":\"Kyle Li, Jo Gao\",\"html\":\"\u003Cp\u003E2021 has been an exciting year for Feather. \u003C\u002Fp\u003E\\n\u003Cp\u003EWe’ve made massive strides towards reaching feature parity with key players in our field, expanded our team, and have plans for even more in 2022 (including a public launch!).\u003C\u002Fp\u003E\\n\u003Ciframe style=\\\"width: 100%;\\\" width=\\\"560\\\" height=\\\"315\\\" src=\\\"https:\u002F\u002Fwww.youtube.com\u002Fembed\u002Fzh7jbxOZipw\\\" title=\\\"YouTube video player\\\" frameborder=\\\"0\\\" allow=\\\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\\\" allowfullscreen\u003E\u003C\u002Fiframe\u003E\\n\u003Cp\u003E\u003Cem\u003EP.S. Stay tuned until the end of the video Progress Report to view a demo of Feather in action through long distances (Atlanta → New York).\u003C\u002Fem\u003E\u003C\u002Fp\u003E\\n\u003Ch2\u003EProgress So Far\u003C\u002Fh2\u003E\\n\u003Cp\u003EOver the past year we’ve done a lot to rapidly build up a prototype, and have finally reached a point where we’ve been using it on your own workflows. \u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003ERemote Desktop:\u003C\u002Fstrong\u003E FeatherStream currently allows users to access their full desktop remotely from any other PC utilizing webRTC.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003ECross OS Support:\u003C\u002Fstrong\u003E We have successfully configured CI for this project to automatically give us Linux, Windows, and MacOS builds for testing.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003EMulti-Server Support:\u003C\u002Fstrong\u003E To prepare for future plans in load balancing, FeatherStream allows you to set up and connect to multiple servers from the same client device, seamlessly across multiple devices and vice versa.\u003C\u002Fp\u003E\\n\u003Cp\u003EAll of this has brought Feather up to speed with other remote desktop solutions in months, building the core of our future innovations.\u003C\u002Fp\u003E\\n\u003Ch2\u003EThe Feather Vision\u003C\u002Fh2\u003E\\n\u003Cp\u003EFeather isn’t simply a Remote Desktop. In fact, we looked at the clunky existing remote desktop and VDI infrastructure and found it unusable. It’s not their fault. The fact is that simply streaming the entire desktop as a video can never feel like you’re natively browsing windows on your machine.\u003C\u002Fp\u003E\\n\u003Cp\u003EFeather isn’t a Remote Desktop because it’s a way for you to transform your home PC into a router for processing power itself. Anyone connected to your local Wi-Fi network should be able to accelerate the processing power they have available on the weakest of devices. Connecting to another machine should feel as smooth as running an app on your own device… and making these connections should be as simple and easily understood as connecting to Wi-Fi itself. \u003C\u002Fp\u003E\\n\u003Ch2\u003ELooking Forward\u003C\u002Fh2\u003E\\n\u003Cp\u003EWe’re a little ambitious, and it won’t be easy. This year, we have a few steps planned to achieve our vision.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003EIndividual Windows\u003C\u002Fstrong\u003E: Moving forward, we will implement application-level video streaming so users can access specific programs remotely. Users will be able to use different applications with a near-native experience.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003ECross-Platform Files:\u003C\u002Fstrong\u003E We will add a shared clipboard mechanism so users can copy and paste between their local and remote devices without problems. We will be setting up a file system view for users to be able to access both local and remote files and a way to transfer and share files between devices.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Cstrong\u003EAlpha Testing:\u003C\u002Fstrong\u003E We will continue to improve and develop our testing framework to start multiple instances of FeatherStream and help us release more robust versions of this product.\u003C\u002Fp\u003E\\n\u003Cp\u003EIf you’re interested in being the first to hear about how we’re changing remote access, make sure to subscribe to the Feather newsletter.\u003C\u002Fp\u003E\\n\u003Cp\u003EIt has been an exciting year as we begin to gear up to bring Feather into the public eye. Lots have been celebrated, improved, and learned. We have exciting news planned for our next monthly update, so stay tuned to learn more because even we can’t wait to see what comes next. \u003C\u002Fp\u003E\\n\u003Cul\u003E\u003Cli\u003EFeather Team\u003C\u002Fli\u003E\u003C\u002Ful\u003E\",\"css\":{\"code\":\"\",\"map\":null},\"head\":\"\",\"readingTime\":\"3 min read\"},{\"slug\":\"2-webgl\",\"title\":\"WebGL with Emscripten: The Bare Minimum\",\"date\":\"2021-08-03T00:00:00.000Z\",\"summary\":\"Illustrating the bare minimum required to get WebGL up and running in C with the Emscripten compiler.\",\"thumbnail\":\"\u002Fblog-2-tri-thumbnail.webp\",\"tags\":[\"Engineering\"],\"author\":\"Jo Gao\",\"html\":\"\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-2-tri-thumbnail.webp\\\" alt=\\\"Thumbnail\\\"\u003E\u003C\u002Fdiv\u003E\\n\\n\u003Cp\u003EThe following article is something of a hybrid between the first \u003Ca href=\\\"https:\u002F\u002Femscripten.org\u002Fdocs\u002Fgetting_started\u002FTutorial.html\\\" rel=\\\"nofollow\\\"\u003EEmscripten tutorial\u003C\u002Fa\u003E and the \u003Ca href=\\\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FAPI\u002FWebGL_API\u002FTutorial\u002FGetting_started_with_WebGL\\\" rel=\\\"nofollow\\\"\u003EGetting Started with WebGL tutorial\u003C\u002Fa\u003E. It builds on the previous documentation to demonstrate how to render the same content in the WebGL tutorial, but in C.\u003C\u002Fp\u003E\\n\u003Cp\u003EThis is not an Introduction to C programming or WebGL, so a basic understanding of both will be helpful. If you are new to WebGL, I would recommend at least skimming the Getting Started with WebGL tutorial linked above.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe focus of this article is to illustrate the bare minimum required to get WebGL up and running in C with the Emscripten compiler. And thus, if you do not yet have Emscripten installed, I would suggest doing so now from their \u003Ca href=\\\"https:\u002F\u002Femscripten.org\u002Fdocs\u002Fgetting_started\u002Fdownloads.html\\\" rel=\\\"nofollow\\\"\u003Edownload page\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe Github repo for this tutorial is available on our \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002FAO-Design-Inc\u002FwebGL-with-emscripten\\\" rel=\\\"nofollow\\\"\u003EGithub\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Ch2\u003EHTML File\u003C\u002Fh2\u003E\\n\u003Cp\u003EThe following is a barebones HTML file with a canvas element. The \u003Ccode\u003Eindex.js\u003C\u002Fcode\u003E script after the canvas is the file that will be generated from compiling the C code.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-html\\\"\u003E&lt;!DOCTYPE html&gt;\\n&lt;html lang=&quot;en&quot;&gt;\\n\\t&lt;head&gt;\\n\\t\\t&lt;meta charset=&quot;UTF-8&quot; \u002F&gt;\\n\\t\\t&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot; \u002F&gt;\\n\\t\\t&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; \u002F&gt;\\n\\t\\t&lt;title&gt;Document&lt;\u002Ftitle&gt;\\n\\t&lt;\u002Fhead&gt;\\n\\t&lt;body&gt;\\n\\t\\t&lt;canvas id=&quot;canvas&quot; height=&quot;400px&quot; width=&quot;400px&quot;&gt;&lt;\u002Fcanvas&gt;\\n\\t\\t&lt;script src=&quot;index.js&quot;&gt;&lt;\u002Fscript&gt;\\n\\t&lt;\u002Fbody&gt;\\n&lt;\u002Fhtml&gt;\\n&lt;h1&gt;This is a header&lt;\u002Fh1&gt;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch2\u003EHeader Files\u003C\u002Fh2\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-c\\\"\u003E#include &lt;emscripten\u002Fhtml5.h&gt;\\n#include &lt;GLES2\u002Fgl2.h&gt;\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe html5 header provides the bindings required to use html elements and events from native code. For this tutorial, it will allow us to set up the WebGL context in C. You can view the full documentation for \u003Ccode\u003Eemscripten\u002Fhtml.5.h\u003C\u002Fcode\u003E \u003Ca href=\\\"https:\u002F\u002Femscripten.org\u002Fdocs\u002Fapi_reference\u002Fhtml5.h.html\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003EThe gl2 header provides the functions to draw and interact with the canvas context. The entire header file can be found \u003Ca href=\\\"https:\u002F\u002Fwww.khronos.org\u002Fregistry\u002FOpenGL\u002Fapi\u002FGLES2\u002Fgl2.h\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Ch2\u003ESetting up the Canvas\u003C\u002Fh2\u003E\\n\u003Cp\u003EBefore we can begin drawing, we must first obtain a canvas context. The html5 header file provides the functions needed to do this. To create a canvas context, the \u003Ccode\u003Eemscripten_webgl_create_context\u003C\u002Fcode\u003E function takes a target and an \u003Ccode\u003EEmscriptenWebGLContextAttributes\u003C\u002Fcode\u003E object, used to specify various attributes for the context. A complete list of the object’s attributes can be found \u003Ca href=\\\"https:\u002F\u002Femscripten.org\u002Fdocs\u002Fapi_reference\u002Fhtml5.h.html#c.EmscriptenWebGLContextAttributes\\\" rel=\\\"nofollow\\\"\u003Ehere\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cpre class=\\\"language-c\\\"\u003E\u003C!-- HTML_TAG_START --\u003E\u003Ccode class=\\\"language-c\\\"\u003E\u003Cspan class=\\\"token keyword\\\"\u003Eint\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Emain\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E&#123;\u003C\u002Fspan\u003E \u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002F beginning of main function\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002F setting up EmscriptenWebGLContextAttributes\u003C\u002Fspan\u003E\\n\\tEmscriptenWebGLContextAttributes attr\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Eemscripten_webgl_init_context_attributes\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Eattr\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\tattr\u003Cspan class=\\\"token punctuation\\\"\u003E.\u003C\u002Fspan\u003Ealpha \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token number\\\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\n\\t\u003Cspan class=\\\"token comment\\\"\u003E\u002F\u002F target the canvas selector\u003C\u002Fspan\u003E\\n\\tEMSCRIPTEN_WEBGL_CONTEXT_HANDLE ctx \u003Cspan class=\\\"token operator\\\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\\\"token function\\\"\u003Eemscripten_webgl_create_context\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\\\"token string\\\"\u003E\\\"#canvas\\\"\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\\\"token operator\\\"\u003E&amp;\u003C\u002Fspan\u003Eattr\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\\n\\t\u003Cspan class=\\\"token function\\\"\u003Eemscripten_webgl_make_context_current\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E(\u003C\u002Fspan\u003Ectx\u003Cspan class=\\\"token punctuation\\\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\\\"token punctuation\\\"\u003E;\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C!-- HTML_TAG_END --\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EAt the start of the main function, we create and initialize the \u003Ccode\u003EEmscriptenWebGLContextAttributes\u003C\u002Fcode\u003E object with all the default attributes settings except the alpha attribute, which is set to false. This is done mostly for the purpose of illustrating how to set specific attributes.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe \u003Ccode\u003Eemscripten_webgl_create_context\u003C\u002Fcode\u003E function targets, \u003Ccode\u003E#canvas\u003C\u002Fcode\u003E, the selector for the canvas element in the html file. After creating the context, we must activate it using \u003Ccode\u003Eemscripten_webgl_make_context_current\u003C\u002Fcode\u003E, to specify that all following GL calls will be applied to that context.\u003C\u002Fp\u003E\\n\u003Ch2\u003EDrawing to the Canvas\u003C\u002Fh2\u003E\\n\u003Cp\u003EIn JavaScript, we would use \u003Ccode\u003EclearColor\u003C\u002Fcode\u003E and \u003Ccode\u003Eclear\u003C\u002Fcode\u003E on the canvas context to fill in the canvas. The equivalents of these methods are provided by the gl2 header as \u003Ccode\u003EglClearColor\u003C\u002Fcode\u003E and \u003Ccode\u003EglClear\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-c\\\"\u003E\u002F\u002F this goes after you have activated the webgl context\\n\\tglClearColor(0.984, 0.4627, 0.502, 1.0);\\n\\tglClear(GL_COLOR_BUFFER_BIT);\\n\\treturn 1;\\n} \u002F\u002F end of main function\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch2\u003ECompiling and Running\u003C\u002Fh2\u003E\\n\u003Cp\u003ETo compile with Emscripten, run the following command. This will output the index.js file that is sourced from the html file.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-bash\\\"\u003Eemcc main.c -o index.js\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EThe html file can now be opened and viewed in a browser. Huzzah!\u003C\u002Fp\u003E\\n\u003Cdiv align=\\\"center\\\"\u003E\u003Cimg style=\\\"width: 100%\\\" src=\\\"\u002Fblog-2-tri-final.jpg\\\" alt=\\\"Final\\\"\u003E\u003C\u002Fdiv\u003E\",\"css\":{\"code\":\"\",\"map\":null},\"head\":\"\",\"readingTime\":\"4 min read\"}]}]"}</script></div>
</body>

</html>